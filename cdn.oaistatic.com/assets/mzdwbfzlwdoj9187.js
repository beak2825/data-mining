const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/d9zx2q3le9qqahr6.js","assets/fyeo2h7okrqcf3nz.js","assets/f7j18j5u52u1pnnk.js","assets/egb2c0f6p1ew61vt.js","assets/root-dql6y2cb.css","assets/conversation-small-k592qa8k.css","assets/e148leij17ilxav8.js","assets/jtk4wac4rna3hd1u.js","assets/mwt17hczy9h6nm3a.js","assets/lqc3mxovgoy4h7eq.js","assets/ixsisjuxwij5x7d3.js"])))=>i.map(i=>d[i]);
import{e as pe,j as e,k as Lt,M as N,f as Te,r as p,A as Ao,n as Pe,d as Ar,q as _r,L as kr,c as Pr,p as vr,Q as jr}from"./fyeo2h7okrqcf3nz.js";import{bE as Q,j as We,cD as Oe,mU as wr,mV as Tr,mW as Mr,dt as Er,mX as Jn,dq as Rr,T as Ms,P as j,b5 as Es,mY as $,B as Je,f8 as He,H,ev as Ir,hi as _o,w as se,mZ as Dt,b7 as ko,q as ee,r as Rs,ay as Ft,dv as Is,d4 as st,e9 as Bs,dx as Ze,dy as Br,m_ as Ns,m$ as Ls,n0 as Nr,dw as je,a$ as Ve,ee as nt,go as As,hc as _s,gk as Ds,gs as Po,gp as ks,kM as vo,lS as jo,kN as wo,bn as xe,cX as Lr,be as we,_ as Dr,n1 as ke,cj as Zn,n2 as Fr,x as Se,aS as he,lW as eo,br as to,aR as z,cn as Ur,cE as To,bm as ze,n3 as Mo,gA as Eo,n4 as Ro,f6 as fs,bQ as so,l as Fs,eP as Io,f as Z,cZ as Us,c_ as Os,L as gs,b as hs,fJ as Or,cg as ot,cv as at,dP as Hr,aP as Bo,b6 as zr,cQ as Gr,a1 as No,aZ as Ge,t as Wr,G as Vr,R as qr,o as Yr,D as Lo,lI as $r,kH as Hs,n5 as Do,li as Ps,eb as Kr,b9 as Qr,F as Xr,ea as Fo,dZ as Jr,cN as vs,n6 as Zr,bD as Uo,bY as ei,a3 as Oo,cl as Ho,eW as ti,bk as zo,bh as si,f$ as ni,cU as Go,ax as oi,aQ as ai,jv as ri,gK as ii,n7 as li,gO as no,g$ as Wo,cm as ci,ef as ui,aw as et,Q as Tt,S as oo,lH as di,ec as ao,n8 as mi,l8 as pi,h7 as fi,bX as gi,cI as hi,fM as It,n9 as xi,ed as Si,hR as bi,na as Ci,nb as yi,iQ as Ai,nc as _i,nd as ki,em as Vo,s as Pi,N as vi,gn as ji,ck as wi,f3 as Ti,kw as Mi,ft as qo,fd as Ei,ne as Ri,hg as Ii,jk as Bi,nf as Ni,ep as Li,er as Di,jF as Fi,ng as Ui,j2 as Oi}from"./egb2c0f6p1ew61vt.js";import{d as Me,f as Yo,e as Hi,s as zi,g as Gi,u as Wi,I as Vi,R as qi}from"./lqc3mxovgoy4h7eq.js";import{jT as $o,rw as js,ba as Ut,l5 as zs,rx as Yi,ry as $i,ll as Gs,rz as Ki,kr as Qi,rA as Ko,rB as ws,b6 as Xi,rC as Ji,rD as Qo,c$ as Zi,nN as ro,dm as Ws,nP as el,rE as tl,rF as sl,cK as nl,rr as ol,c3 as Xo,l7 as Vs,rG as Jo,f9 as Ot,rH as Zo,rI as al,rJ as rl,rK as il,rL as Mt,jx as Ht,rM as ll,rN as cl,rO as ul,rP as dl,rQ as ml,rR as io,rS as pl,rT as fl,rU as gl,rV as hl,y as rt,rW as xl,rX as Sl,pA as xs,B as ea,F as ta,G as sa,oO as bl,lm as le,rY as Cl,qI as tt,rZ as yl,h0 as Al,r_ as _l,r$ as _,s0 as na,s1 as kl,s2 as Pl,s3 as vl,s4 as jl,s5 as wl,s6 as Tl,s7 as Ml,s8 as El,s9 as Rl,sa as Il,sb as Bl,sc as Nl,sd as Ll,se as Dl,sf as Fl,sg as Ul,sh as Ol,si as Hl,sj as zl,sk as Gl,sl as Wl,sm as Vl,mM as Et,L as ge,A as zt,sn as ql,so as Yl,oj as $l,bf as oa,sp as Kl,aU as Ue,e as aa,sq as Ql,sr as Xl,mO as Ts,lq as Jl,ia as ra,ss as Zl,g_ as ia,g$ as ec,st as tc,su as sc,cm as nc,cs as Gt,gO as oc,sv as ac,os as rc,dW as la,a8 as ic,ej as lc,a1 as ca,eI as ua,sw as cc,sx as uc,sy as dc,f2 as mc,sz as pc,hh as fc,sA as gc,sB as hc,sC as xc,sD as Sc,sE as bc,sF as Cc,sG as yc,sH as Ac,sI as _c,sJ as kc,sK as Pc,sL as vc,sM as jc,sN as wc,sO as Tc,sP as Mc,sQ as Ec,sR as Rc,sS as Ic,sT as Bc,sU as Nc,sV as da,sW as Lc,sX as ma,sY as pa,sZ as Dc,s_ as Fc,s$ as fa,t0 as Uc,t1 as Oc,en as Hc,t2 as ga,t3 as ha,gy as zc,gz as Gc,ep as Wc,t4 as Vc,gB as Ss,t5 as qc,t6 as Yc,t7 as $c,t8 as bs,gD as Kc,t9 as Qc,ta as Xc,tb as Jc,tc as Zc,gG as eu,td as tu,te as su,tf as nu,eK as ou,ln as au,tg as ru,th as iu,j2 as lu,ti as cu,qm as uu,tj as du,tk as mu,tl as pu,tm as fu,tn as gu,to as hu,tp as xu,tq as Su,tr as bu,ts as Cu,eV as yu,jj as Au,tt as _u,tu as lo,hD as ku,kv as Pu,tv as vu,lH as ju,tw as wu,tx as Tu,ty as Mu,lr as co,tz as Eu,tA as Ru,tB as J,eB as Iu,tC as Bu,z as Nu,U as uo,tD as Lu,tE as Du,tF as Fu,tG as Uu,tH as Ou,tI as Hu,d as zu,tJ as Gu,tK as Wu,tL as Vu,el as qu,tM as mo,tN as po,tO as fo,tP as Yu,tQ as $u,fj as Ku,tR as Qu,fm as Xu,fn as Ju,tS as Zu,tT as ed,tU as td,tV as sd,tW as nd,tX as od,tY as ad,eP as rd,ah as id,tZ as ld,az as cd,mi as ud,eU as dd,mJ as md,em as pd,t_ as fd,aY as gd,qk as hd,t$ as xd,u0 as Sd,mG as Cs,m3 as ys,u1 as bd,aZ as Cd,u2 as yd}from"./f7j18j5u52u1pnnk.js";import{u as Ad,b as _d}from"./mtx41j31lzyyzsit.js";import{P as kd,u as Pd}from"./jrm7m26zzbmpv5fw.js";import{A as vd,C as jd,g as wd}from"./lk4s8c9e8k6949av.js";import{u as Td}from"./euyyz74sa52ztdnb.js";import{P as Md,v as Ed,w as Rt,x as Rd}from"./ixsisjuxwij5x7d3.js";import{u as Id,c as Bd}from"./f2cokc4vvw85wf3h.js";import{u as xa}from"./odn3jimzeso6ws9q.js";import{F as Nd}from"./g286r35f18ua9byd.js";const Bt=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:o,highlightTooltip:i=!1,disabledReason:c,currentModelName:a,label:r,secondaryLabel:m})=>{const u=pe(),x=Q(t,H.getIsNewConversation),g=We(),l=k=>{s!=null&&k&&j.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:g?.planType??"unknown"})},f=$o(Oe.signUpButtonText),{isEligible:S}=Ad(t),y=!!s;return e.jsx(e.Fragment,{children:y?e.jsxs(wr,{delayDuration:150,onOpenChange:l,children:[e.jsx(Tr,{asChild:!0,children:n}),e.jsx(Mr,{children:e.jsx(Er,{children:e.jsx(Jn,{children:e.jsx(Rr,{$as:Jn,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(Ld,{isNewConversation:x,rateLimitPopup:s,signUpButtonText:f})})})})})]}):!o&&S?e.jsx(Nd,{clientThreadId:t,children:n}):e.jsx(Ms,{label:!o&&r?r:Wt(u,o,c,a),secondaryLabel:m,labelOrientation:"horizontal",className:"flex",contentClassName:i?void 0:"touch:hidden",open:i?!0:void 0,side:"bottom",children:n})})};function Wt(t,s,n,o){return s?n===js.ModelNotSupported&&o!=null?t.formatMessage({id:"xPEzDr",defaultMessage:"Add files disabled for {modelName}"},{modelName:o}):t.formatMessage({id:"MeW0HZ",defaultMessage:"Add files is unavailable"}):t.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"})}const Ld=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const o=We(),i=Lt(),c=Ut(),a=zs(),r=Es();if(s==null)return null;const{call_to_action:m,description:u}=s,x=u||e.jsx(N,{...go.defaultDescription}),g=m?.includes($.GET_PLUS),l=m?.includes($.AUTHENTICATE),f=l&&r;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:x}),g?e.jsx(Je,{size:"small",color:"secondary",onClick:()=>{He(i,"Rate limited file upload popover"),j.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:o?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(N,{...go.getPlus})}):null,l?e.jsx(Je,{size:"small",color:"primary",onClick:()=>{c({authType:a?"login":"signup",callback:S=>{a?j.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S}):j.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:a?e.jsx(N,{...Oe.logInButtonText}):e.jsx(N,{...n})}):null,f?e.jsx(Je,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{c({authType:a?"signup":"login",callback:S=>{a?j.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S}):j.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:a?e.jsx(N,{...n}):e.jsx(N,{...Oe.logInButtonText})}):null]})},go=Te({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Sa=({modelSupportsImages:t,isDisabled:s})=>{const n=t&&!s&&_o(),{addFileIcon:o}=Gs(),i=Dd(o,n);return e.jsx(i,{"aria-label":"",className:"icon"})};function qs({openFileDialog:t,showMenuForNoAuth:s,modelSupportsImages:n,isDisabled:o,disabledReason:i,currentModelName:c}){const a=pe(),r=Ut(),m=n&&!o&&Ir(),u=n&&!o&&_o();return s?e.jsx(Fd,{onClickUploadImages:t,redirectToAuth:()=>r({authType:"login"})}):e.jsxs(e.Fragment,{children:[u&&e.jsx(Yi,{}),m&&e.jsx($i,{}),e.jsx(se.Item,{onClick:t,icon:e.jsx(Sa,{modelSupportsImages:n,isDisabled:o}),disabled:o,label:u?a.formatMessage({id:"LocalFileDropdownItem.uploadFilesOnly",defaultMessage:"Add files"}):Wt(a,o,i,c)},"upload")]})}function Dd(t,s){return t==="photo"?s?ws:Ko:t==="paperclip"?ws:Xi}function Fd({onClickUploadImages:t,redirectToAuth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(se.Item,{icon:Ki,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...Xe.connectApps}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...Xe.loginRequired})})]})},"connect-apps-no-auth"),e.jsx(se.Item,{icon:Qi,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...Xe.uploadDocuments}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...Xe.loginRequired})})]})},"upload-documents-no-auth"),e.jsx(se.Item,{icon:Ko,onClick:t,children:e.jsx(N,{...Xe.uploadImages})},"upload-images-no-auth")]})}const Xe=Te({connectApps:{id:"Rna6u2",defaultMessage:"Connect apps"},uploadDocuments:{id:"0BxpM7",defaultMessage:"Documents"},uploadImages:{id:"rdMuNJ",defaultMessage:"Images"},loginRequired:{id:"/1XNys",defaultMessage:"Login required"}});function Ud({clientThreadId:t,openFileDialog:s,icon:n,isDisabled:o=!1,isSmall:i=!1,showLabel:c=!1,showUpsell:a=!1,hideBorder:r=!1,highlightTooltip:m=!1,disabledReason:u,currentModelName:x,visualTreatment:g,showMenuForNoAuth:l,modelSupportsImages:f}){const S=pe(),y=Dt();o=(o||!!y)&&!a;const k=e.jsxs(Ji,{disabled:o,$showLabel:c,$hideBorder:r,$isSmall:i,$visualTreatment:g,onClick:R=>{if(R.preventDefault(),l||a){j.logNoAuthAttachButtonClicked({location:l?"No auth file upload":"No auth upsell"});return}s()},"aria-label":Wt(S,o,u,x),children:[n,c&&e.jsx(Qo,{})]}),A=e.jsx("div",{className:"flex",children:k});if(l||a){const R=l?e.jsx(qs,{openFileDialog:s,showMenuForNoAuth:!0,modelSupportsImages:f}):e.jsx(Zi,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}),I=e.jsx(se.BasicTrigger,{asChild:!0,children:A});return e.jsxs(se.Root,{children:[l?e.jsx(Bt,{clientThreadId:t,rateLimitPopup:y,highlightTooltip:m,disabled:o,children:I}):e.jsx(Ms,{label:e.jsx(N,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:I}),e.jsx(se.Portal,{children:e.jsx(se.Content,{alignOffset:-8,side:"bottom",size:"small",className:"radix-side-bottom:flex-col-reverse flex flex-col",children:R})})]})}return e.jsx(Bt,{disabled:o,clientThreadId:t,rateLimitPopup:y,highlightTooltip:m,children:A})}function Od({code:t,message:s}){switch(t){case ro.FileTooLarge:return ho.errorFileTooLarge;case ro.TooManyFiles:return j.logEvent("Uploaded Max Files Error"),ho.errorTooManyFiles;default:return s}}const ho=Te({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),xo=Te({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Hd(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function up(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:i,noKeyboard:c}=t,a=pe(),r=Ft(),m=ee(),u=Ve(m),g=Rs(m).flags?.includes(Bs.NoAuthEnableFileUploads),l=Ws(o),f=nt(),S=As(i,l,f),y=S!==je.None,k=_s(C=>C.files),A=(S===je.Multimodal?Ns:Ls)-k.length,R=A<=0,{getGizmoId:I}=Ds(),{handleFileAccepted:T}=Ca(a,S,ks(i,l),"drag",I,Po(i,l)?.attachments),v=Dt(),P=vo(!u&&g?ks(i,l):jo(i,l)),{getRootProps:b,isDragActive:w}=xa({maxFiles:A,disabled:!y||R||v!=null,noClick:!0,noKeyboard:c,onDropAccepted:T,onDropRejected:C=>ba(C,a,r,S),multiple:!0,maxSize:wo,...P}),M=Hd(P);return e.jsxs("div",{...b({className:s}),children:[n,w&&e.jsxs(zd,{children:[e.jsx(el,{}),e.jsx("h3",{children:e.jsx(N,{...xo.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:M.length>0?M.join(", "):e.jsx(N,{...xo.dragAllAccepted})})]})]})}function ba(t,s,n,o){const{errors:i}=t[0];i.forEach(c=>{const a=Od(c);typeof a=="string"?n.danger(a,{hasCloseButton:!0,loggingTitle:"File upload error",loggingDescription:a,toastId:"file_upload_error"}):n.danger(s.formatMessage(a,{size:Nr,maxNum:o===je.Multimodal?Ns:Ls}),{hasCloseButton:!0,loggingTitle:a.defaultMessage||"File upload error",loggingDescription:a.defaultMessage||"File upload error",toastId:"file_upload_error"})})}function Ca(t,s,n,o,i,c){const a=ee(),r=Rs(a).flags,m=Ft(),u=Is(),{isUnauthenticated:x}=st(),g=r?.includes(Bs.NoAuthEnableFileUploads);return{handleFileAccepted:p.useCallback(async(f,S)=>{j.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()});const y=i!=null?await i():void 0;f.length>0&&f.forEach(k=>{Ze.uploadFile(u,Br(k),k,s,n,t,m,{gizmoId:y,...g&&{isUnauthenticated:x}},c)})},[o,s,i,u,n,t,m,c,g,x])}}const zd=ko.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Gd=({clientThreadId:t,currentModelId:s,isCompletionInProgress:n,composerController:o})=>{const i=ee(),c=nt(),a=xe(t),r=Lr(k=>k.threads[t]?.prepareRequestBlocked??!1),{isOpen:m}=_d();tl({clientThreadId:t,composerController:o});const u=p.useRef(n);p.useEffect(()=>{u.current=n},[n]);const x=p.useCallback(k=>{u.current?we(t,A=>{A.conduitToken=null,A.prepareState=null}):we(t,A=>{A.conduitToken=k,A.prepareState="success"})},[t]),g=p.useRef(null);g.current=()=>sl(t,s,c?[c]:void 0,x,!1,m);const l=p.useCallback(()=>g.current?.(),[]),f=p.useCallback(nl(()=>l(),5e3,{leading:!0,trailing:!0}),[]),S=p.useRef(!1),y=Dr();return p.useEffect(()=>{if(y){if(!S.current){S.current=!0;return}u.current||r||l()}},[y,t,s,c,a?.effortMode,r]),p.useEffect(()=>{f.cancel()},[n,f]),p.useEffect(()=>o.subscribe("change",()=>{n||ol(i,!0)&&f()}),[n,o,f,i]),null},Wd=({clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:n,onSecondaryCTAClick:o,onDismiss:i,onMount:c})=>{const{title:a,description:r,action_items:m,composer_text:u}=s,x="Prompt TextareaBeacons Banner",g=Xo({clientThreadId:t}),l=Me(),f=Ut(),S=ee(),y=!Ve(S),k=Lt(),A=v=>{switch(v?.action){case ke.REGENERATE_MESSAGE_GPT45:{const P=H.getCurrentLeafId(xe(t)),b=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"gpt-4-5"})};return{text:v.action_copy,onClick:b}}case ke.FILE_UPLOAD:{const P=()=>{l.openFileDialog(),u&&(l.focus(),l.setText(u))};return{text:v.action_copy,onClick:P}}case ke.AUTHENTICATE_LOGIN:{const P=()=>{f({authType:"login"})};return{text:v.action_copy,onClick:P}}case ke.AUTHENTICATE_SIGNUP:{const P=()=>{f({authType:"signup"})};return{text:v.action_copy,onClick:P}}case ke.GET_PLUS:{const P=()=>{y?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):He(k,x)};return{text:v.action_copy,onClick:P}}case ke.GET_PRO:{const P=()=>{y?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):He(k,x)};return{text:v.action_copy,onClick:P}}case ke.REGENERATE_MESSAGE_O3:{const P=H.getCurrentLeafId(xe(t)),b=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"o3"})};return{text:v.action_copy,onClick:b}}default:return}};Vs(()=>{c?.()});const[R,I]=m??[],T={primaryAction:(()=>{const v=A(R);if(v)return{...v,onClick:()=>{n?.(),v.onClick?.()}}})(),secondaryAction:(()=>{const v=A(I);if(v)return{...v,onClick:()=>{o?.(),v.onClick?.()}}})()};return e.jsx(Jo,{onDismiss:i,title:a,description:r,actions:T})},Vd=({clientThreadId:t})=>{const s=Zo(),n=Q(t,H.getRequestId),o=Ot(n),i=al(),c=rl(),a=il();p.useEffect(()=>{o&&(j.logEventWithStatsig("Beacon UI Banner Ignored","chatgpt_beacon_ui_banner_ignored",{...s}),Mt.dismissBanner())},[o,s]);const r=p.useRef(!1),m=()=>{r.current||s&&(j.logEventWithStatsig("Beacon UI Banner Shown","chatgpt_beacon_ui_banner_shown",{...s}),i.mutate(s.beacon_id),r.current=!0)},u=()=>{s&&(j.logEventWithStatsig("Beacon UI Banner Primary CTA Clicked","chatgpt_beacon_ui_banner_primary_cta_clicked",{...s}),c.mutate(s.beacon_id)),Mt.dismissBanner()},x=()=>{s&&(j.logEventWithStatsig("Beacon UI Banner Secondary CTA Clicked","chatgpt_beacon_ui_banner_secondary_cta_clicked",{...s}),c.mutate(s.beacon_id)),Mt.dismissBanner()},g=()=>{s&&(j.logEventWithStatsig("Beacon UI Banner Dismissed","chatgpt_beacon_ui_banner_dismissed",{...s}),a.mutate(s.beacon_id)),Mt.dismissBanner()};return e.jsx(Ao,{children:s&&e.jsx(Pe.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Wd,{clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:u,onSecondaryCTAClick:x,onDismiss:g,onMount:m})})})};function qd(t){const s=Q(t,H.getRequestId),n=Ot(s),o=Zo(),i=o!=null&&o.action_items.every(c=>Object.values(ke).includes(c.action));return!n&&i}const ya=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:i})=>{const{name:c,title:a,call_to_action:r,description:m}=s,u=We(),x=Zn(!0),{updateSystemHint:g}=Ht(),l=Me(),f=Zn(!1),S=Fr(),y=Q(t,H.getIsNewConversation),k=u?.planType??"unknown",A=Es(),R=S&&"block_reason"in S?S.block_reason:null,I="banner_description",T=p.useMemo(()=>({type:c||"unknown",location:I,plan_type:k,is_new_conversation:y,is_hard_block:!!S,hard_block_reason:R??"",call_to_action:r}),[c,I,k,y,S,R,r]),v=Lt(),P=Ut(),b=ee(),w=!Ve(b),M=zs(),C=$o(Oe.signUpButtonText),D=Xo({clientThreadId:t}),L=Se(b,"1368081792"),V=q=>{switch(q){case $.AUTHENTICATE:return{text:M?Oe.logInButtonText:C,onClick:()=>{P({authType:M?"login":"signup",callback:E=>{M?j.logLogInButtonClicked({location:`Rate limit banner - ${c}`,provider:E}):j.logSignUpButtonClicked({location:`Rate limit banner - ${c}`,provider:E})}})}};case $.AUTHENTICATE_SECONDARY:return{text:M?C:Oe.logInButtonText,onClick:()=>{P({authType:M?"signup":"login",callback:E=>{M?j.logSignUpButtonClicked({location:`Rate limit banner - ${c}`,provider:E}):j.logLogInButtonClicked({location:`Rate limit banner - ${c}`,provider:E})}})}};case $.GET_PLUS:return{text:_e.getPlusButton,onClick:()=>{j.logRateLimitGetPlusButtonClicked(T),w?P({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:E=>{M?j.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:E}):j.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:E})}}):He(v,"Prompt textarea rate limit banner")}};case $.NEW_CHAT:return{text:_e.newChatButton,onClick:()=>{x({modelId:"",location:I})}};case $.PAID_USER_O3_MINI_HIGH:{const E=H.getCurrentLeafId(xe(t)),K=()=>{j.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:L.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:T}),L.get("should_change_model_picker",!0)&&f({modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}),D({sourceEvent:new Event("click"),nodeId:E,requestedModelId:"o4-mini-high"})};return{text:_e.tryItButton,onClick:K}}case $.FREE_USER_O3_MINI_HIGH:return{text:_e.getPlusButton,onClick:()=>{j.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:T}),He(v,"Prompt textarea in-context upsell banner")}};case $.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const E=H.findNode(xe(t),ne=>eo(ne.message)),K=E?to(E.message):void 0;return{text:_e.tryItButton,onClick:()=>{j.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:T}),g(z.Research,{clientThreadId:t}),l.focus(),l.setText(K??"")}}}case $.GET_PRO:return{text:_e.getProButton,onClick:()=>{j.logRateLimitUpgradePlanButtonClicked({...T,upgrade_plan_tye:"pro"}),w?P({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:E=>{M?j.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:E}):j.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:E})}}):He(v,"Prompt textarea rate limit banner")}};case $.TRY_CODEX:return{text:_e.tryCodexButton,onClick:()=>{j.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:T}),v("/codex")}};case $.TRY_TATERTOT:{const E=H.findNode(xe(t),ne=>eo(ne.message)),K=E?to(E.message):void 0;return{text:_e.tryItButton,onClick:()=>{j.logEventWithStatsig("In Context Upsell Banner Tatertot CTA Clicked","chatgpt_in_context_upsell_banner_tatertot_cta_clicked",{location:"In-context upsell tatertot - Try it button",eventProperties:T}),g(z.Tatertot,{clientThreadId:t}),l.focus(),l.setText(K??"")}}}default:return}};Vs(()=>{!L.get("should_change_model_picker",!0)&&T.type==="o3-mini-high-in-context-upsell-plus"&&(T.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),j.logRateLimitBannerShown(T),i?.()});const[h,Y]=r??[];let G=Y;h===$.AUTHENTICATE&&A&&(G=$.AUTHENTICATE_SECONDARY);const W=he(b,"2861925050");let F={};return W&&(h===$.NOTIFY_ADMIN_FOR_CREDITS||h===$.ADD_CREDITS)?h===$.ADD_CREDITS?F={customActions:e.jsx(vd,{trigger:"prompt-textarea-rate-limit-banner"})}:h===$.NOTIFY_ADMIN_FOR_CREDITS&&(F={customActions:e.jsx(jd,{creditConsumingProduct:wd(c),trigger:"prompt-textarea-rate-limit-banner"})}):F={primaryAction:V(h),secondaryAction:V(G)},e.jsx(Jo,{onDismiss:n,title:a,description:m,actions:F,onInteract:o})},_e=Te({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Yd=({clientThreadId:t,composerController:s})=>{const n=Mo(),o=ze(s.store,k=>k.rateLimitBannerFeature),i=Eo(),c=n??Aa(o,i),a=Q(t,H.getRequestId),r=Q(t,H.getCurrentLeafId),m=Ot(a),{markSeen:u}=Ro(r),x=ee(),g=Se(x,"1368081792"),l=c?.name?()=>{switch(c.name){case"tatertot-in-context-upsell":u(!1);break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":gl(r);break}}:void 0,f=he(x,"3612584454");p.useEffect(()=>{m&&!(c?.name==="gpt-4l"&&f)&&(so.dismissBanner(),s.setRateLimitBannerFeature(null))},[m,c?.name,f,s]);const S=c?.is_dismissible?()=>{j.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!g.get("should_change_model_picker",!0)&&c?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":c?.name}),so.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,y=()=>{switch(c?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":hl({interactedInPeriod:!0});break;case"tatertot-in-context-upsell":u(!0);break}};return e.jsx(Ao,{children:c&&e.jsx(Pe.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(ya,{clientThreadId:t,rateLimitInfo:c,onDismiss:S,onInteract:y,onMount:l})})})};function Aa(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function $d(t,s,n,o,i,c,a,r,m,u,x,g,l){if(m||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(T=>T.model_slug==="o4-mini-high")||n.id==="o4-mini-high")||r&&a&&fs(Date.now(),a)<io)return!1;const S=o==null||fs(Date.now(),o)>=pl,y=i===u,k=a==null||c==null||fs(Date.now(),a)>=io||c<fl;if(!(S&&k||y))return!1;switch(t.name){case"deep-research-in-context-upsell":return x("should_show_deep_research_upsell_banner",!1);case"deep-research-in-context-upsell-free":return x("should_show_deep_research_upsell_banner_free",!1);case"o3-mini-high-in-context-upsell-free":return x("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return x("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return g("should_show_codex_upsell_banner",!1);case"codex-in-context-upsell-plus":return l("should_show_codex_upsell_banner",!1);default:return!1}}function Kd(t,s){const n=ee(),o=Ur(),i=To(t),c=Q(t,H.getRequestId),a=Q(t,H.getCurrentLeafId),r=Ot(c),m=ll(b=>b.lastSeenInContextUpsellBannerAt),u=cl(b=>b.inContextUpsellBannerPeriodExposureCount),x=ul(b=>b.inContextUpsellBannerPeriodStartAt),g=dl(b=>b.inContextUpsellBannerLastSeenId),l=ml(b=>b.inContextUpsellBannerInteractedInPeriod),f=Se(n,"1368081792"),S=Se(n,"1738106734"),y=Se(n,"3861158060"),k=ze(s.store,b=>b.rateLimitBannerFeature),A=he(n,"2861925050"),R=Mo(),I=Eo(),{canBeSeen:T}=Ro(a),v=A?R:R??Aa(k,I);let P=!1;switch(v?.name){case null:case void 0:P=k!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":P=$d(v,o,i,m,g,u,x,l,r,a,f.get,S.get,y.get);break;case"tatertot-in-context-upsell":P=T&&f.get("should_show_tatertot_in_context_upsell_banner",!1);break;default:P=!0}return!r&&P}const Nt="month",_a="year";function Qd(){const t=Fs(),s=pe(),n=Ft(),{markAsViewed:o}=rt(xl),{initialBillingDetails:i}=Td(t,!0),c=p.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function a(){try{await bl(t?.features??[],s,n,i,c)}catch{}}const{shouldShowBanner:r,discountValue:m,discountDuration:u}=Sl();if(p.useEffect(()=>{r&&m&&u&&xs.logShowReferrerRedemptionBanner()},[r,m,u]),!r||!m||!u)return null;const x=Xd(s,i,m,u),g=Jd(s,i,m,u),l=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:x}),e.jsx("span",{className:"text-token-text-secondary",children:g})]});return e.jsx(ea,{onPrimaryCtaClick:()=>{o(),xs.logClickReferrerRedeemButton(),a()},primaryCtaText:e.jsx(N,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{o(),xs.logCloseReferrerRedemptionBanner()},content:l})}function Xd(t,s,n,o){const{currencySymbol:i}=ta(sa(),s.currency),c=o?o.period:Nt,a=o?o.num_periods:1,r=i.code.defaultMessage?.toString()??Io,m=t.formatNumber(n.value,{style:"currency",currency:r,minimumFractionDigits:0,maximumFractionDigits:2});let u;return c===Nt?u=a===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:m}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:m}}):c===_a&&(u=a===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:m}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:m}})),u}function Jd(t,s,n,o){const{currencySymbol:i}=ta(sa(),s.currency),c=o?o.period:Nt,a=o?o.num_periods:1,r=i.code.defaultMessage?.toString()??Io,m=t.formatNumber(n.value,{style:"currency",currency:r,minimumFractionDigits:0,maximumFractionDigits:2});let u;return c===Nt?u=a===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:m,num_months:a}}):c===_a&&(u=a===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:m}}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:m,num_years:a}})),u}const Zd=Us(()=>Os(()=>import("./d9zx2q3le9qqahr6.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),ka=p.memo(function({className:s}){const{store:n}=le(),o=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:Z(s??"absolute start-0 end-0 bottom-full",yl.PromptTextareaHeader),children:e.jsx(Cl,{shouldRender:o,contentArea:tt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(em,{}),e.jsx(tm,{})]})})})});function em(){const{store:t}=le(),s=t.useSharedProps(r=>r?.clientThreadId),n=t.useContentAreaId(tt.HeaderTop),o=Al(),i=Q(s,r=>r?.modelId),c=_l.useStore();let a;switch(n){case _.ProjectConversationTaskNoFileAccess:a=e.jsx(am,{});break;case _.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(Ol,{clientThreadId:s});break;case _.S09KM1:a=null;break;case _.BannerSignup:a=e.jsx(om,{});break;case _.AudioParagenPrompt:a=e.jsx(Ul,{clientThreadId:s});break;case _.BannerTermsDisclaimer:a=e.jsx(rm,{});break;case _.PromptTextareaAction:a=e.jsx(im,{});break;case _.BannersRateLimit:a=e.jsx(lm,{});break;case _.BannersBeaconUI:a=e.jsx(cm,{});break;case _.BannerSidekickAnnouncement:a=e.jsx(Fl,{});break;case _.SearchBrowserExtensionAnnouncement:a=e.jsx(Dl,{});break;case _.MoonshineAnnouncement:a=e.jsx(Ll,{});break;case _.CustomizeChatGPTAnnouncement:a=e.jsx(Nl,{});break;case _.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(Bl,{});break;case _.BannerMemoryFull:a=e.jsx(Il,{});break;case _.Box:a=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case _.JawboneAnnouncement:o?a=e.jsx(Zd,{}):a=null;break;case _.JawboneMaxActiveAnnouncement:o?a=e.jsx(Rl,{}):a=null;break;case _.PromoRedemptionAnnouncement:a=e.jsx(kd,{});break;case _.OperatorAnnouncement:a=e.jsx(El,{});break;case _.BannerPlusUpsell:a=e.jsx(Ml,{});break;case _.ReferrerRedemptionAvailableAnnouncement:a=e.jsx(Qd,{});break;case _.RefereeRedemptionAvailableAnnouncement:a=e.jsx(Tl,{});break;case _.ReferralProgramUpsellAnnouncement:a=e.jsx(wl,{});break;case _.TatertotIntakeFormAnnouncement:a=!1;break;case _.StudentsUpsellAnnouncement:a=e.jsx(jl,{});break;case _.ModelDeprecationBanner:a=vl(i);break;case _.TeamsContextualAnswersUpsell:a=e.jsx(Pl,{});break;case _.KanziConfig:a=!1;break;case _.LanguageUpsellBanner:a=e.jsx(kl,{onDismissSideEffect:()=>{j.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),c.closeBanner()},onPrimaryCtaClickSideEffect:()=>{j.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),c.closeBanner()}});break;default:a=null;break}return a}function tm(){const{store:t}=le(),s=t.useContentAreaId(tt.HeaderBottom);let n;switch(s){case na.DallePromptControls:n=e.jsx(nm,{});break;default:n=null;break}return n}const sm=Us(()=>Os(()=>import("./jtk4wac4rna3hd1u.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function nm(){const{store:t}=le(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(sm,{composerController:s}):null}function om(){const{store:t}=le(),s=t.useSharedProps(i=>i?.clientThreadId),n=zs(),o=Hl();return s?n?e.jsx(zl,{threadId:s,showSignUp:o}):e.jsx(Gl,{threadId:s,showLogin:o}):null}function am(){return p.useEffect(()=>()=>{gs.getItem(hs.TasksHasSeenProjectDisclaimerBanner)||gs.setItem(hs.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(ea,{icon:e.jsx(Or,{}),title:e.jsx(N,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(N,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{gs.setItem(hs.TasksHasSeenProjectDisclaimerBanner,!0)}})}function rm(){const{store:t}=le(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Wl,{threadId:s}):null}function im(){const{store:t}=le(),s=t.useSharedProps();return s?e.jsx(Vl,{...s}):null}function lm(){const{store:t}=le(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(Yd,{clientThreadId:s,composerController:n})}function cm(){const{store:t}=le(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(Vd,{clientThreadId:s})}const um="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",dm="https://help.openai.com/en/articles/8932459",dp=()=>{const{isLoading:t,eligible:s}=rt(zt.hasSeenShibaHomeNux),{isUnauthenticated:n}=st(),[o]=ql(),c=Fs()?.isQuorum(),a=ot(at),r=ee(),m=he(r,"2781425969");return n||!m||o||c||a?"hide":t?"loading":s?"show":"hide"};function Pa(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:ge.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"}),theme:Et.Image},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:ge.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"}),theme:Et.Image},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:ge.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"}),theme:Et.Image},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:ge.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"}),theme:Et.Image}]}const mp=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=rt(zt.hasSeenShibaHomeNux),o=Me(),i=Lt(),c=ee(),a=Hr(c,"2604379743").value,r=typeof a.nux_video_url=="string"?a.nux_video_url:um,m=typeof a.nux_image_url=="string"?a.nux_image_url:"",[u,x]=p.useState(!1),g=Bo(),l=Yl(z.PictureV2,s);p.useEffect(()=>{j.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const f=pe(),S=Pa(f),y=()=>{n(),t(),j.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},k=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{l&&g(z.PictureV2,{analyticsMetadata:{clientThreadId:s}}),o.focus()})}),o.setAutocompletions(S)};return e.jsx(e.Fragment,{children:e.jsxs(zr,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Gr,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!u&&e.jsx("img",{src:m,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:r,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>x(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(N,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(N,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:A=>e.jsx("a",{href:dm,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:A})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(N,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(Je,{color:"secondary",onClick:y,className:"flex-1",children:e.jsx(N,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(Je,{color:"primary",onClick:()=>{k(),i("/?model=gpt-4o"),j.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(N,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})};function mm({suggestions:t,composerController:s,onSelect:n,onChange:o}){const i=Yo(),c=p.useCallback((l,f,S,y)=>{if(f.onSelectOverride)return f.onSelectOverride(l,f,S,y);n?.(f,S,y),i(l,f,S,y)},[n,i]),[a,r]=p.useState(()=>t.length>0),[m,u]=p.useState(-1),[x,g]=p.useState(!1);return p.useEffect(()=>{const l=f=>{if(!f.isComposing)if(f.key==="ArrowDown"){const S=m===t.length-1?0:m+1;u(S),o?.(S,!0,t[S])}else if(f.key==="ArrowUp"){f.preventDefault();const S=m<=0?t.length-1:m-1;u(S),o?.(S,!0,t[S])}else f.key==="Enter"&&!f.shiftKey&&t[m]&&c(f,t[m],t,m)};return s.subscribe("keydown",l)},[t,m,o,c,s]),p.useEffect(()=>s.subscribe("blur",()=>{u(-1),r(!1),o?.(-1,!1)}),[s,o]),p.useEffect(()=>s.subscribe("focus",()=>r(!0)),[s]),p.useEffect(()=>{if(!x){const l=()=>{g(!0),window.removeEventListener("mousemove",l)};return window.addEventListener("mousemove",l),()=>{window.removeEventListener("mousemove",l)}}},[x]),p.useEffect(()=>{u(-1),o?.(-1,!1),g(!1)},[t,o]),e.jsx(Pe.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:Z("w-full flex-col p-2.5 max-sm:px-0",a?"flex":"hidden"),children:t.map((l,f)=>e.jsxs(Pe.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:f*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[f>0&&e.jsx("div",{className:Z("h-[1px] opacity-60 max-lg:hidden",m===f||m===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),e.jsxs("button",{className:Z("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",m===f?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:S=>{S.preventDefault(),c(S,l,t,f)},onMouseDown:S=>{S.preventDefault()},onMouseEnter:()=>{x&&(u(f),o?.(f,!1,l))},onMouseLeave:()=>{u(-1),o?.(-1,!1,l)},children:[l.icon?e.jsx("span",{className:"text-token-text-secondary icon me-2 flex-none",children:l.icon}):null,e.jsx("span",{className:"text-sm whitespace-pre-wrap",children:l.autocompletionChunks&&l.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:l.autocompletionChunks.map((S,y)=>e.jsx("span",{className:Z(S.className??(S.isMatched?"text-token-text-tertiary":"text-token-text-primary")),children:S.text},y))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:Z(l.type===ge.Starter||l.type===ge.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:l.title}),e.jsx("span",{className:"text-token-text-primary",children:l.body})]})})]}),f>0&&e.jsx("div",{className:Z("h-[1px] opacity-60 lg:hidden",m===f||m===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},l.id??f))})}function pm(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const o=[];let i=0;for(let r=0;r<s.length&&(i<t.length&&t[i]===s[r]&&(o.push(r),i++),i!==t.length);r++);const c=[];let a=0;if(o.forEach(r=>{if(r>a){const m=n.slice(a,r);m&&c.push({text:m,isMatched:!1})}c.push({text:n[r],isMatched:!0}),a=r+1}),a<s.length){const r=n.slice(a);r&&c.push({text:r,isMatched:!1})}return fm(c)}function fm(t){if(t.length===0)return t;const s=[t[0]];for(let o=1;o<t.length;o++){const i=s[s.length-1],c=t[o];i.isMatched===c.isMatched?i.text+=c.text:s.push(c)}const n=s.filter(o=>o.isMatched).reduce((o,i)=>o+i.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}async function gm(t=8,s=null){const n=await qr.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:s}},authOption:Yr.SendIfAvailable});return Lo.addFirstTiming("load.promptStarters"),n}function hm(t=8,s=null){return _r({queryKey:["promptStarters",t,s],queryFn:()=>gm(t,s)})}function So(t){return($l(t)?t.promptStarters:t.gizmo.display.prompt_starters)?.map(s=>({type:ge.Starter,title:"",body:s,prompt:s}))}const xm=()=>{const t=ee(),s=Wr(t),n=aa(),o=Ql(Xl),i=Ve(t),c=i?s.getLayer("4031588851"):s.getLayer("3533083032"),a=i?s.getLayer("4031588851",{disableExposureLog:!0}):s.getLayer("3533083032",{disableExposureLog:!0});return i?n==null?!1:Date.now()/1e3-n.created<a.get("new-user-age-seconds",14*24*60*60)&&c.get("web-enable-for-new-users",!1):o<a.get("new-user-message-count",20)&&c.get("web-enable-for-new-users",!1)},va=({clientThreadId:t,limit:s,shouldBeEnabledForDefaultAssistant:n,isModelLoaded:o,modelSlug:i})=>{const c=Me(),a=No(),r=pe(),{clearAllSystemHintModeTriggers:m,setThreadSystemHintMode:u}=Ht(),x=Q(t,C=>C?.mode),g=oa(x?.kind===Ge.GizmoInteraction?x.gizmo_id:void 0).data,{gizmoEditorData:l,mode:f}=Ds(),S=xm(),y=Kl(x),k=We(),A=S&&n&&!y&&!k?.isEnterprisey(),{data:R,isSuccess:I}=Ar({...hm(s,i),enabled:A});if(a==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&l)return{promptStarters:So(l)??[],isLoading:!1,isSuccess:!0};if(g!=null)return{promptStarters:So(g),isLoading:!1,isSuccess:!0};if(!A)return{promptStarters:[],isLoading:!1,isSuccess:!0};const T=R?.items.map(C=>({type:ge.Starter,id:C.id,title:C.title,body:C.description,prompt:C.prompt,category:C.category,oneliner:C.oneliner,theme:C.theme,requires_file_upload:C.requires_file_upload}))??[],v=(C,D,L,V)=>{if(D.type===ge.Starter&&D.category==="dalle"){requestAnimationFrame(()=>{m(),u(z.PictureV2,!0,{}),c.focus()}),c.setAutocompletions(Pa(r));return}const h=D.title;c.setAutocompletions([]),c.focus(),c.setText(h),requestAnimationFrame(()=>{const Y=T.filter(G=>G.theme===D.theme).map(G=>{const W=Vr(G.oneliner),F=W.startsWith(G.title);return{...G,title:F?`${G.title} `:"",body:F?G.body:W,autocompletionChunks:pm(h,W),type:ge.Autocomplete}});c.setAutocompletions(Y),Y.length>0&&Ts(Y,t),Jl(D,V,t)})},P=T?.reduce((C,D)=>(D.theme&&!C[D.theme]&&(C[D.theme]=D),C),{}),b=[];if(P)for(const C in P)C!=="For you"&&b.push(P[C]);const w=b.length>0,M=!!(I&&w&&o);return Ue.markStart("StarterPromptChips",Ue.NS_COMPOSER),M&&Ue.markRendered("StarterPromptChips",Ue.NS_COMPOSER),{onSelectStarterPrompt:v,shouldShowStarterPrompts:M,promptStarters:b}};function bo({clientThreadId:t,onClick:s}){p.useEffect(()=>{tc(t)},[t]);const n=pe();return e.jsx(Pe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(ia,{onClick:()=>{sc(t),s()},label:n.formatMessage(Am.moreStarterPrompts)})})}function Sm({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:i}){const c=t.theme??t.title,a=Yo(),{mutate:r}=Zl(),m=t.category==="onboarding"?u=>{r({key:zt.hasUsedConversationalOnboardingStarterPrompt}),a(u,t,s,n)}:u=>i?.(u,t,s,n);return e.jsx(ia,{disabled:o,onClick:m,icon:e.jsx(ec,{category:t.category,useV2Colors:!0}),label:c})}const bm=5,Cm=3;function ja({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:i,mobileLayout:c=!1}){const a=c?Cm:bm,[r,m]=p.useState(a),[u,x]=p.useState(!1),g=p.useRef(null),l=t.length<=r;p.useEffect(()=>{Ts(t.slice(0,a),o)},[o]),p.useEffect(()=>{if(!u&&!l&&g.current){const S=g.current,y=S.getBoundingClientRect(),k=y.width,A=Array.from(S.children);let R=0;for(let I=0;I<A.length&&A[I].getBoundingClientRect().right-y.left<=k;I++)R++;m(R),x(!0)}},[t,l,u]);const f=()=>{const S=t.slice(r,t.length).map(y=>({...y,isAdditional:!0}));S.length>0&&Ts(S,o),m(t.length),i()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:Z("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",u&&t.length>0?"opacity-100":"opacity-[0.01]",c?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:Z("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",l||c?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:g,children:[t.slice(0,r).map((S,y)=>e.jsx(Pe.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Sm,{starterPrompt:S,starterPrompts:t,index:y,disabled:n,onSelectStarterPrompt:s})},S.id??y)),c&&t.length>r&&e.jsx(bo,{clientThreadId:o,onClick:f})]}),!c&&t.length>r&&e.jsx(bo,{clientThreadId:o,onClick:f})]})}const pp=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,i]=p.useState(!1),c=Hs(),{prospectiveModelId:a}=ra(t),r=n?s:a??"auto",{promptStarters:m,shouldShowStarterPrompts:u,onSelectStarterPrompt:x}=va({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:r});return e.jsx(Pe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:Z(!o&&"h-[116px]"),children:u&&m&&e.jsx(ja,{starterPrompts:m,onSelectStarterPrompt:x,disabled:c,clientThreadId:t,onExpand:()=>i(!0),mobileLayout:!0})})},ym=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=st(),[i,c]=p.useState(!1),a=$r(),r=Hs(),{prospectiveModelId:m}=ra(s),u=n?t:m??"auto",{promptStarters:x,shouldShowStarterPrompts:g,onSelectStarterPrompt:l}=va({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:u});return e.jsx(Pe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:Z("hidden min-h-[108px] max-w-full",a?"@lg/thread:block":"lg:block",o&&i?"":"h-[70px]"),children:g&&x&&e.jsx(ja,{starterPrompts:x,onSelectStarterPrompt:l,disabled:r,clientThreadId:s,onExpand:()=>c(!0)})})},Am=Te({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),wa=ko.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function _m(){const{data:t,isLoading:s}=oc({cutId:"recent",limit:8}),{data:n,isLoading:o}=ac();return{isLoading:s||o,recent:t,pinned:n}}function km({query:t,onSelectGizmo:s,selectedIdx:n,currentModelId:o},i){const c=Kr(),a=p.useRef([]),{isLoading:r,recent:m,pinned:u}=_m();p.useImperativeHandle(i,()=>({handleEnterOnIndex:l=>{if(!g[l])return l<x.length?x[l].resource:"create"},getResultsLength:()=>x.length+1,scrollToItem:l=>{const f=a.current[l];f&&f.scrollIntoView({behavior:"instant",block:"nearest"})}}));let x=[];if(r)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Qr,{})});m&&x.push(...m.pages.flatMap(l=>l.list.items).map(l=>({resource:l.resource,from:"recent"}))),u&&x.push(...u.items.map(l=>({resource:l,from:"pinned"}))),x=nc(x,l=>l.resource.gizmo.id);const g=x.map(l=>l.resource.gizmo.tags?.includes(Gt.WorkspaceDisabled));return t&&t!==""&&(x=x.filter(l=>(l.resource.gizmo.display.name.toLowerCase()+l.resource.gizmo.display.description?.toLowerCase()+l.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[x.map((l,f)=>e.jsx("div",{ref:S=>{a.current[f]=S},tabIndex:f,onClick:()=>{g[f]||s(l.resource)},children:e.jsx(wm,{gizmoResource:l.resource,from:l.from,showDescription:c,isSelected:n===f,grayedOut:g[f],currentModelId:o})},l.resource.gizmo.id)),e.jsx("div",{ref:l=>{a.current[x.length]=l},tabIndex:x.length,onClick:()=>{s("create")},children:e.jsx(vm,{isSelected:n===x.length})},"create")]})}const Pm=p.forwardRef(km),vm=({isSelected:t})=>e.jsx(wa,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(kr,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(ca,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(N,{...Ys.dropdownCreateLabel})})]})}),jm=({onClick:t,onClose:s,currentModelId:n})=>{const[o,i]=p.useState(null),c=p.useRef(null),a=p.useRef(null),[r,m]=p.useState(0),u=pe(),x=g=>{j.logEvent("Mentions Click Gizmo",{gizmo_id:g==="create"?"create":g.gizmo.id}),g!=="create"&&t(g)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:u.formatMessage(Ys.searchPlaceholder),ref:c,onKeyDown:g=>{if(g.nativeEvent.isComposing)return;const l=a.current?.getResultsLength()??0;if((g.key==="Escape"||g.key==="Backspace"&&!o)&&(g.preventDefault(),s()),g.key==="Enter"||g.key==="Tab"){g.preventDefault();const f=a.current?.handleEnterOnIndex(r);if(!f)return;f==="create"?(window.open("/gpts/editor","_blank"),s()):x(f)}if(g.key==="ArrowDown"&&r<l-1){g.preventDefault();const f=r+1;a.current?.scrollToItem(f),m(f)}if(g.key==="ArrowUp"&&r>0){g.preventDefault();const f=r-1;a.current?.scrollToItem(f),m(f)}},onChange:g=>{i(g.target.value),m(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Pm,{ref:a,query:o,selectedIdx:r,onSelectGizmo:x,currentModelId:n})]})},Co=({onClick:t,onClose:s,currentModelId:n})=>{const o=Do(),i=!!o;return Vs(()=>{j.logEvent("Mentions Opened",{gizmo_selector_disabled:i})}),i?e.jsx(ya,{clientThreadId:Ps,rateLimitInfo:o}):e.jsx("div",{onBlur:c=>{c.currentTarget.contains(c.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(jm,{onClick:t,onClose:s,currentModelId:n})})};function wm({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:i,currentModelId:c}){const a=!!t.gizmo.tags?.includes(Gt.FirstParty),r=rc(t.tools)&&!c.startsWith("gpt-4o")&&!c.startsWith("gpt-4-1");return e.jsxs(wa,{className:Z(o?"bg-token-main-surface-secondary":"",i&&"opacity-50"),children:[e.jsx(la,{isFirstParty:a,src:t.gizmo.display.profile_picture_url,className:Z("icon-xl",i&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),r&&e.jsx("span",{className:"text-token-text-tertiary shrink-0",children:e.jsx(N,{...Ys.customActionsModelNote})}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(ic,{className:"icon-sm"}):e.jsx(lc,{className:"icon-sm"})})]})]})}const Ys=Te({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"},customActionsModelNote:{id:"TaggingDropdown.customActionsModelNote",defaultMessage:"[GPT-4o or GPT-4.1]"}});function Tm(t){if(t.length!==1)return!1;const{file:s,fileId:n}=t[0],o=pc(s)&&!!s?.type&&s.type.startsWith("image/"),i=n!=null&&!!s&&Jr(s.name);return o||i}function Ta({files:t,selectedApps:s=[],className:n,activeSystemHintType:o}){const i=Xr(),c=Is(),a=ua.useStore(),{updateSystemHint:r}=Ht(),{clientThreadId:m}=Hi(),u=Tm(t),x=u&&o!==z.PictureV2,g=cc();return e.jsxs("div",{className:n,children:[g.map(l=>e.jsx(uc,{textdocId:l.tempTextdocId,userCreatedTextdoc:l},l.tempTextdocId)),s.map(l=>e.jsx(dc,{selectedApp:l},l.id)),t.map(l=>e.jsx(mc,{borderRadius:"2xl",width:i?"normal":"wide",onRemoveFileClick:()=>{Ze.remove(c,l.tempId,"none"),a.removeFile(l.tempId)},useLargeImageThumbnailStyle:u,onImageEditClick:x?()=>{r(z.PictureV2,{clientThreadId:m})}:void 0,file:l.file,fileId:l.fileId??void 0,contextConnectorInfo:l.contextConnectorInfo,loadingPercentage:l.status===Fo.Uploading?l.progress:void 0},l.tempId))]})}const Mm=5,Em=p.memo(function(s){return Rm(s),Im(s),Bm(),null});function Rm(t){const{store:s}=le(),n=s.useSetSharedProps();vs(()=>{n(t)},[t,n])}function Im(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=le(),i=p.useRef({top:o.useContentAreaApi(tt.HeaderTop),bottom:o.useContentAreaApi(tt.HeaderBottom)}).current,c=fc(s),{shouldShowBannerSignup:a,shouldShowBannerTermsDisclaimer:r}=Nm(s),m=Kd(s,t.composerController),u=qd(s),x=gc(t);hc(t);const g=xc(),l=Sc(),f=bc(t),S=Cc(s),y=yc(t),k=Ac(s),A=_c(s),R=Pd(),{eligible:I}=rt(kc),T=Pc(),v=vc(),P=jc(),b=wc(),w=Tc(s),M=Mc(s),C=Ec(),D=Rc(s),L=Ic(G=>G.shouldShowAudioParagenPrompt),V=Q(s,G=>G?.modelId),h=Ws(s),Y=nt();vs(()=>{L?i.top.set(_.AudioParagenPrompt):V&&h?.kind===Ge.GizmoInteraction&&h.gizmo&&Zr(V,h.gizmo)?i.top.set(_.ProjectConversationTaskNoFileAccess):y.eligible?i.top.set(_.AdvancedVoiceOnMobileAnnouncement):r?i.top.set(_.BannerTermsDisclaimer):m?i.top.set(_.BannersRateLimit):u?i.top.set(_.BannersBeaconUI):C?i.top.set(_.BannerPlusUpsell):k?i.top.set(_.JawboneAnnouncement):A?i.top.set(_.JawboneMaxActiveAnnouncement):x.eligible?i.top.set(_.BannerSidekickAnnouncement):g?i.top.set(_.MoonshineAnnouncement):l?i.top.set(_.CustomizeChatGPTAnnouncement):f?i.top.set(_.SearchBrowserExtensionReactiveAnnouncement):R?i.top.set(_.PromoRedemptionAnnouncement):I?i.top.set(_.OperatorAnnouncement):P?i.top.set(_.ReferralProgramUpsellAnnouncement):n?i.top.set(_.PromptTextareaAction):a?i.top.set(_.BannerSignup):S?i.top.set(_.BannerMemoryFull):T?i.top.set(_.ReferrerRedemptionAvailableAnnouncement):v?i.top.set(_.RefereeRedemptionAvailableAnnouncement):b?i.top.set(_.StudentsUpsellAnnouncement):w?i.top.set(_.ModelDeprecationBanner):M?i.top.set(_.TeamsContextualAnswersUpsell):D?i.top.set(_.LanguageUpsellBanner):i.top.set(null)},[i,Y,n,r,a,m,x,S,y]),vs(()=>{c&&i.bottom.set(na.DallePromptControls)},[i,c])}function Bm(){const{store:t}=le();p.useEffect(()=>()=>{t.reset()},[t])}function Nm(t){const s=ee(),{isUnauthenticated:n}=st(),o=Se(s,"3637408529",{disableExposureLog:!0}),c=Se(s,"3637408529").get("no_auth_banner_signup_rate_limit",Mm),a=o.get("should_show_no_auth_signup_banner",!0),r=Bc(l=>l.bannerDisclaimerClientThreadId),m=Nc(),u={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[x,g]=Q(t,l=>[H.getConversationTurns(l).filter(f=>f.role===Uo.User).length,Lm(H.getCurrentNode(l)?.message)]);return t&&(u.shouldShowBannerTermsDisclaimer=g&&n&&x===1&&!m&&(r==null||r===t),u.shouldShowBannerSignup=a&&g&&n&&x>0&&x%c===0),u}function Lm(t){return t?.author.role===Uo.Assistant&&ei(t)}function Dm({clientThreadId:t,icon:s,modelSupportedImageMimeTypes:n,isLoadingConnectors:o,connectorConfig:i,onSelectConnector:c,onConnectorOauthRedirect:a,openFileDialog:r,isDisabled:m=!1,highlightTooltip:u=!1,showLabel:x,disabledReason:g,currentModelName:l}){const f=pe(),S=Dt(),[y,k]=p.useState(!1),A=p.useRef(!1),R=ot(at),I=C=>{if(!C&&A.current&&!o)r();else if(C&&!o&&i.size===0&&T.length===0){r();return}k(C),C&&(j.logEventWithStatsig("Composer: Open Plus Menu","chatgpt_web_composer_plus_menu_open"),A.current=!0,setTimeout(()=>{A.current=!1},250))},{desktopConnectors:T}=da(n),v=n.length>0,P=e.jsxs(e.Fragment,{children:[R&&e.jsx(ma,{}),e.jsx(pa,{isLoadingConnectors:o,connectorConfig:i,onConnectorClick:c,onOauthRedirect:a}),e.jsx(Ma,{modelSupportedImageMimeTypes:n}),e.jsx(qs,{openFileDialog:r,showMenuForNoAuth:!1,modelSupportsImages:v})]}),b=m||S!=null,w=p.useRef(!1),M=e.jsxs(se.Root,{open:y,onOpenChange:I,children:[e.jsx(Bt,{clientThreadId:t,rateLimitPopup:S,highlightTooltip:u,disabled:b,disabledReason:g,currentModelName:l,children:e.jsxs(se.BasicTrigger,{className:"composer-btn",disabled:b,id:"upload-file-btn","aria-label":Wt(f,b,g,l),children:[s,x&&e.jsx(Qo,{})]})}),e.jsx(se.Portal,{children:e.jsx(se.Content,{alignOffset:-8,onEscapeKeyDown:()=>{w.current=!0},side:"bottom",size:"small",onCloseAutoFocus:C=>{w.current||C.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:P})})]});return e.jsx("div",{className:"flex flex-col",children:M})}const Ma=({modelSupportedImageMimeTypes:t})=>Oo()?e.jsx(Fm,{modelSupportedImageMimeTypes:t}):null,Fm=({modelSupportedImageMimeTypes:t})=>{const{desktopConnectors:s}=da(t);return e.jsx(e.Fragment,{children:s.map(n=>e.jsx(Lc,{entry:n},n.key))})},Um=({command:t,isHighlighted:s,onHighlight:n,onClick:o})=>e.jsx(zo,{as:"div",hasManagedFocus:!0,disabled:t.disabled,highlighted:s,icon:t.icon,label:t.title,onPointerMove:n,onClick:o}),Om=t=>{"use forget";const s=Pr.c(15),{hint:n,isHighlighted:o,onHighlight:i,onClick:c}=t,a=fa(n.systemHint);let r;s[0]!==n?(r=e.jsx(Uc,{hint:n,isNextToLabel:!0}),s[0]=n,s[1]=r):r=s[1];let m;s[2]!==n.name||s[3]!==o||s[4]!==c||s[5]!==i||s[6]!==a.blockedLabel||s[7]!==a.isBlocked||s[8]!==r?(m=e.jsx(zo,{as:"div",hasManagedFocus:!0,disabled:a.isBlocked,highlighted:o,icon:r,label:n.name,secondary:a.blockedLabel,onPointerMove:i,onClick:c}),s[2]=n.name,s[3]=o,s[4]=c,s[5]=i,s[6]=a.blockedLabel,s[7]=a.isBlocked,s[8]=r,s[9]=m):m=s[9];const u=m;if(a.remainingLabel){const x=a.isBlocked?"left":"center";let g;return s[10]!==u||s[11]!==a.remainingLabel||s[12]!==a.remainingLabelSecondary||s[13]!==x?(g=e.jsx(Ms,{side:"right",labelTextAlign:x,label:a.remainingLabel,secondaryLabel:a.remainingLabelSecondary,contentClassName:"cant-hover:hidden",triggerAs:null,children:u}),s[10]=u,s[11]=a.remainingLabel,s[12]=a.remainingLabelSecondary,s[13]=x,s[14]=g):g=s[14],g}return u},Hm=({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o})=>{const i=p.useMemo(()=>[...t,...s],[t,s]),c=Dc(),a=Ho(o),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:m}=Ht(),[u,x]=p.useState(void 0),[g,l]=p.useState(0),f=p.useMemo(()=>u?i.filter(b=>!!("systemHint"in b&&Fe(b.systemHint,u.text)||"command"in b&&Fe(b.command,u.text)||b.aliases?.some(w=>Fe(w,u.text))||b.regexMatches?.some(w=>Fe(w.replace(/[\^$()]/g,""),u.text))||"name"in b&&Fe(b.name,u.text)||"title"in b&&Fe(b.title,u.text))):[],[i,u]);p.useEffect(()=>{n.view.dispatch(zi(n.view.state.tr,{onHintMatch(b){x(w=>si(w,b)?w:b)}}))},[n]);const S=p.useCallback(b=>{l(w=>{const M=f.length;for(let C=0;C<M;C++){const D=(w+M+(C+1)*b)%M,L=f[D];if(!("systemHint"in L?c.includes(L.systemHint):L.disabled))return D}return-1})},[f,c]),y=p.useRef(S);y.current=S;const k=f.length===0;p.useEffect(()=>{l(-1),y.current(1)},[f]);const A=f[g],R=p.useCallback(()=>{u?.range&&n.delete(u.range.from,u.range.to)},[u,n]),I=({hintToSave:b=A,expectPerfectMatch:w})=>{if(!u||!A)return!1;const M=u.text.toLocaleLowerCase();if(w&&("command"in b?b.command.toLocaleLowerCase()!==M:b.name.toLocaleLowerCase()!==M)&&b.aliases?.every(L=>L.toLocaleLowerCase()!==M))return!1;if(R(),Rt(n.view),"command"in b)return b.onSelect(),!0;j.logEvent("System Hint Selected",{system_hint:b.systemHint,conversation_id:a??Ps});const C={clientThreadId:o};m();const D=b.systemHint===z.Search;return r(b.systemHint,!0,C,D?Fc.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),!0},T=p.useRef(I);T.current=I;const v=p.useRef(u);v.current=u;const P=n.view;return p.useEffect(()=>(k||Ed(P,b=>{if(b==="up")y.current(-1);else if(b==="down")y.current(1);else if(b==="cancel")Rt(P),Gi(P);else{if(b==="submit")return Rt(P),T.current({expectPerfectMatch:!1});if(b==="checkMatch")return T.current({expectPerfectMatch:!0})}}),()=>Rt(P)),[k,P,A,R]),p.useEffect(()=>{k||j.logEvent("System Hint List Opened",{conversation_id:a??Ps})},[k]),k?null:e.jsx(ti,{className:"max-w-60",onPointerDown:b=>{b.preventDefault()},children:f.map((b,w)=>"command"in b?e.jsx(Um,{command:b,isHighlighted:w===g,onHighlight:()=>l(w),onClick:()=>{I({hintToSave:b,expectPerfectMatch:!1}),n.focus()}},b.command):e.jsx(Om,{hint:b,isHighlighted:w===g,onHighlight:()=>l(w),onClick:()=>{I({hintToSave:b,expectPerfectMatch:!1}),n.focus()}},b.systemHint))})};function yo({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}){return n instanceof Md?e.jsx(Hm,{slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}):null}function Fe(t,s){return t.toLocaleLowerCase().startsWith(s.toLocaleLowerCase())}function zm({clientThreadId:t,modelSupportedImageMimeTypes:s,openFileDialog:n,historyDisabled:o,isDisabled:i,highlightTooltip:c,disabledReason:a,currentModelName:r,isLoadingConnectors:m,connectorConfig:u,onSelectConnector:x,onConnectorOauthRedirect:g,showLabel:l,showUpsell:f,hideBorder:S,isSmall:y,showMenuForNoAuth:k,visualTreatment:A}){const R=Oo(),{gdriveStatus:I,o365Status:T}=ni(),{isUnauthenticated:v}=st(),P=o?"text-white":c?"text-brand-blue-800":"",b=!f&&(I!=="false"||T!=="false"||R),w=v?ws:ca,M=e.jsx(w,{"aria-label":"",className:Z("icon",P)}),C=s.length>0,D=b?e.jsx(Dm,{clientThreadId:t,icon:M,showLabel:v&&l,modelSupportedImageMimeTypes:s,isLoadingConnectors:m,connectorConfig:u,onSelectConnector:x,onConnectorOauthRedirect:g,openFileDialog:n,isDisabled:i,highlightTooltip:c,disabledReason:a,currentModelName:r}):e.jsx(Ud,{isSmall:y,hideBorder:S,clientThreadId:t,openFileDialog:n,showLabel:l,showUpsell:f,icon:M,isDisabled:i,highlightTooltip:c,disabledReason:a,currentModelName:r,visualTreatment:A,showMenuForNoAuth:k,modelSupportsImages:C});return e.jsx(Oc,{showBackground:c,className:"bg-brand-blue-800/20",children:D})}const Gm=({layoutMode:t,clientThreadId:s,composerController:n,pendingFiles:o,hasFiles:i,placeholder:c,isTemporaryChat:a,state:r,inputState:m,disableReason:u,gizmoId:x,replyRegions:g,includeSidebarContextTray:l,onSubmit:f,leadingAction:S,legacyFooterActions:y,legacySuggestionsPopoverContent:k,activeSystemHint:A,hideSystemHint:R=!1,onRemoveSystemHint:I,contextualAnswerUserConnectionData:T,fileInput:v,isExpandedByDefault:P,expandOnMultilineInput:b})=>{const w=ot(at),M=To(s),C=p.useCallback(E=>e.jsx(Hc,{inputState:m,state:r,onSubmit:f,composerController:n,clientThreadId:s,gizmoId:x,disableReason:u,disableTooltip:E}),[m,r,f,n,s,x,u]),{whisperControls:D,waveContainerRef:L}=Wi({composerController:n,renderInComposer:C,composerType:"composer-btn"}),{controlsDisabled:V,waveformData:h,waveWidth:Y}=ze(n.store),G=ga(E=>E.selectedApps),W=ha()&&G.length>0,F=i||W,{fontSize:q}=Gs();return e.jsxs(zc,{isTemporaryChat:a,composerController:n,isExpandedByDefault:P,expandOnMultilineInput:b,onSubmit:f,layoutMode:t,backgroundClassName:w?"px-2 shadow-none! dark:border-token-border-heavy border-t border-gray-100 rounded-none":void 0,children:[e.jsx(Gc,{children:V?h?e.jsx("div",{className:"max-w-full min-w-0 flex-1",ref:L,children:e.jsx(Wc,{className:"h-14",waveform:h,containerWidth:Y,scaleFactor:10,initialValue:Vi})}):null:e.jsx(qi,{composerController:n,placeholder:c,fontSize:q})}),v&&e.jsx(Vc,{children:v}),g&&g.length>0&&e.jsx(Ss,{children:e.jsx(qc,{replyRegions:g})}),F&&e.jsx(Ss,{children:e.jsx(Ta,{files:o,selectedApps:G,activeSystemHintType:A?.systemHint,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),l&&e.jsx(Ss,{children:e.jsx(Yc,{})}),S&&e.jsx($c,{children:S}),y?.map((E,K)=>e.jsx(bs,{children:E},`legacy-footer-action-${K}`)),A&&!R&&e.jsx(Kc,{children:e.jsx(Qc,{activeSystemHint:A,onRemoveSystemHint:I})},"active-hint-tag"),A&&M&&e.jsx(bs,{children:e.jsx(Xc,{activeSystemHint:A??void 0,clientThreadId:s,connectionStatuses:T?.connection_statuses,currentModelConfig:M})},"sources-tag"),A?.systemHint===z.PictureV2&&e.jsx(bs,{children:e.jsx(Jc,{composerController:n})},"image-style-picker"),!1,e.jsx(Zc,{children:k},"legacy-suggestions-popover"),e.jsx(eu,{children:D})]})},Wm=Us(()=>Os(()=>import("./mwt17hczy9h6nm3a.js"),__vite__mapDeps([8,1,3,4,2,5,9,10])).then(t=>t.ImageGenComposer)),Vm=1,qm=3e3;function Ym({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:i,disableDraftPersistence:c=!1,areModelsLoading:a,clientThreadId:r,isNewThread:m,isCompletionInProgress:u,className:x,disabled:g=!1,disabledReason:l,canPause:f=!1,canContinue:S=!1,isInteractableSharedThread:y,onComposerInput:k,onComposerChange:A,onAutocompleteSelect:R,headerClassName:I,hideHeader:T,onTaggingDropdownOpen:v,onTaggingDropdownClose:P,onlyAllowImageUploads:b,layoutMode:w}){"use forget";Ue.markStart("PromptTextarea"),Ue.markRendered("PromptTextarea");const M=ot(at),C=ee(),D=p.useRef(null),[L,V]=vr();p.useEffect(()=>{L.has("show_github_repo_modal")&&(Go(C,tu),V(d=>(d.delete("show_github_repo_modal"),d)))},[L,V,C]);const h=Me();su(h),nu();const Y=aa(),G=n?.isTeam(),W=Ve(C),F=pe(),q=Ft(),E=Is(),K=ua.useStore(),[ne,oe,ce,it]=Q(r,d=>[H.getCurrentLeafId(d),H.getRequestId(d),H.findNode(d,B=>!!B.message.metadata?.b1de6e2_s),!!d?.interruptionInProgress&&!!H.getCurrentNode(d)?.message.metadata?.n7jupd_message]),{gizmoEditorData:Ee,mode:ue,getGizmoId:Vt}=Ds(),$s=No(),qe=oi(),Ea=ou(),fe=Ho(r),qt=!!Do(),Ra=au.useIsEnabled(r),lt=!!Hs(),O=nt(),be=Bo(),Ks=ai.useState(({locked:d})=>d),Ia=ri(),{connectionInstanceData:Ba,isLoading:Na}=ii({skip:!Ia}),{selectedSources:Qs,selectedMCPSources:ct,addSource:ut}=ru(r);p.useEffect(()=>{const d=L.get("add_source");d&&O&&(ut(d),L.delete("add_source"),V(L))},[O,ut,L,V]);const Xs=iu(C);li({skip:!Xs,productSku:no.PROMPT_TEXT_AREA});const{platformConnectors:Js}=Wo(Xs&&(ct?.size??0)>0,no.PROMPT_TEXT_AREA),La=p.useMemo(()=>Array.from(ct??[]).map(d=>Js.get(d)).filter(d=>d!==void 0),[Js,ct]),Yt=p.useRef(0),$t=p.useRef(!1);let U=Ws(r),dt=U&&"gizmo"in U?U.gizmo:void 0;const Da=ci(),mt=dt?.gizmo.id??Da,Kt=lu(mt),Fa=cu(),Zs=uu(r),[de,pt]=p.useState(null);de!==null&&(U={gizmo:de,gizmo_id:de.gizmo.id,kind:Ge.GizmoInteraction},dt=de);const Re=As(i,U,O),en=Dt(),tn=Rs(C).flags,ft=tn?.includes(Bs.NoAuthEnableFileUploads),Qt=Q(r,d=>d?.effortMode??null),sn=!!Qt&&Qt!=="default",{systemHints:nn}=ui(),ae=p.useMemo(()=>nn?.filter(d=>du({systemHint:d,modelConfig:i,conversationMode:U,isTemporaryChat:qe})),[nn,i,U,qe]),Ua=ae==null||ae.length>0,Ce=p.useMemo(()=>(O&&ae?.find(d=>d.systemHint===O))??null,[ae,O]),Xt=p.useCallback(()=>{be(null,{analyticsMetadata:{clientThreadId:r}})},[be,r]),Jt=mu(o,Ce?.systemHint??null);pu(p.useCallback(()=>{sn&&we(r,d=>{d.effortMode="default"})},[sn,r])),Rd({serverThreadId:fe,clientThreadId:r,composerController:h,currentModelId:o,account:n,getIsDisabled:p.useCallback(()=>!1,[]),onReset:()=>{we(r,d=>{d.effortMode="default"})},onInfer:d=>{we(r,B=>{B.effortMode=d})},isInferEnabledForModel:i?.enableInfer});const on=!g&&(Re!==je.None||a)&&(W||ft),me=ks(i,U),Zt=jo(i,U);let re=_s(d=>d.files);const[gt]=p.useState(()=>fu());ue==="magic"?re=re.filter(d=>d.gizmoId!=null):re=re.filter(d=>d.gizmoId==null);const Oa=gu(),Ie=re.length>0||Oa,an=_s(ji.hasUploadInProgress),rn=ga(d=>d.selectedApps),Ha=ha()&&rn.length>0,za=hu(r),es=h.useState(d=>xu({currentModelConfig:i,composerController:d})),ln=et(h.isEmpty$),cn=!ln,ht=!es&&!an&&(cn||Ie),un=(Re===je.Multimodal?Ns:Ls)-re.length,ts=un<=0,Ga=Ce?.systemHint===z.Research,Wa=he(C,"3544641259"),{selectedRepos:ss}=Su(r),dn=(Ga||Jt)&&Wa&&Qs?.size===0&&ct?.size===0,ns=he(C,"2007855518"),mn=ce?.message.metadata?.async_task_id,os=bu(d=>mn?d.tasks[mn]:null),as=os?.status===Cu.RUNNING,pn=yu(Tt(r)||r)?.value,Va=pn===oo.STREAMING,qa=pn===oo.REALTIME,xt=u&&f||Va||qa||as&&ns,Be=ht&&!g&&!lt&&(!xt||Zs)&&!dn,[fn,Ya]=p.useState(!1),{targetedContent:gn,setTargetedContent:St}=Au(),ie=gn?.isFocusedViewContent&&!Ea?void 0:gn;p.useEffect(()=>{!ie||cs.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>h.focus()))},[ie]);const{getUpsellLabelType:$a,getUpsellShowsAttach:Ka}=_u(),{isToolsInPlusMenu:hn,showConnectedApps:xn,isSingleLine:Sn,hasAddFileSlashCommand:bn}=Gs(),Qa=Fs()?.isQuorum(),Ye=Ua&&!Ks&&!Qa&&(U==null||U?.kind===Ge.PrimaryAssistant||U?.kind===Ge.GizmoInteraction&&Kt),Xa=Ye&&W&&(!G||!Na)&&!ao(O)&&!hn,bt=ze(h.store,d=>d.controlsDisabled);p.useEffect(()=>{if(!Y?.id)return;const d=lo.getAndReset(Y.id,fe);d&&h.setText(d.inputText)},[Y?.id,fe,h]),p.useEffect(()=>{const d=L.get("prompt")??"";h.getCurrentText().length===0&&d.length>0&&h.setText(d)},[h,L]),p.useEffect(()=>{if(O!==z.Slurm)return;const d=L.getAll("sources");if(!d.length)return;const B=L.get("redirect_source"),X=d.map(te=>te.trim()).filter(mi);for(const te of X)ut(te);B==="suggested_ca_prompts"&&j.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[r,ut,L,be,V,O]),p.useEffect(()=>{fn!==Be&&(Ya(Be),Be&&pi(!0).then(d=>{ku.startEnforcement(d),fi.startEnforcement(d)}))},[Be,fn,U?.kind,$s]);const Ct=Po(i,U),{handleFileAccepted:Cn}=Ca(F,As(i,U,O),me,"mouse",Vt,Ct?.attachments),Ja=p.useCallback((d,B)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{h.focus()})}),Cn(d,B)),[h,Cn]),{getInputProps:yn,open:An,inputRef:_n}=xa({disabled:g||!on||ts,noClick:!0,onDropAccepted:Ja,onDropRejected:d=>ba(d,F,q,Re),multiple:!0,maxSize:wo,maxFiles:un,...vo(!W||b?me:Zt)}),ve=p.useCallback(()=>{j.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:Re.toString()}),An()},[An,Re]),kn=ze(gt),Pn=p.useCallback(()=>{h.eraseContent(),kn.clearMessages(),h.resize(Vm),h.usedDictation=!1,h.dictationEdited=!1,h.dictationAssetPointer=null,h.dictationAssetTTL=null;for(const B of re)Ze.remove(E,B.tempId,"none");if(Pu.markAllAsSent(),gi(C)){const B=hi(C,"269676899"),X=B.get("skip_search",!1);if(B.get("clear_all",!1)){const Ae=[z.Slurm,z.Tatertot];X&&Ae.push(z.Search),Ae.push(Vo),O&&!Ae.includes(O)&&be(null)}}},[h,kn,C,re,E,O,be]),vn=et(It.sidebarUrlTrayOpen$)&&M,Za=et(It.context$),jn=(d,B)=>{if(d.preventDefault(),g||!ht&&!B||!U||it)return;const X=h.getContentToSend(),te=od(X.content),{content:Ae,attachments:yr}=ad(E,te,i,U,O);we(r,wt=>{wt.hasModifiedSources=!1}),Fa(),t({sourceEvent:d,attachments:yr,content:Ae,contentToSend:X,conversationMode:U,hasSelectedApps:Ha,isMessageFollowupsEnabled:Ra,selectedApps:rn,isBridgedDesktopSidebar:M,shouldCollectSidebarContext:vn,desktopSidebarContext:Za,selectedGizmoTag:de,selectedRepos:{selectedAllRepos:ss.selectedAllRepos,selectedRepos:ss.selectedRepos?[...ss.selectedRepos]:null},selectedSources:Qs,selectedMCPConnectors:La,systemHints:O?[O]:[],usedDictation:h.usedDictation,dictationEdited:h.dictationEdited,dictationAssetPointer:h.dictationAssetPointer,dictationAssetTTL:h.dictationAssetTTL,effortMode:Qt,isN7jupdActive:Jt}),ie?.onCreateCompletion?.({serverThreadId:fe,currentLeafId:ne}),ie?.shouldPersistAcrossMessages!==!0&&St(void 0),uo.hideThreadHeader();for(const wt of re)wt.status===Fo.Ready&&K.addFile(wt);Pn()},er=d=>{St(d.targetedReply),d.targetedReply&&j.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:fe,sourceMessageId:d.messageId})},{maybeSetWaitingForRealtimeOnAbort:wn,isWatingForRealtimeStatusChange:tr}=vu(r),rs=p.useCallback(d=>{wn(),ju(d,void 0,!0)},[wn]),Tn=p.useCallback(()=>{ie?.onCleared?.({serverThreadId:fe,currentLeafId:ne}),St(void 0),h.focus()},[ne,fe,ie,St,h]),yt=wu(i?.tags,U?.kind),{showTaggingDropdown:is,isFocused:sr,autocompletions:ye}=ze(h.store),At=sr&&ye.length>0,Ne=yt&&is&&!Kt,Mn=Id(r),En=h.isReady();p.useEffect(()=>h.subscribe("keydown",d=>{Mn&&Bd(r);const B=h.getCurrentText();if(d.key==="@"){const X=h.getSelectionStart(),te=B.substring(0,X);(!te||/\s$/.test(te)||X===0)&&setTimeout(()=>h.setShowTaggingDropdown(!0),10)}else is&&h.setShowTaggingDropdown(!1);d.key==="Escape"&&pt(null)}),[h,En,is,Mn,r]);const Rn=Tu({toaster:q,canSubmit:Be,isTextContentTooLong:es,canAbortCompletion:f&&u,clientThreadId:r,isAutocompletionActive:()=>At&&$t.current,clearAutocompletions:()=>h.setAutocompletions([]),abortCompletion:()=>rs(r),requestCompletion:jn,isEmpty:ln,hasTargetedContent:ie!=null,clearTargetedContent:Tn,hasSystemHint:Ce!=null,removeSystemHint:Xt}),ls=p.useRef(Rn);ls.current=Rn,p.useEffect(()=>{const d=Object.fromEntries(Object.keys(ls.current).map(B=>[B,te=>{const Ae=ls.current[B];return Ae?Ae(te):!1}]));h.registerKeyHandlers(d),h.registerFileInput({openFileDialog:ve,inputRef:_n})},[h,ve,_n,En]),p.useEffect(()=>h.subscribe("paste",d=>{Mu({filePickerStore:E,event:d,intl:F,toaster:q,clientThreadId:r,conversationMode:U,currentModelConfig:i,getEditorGizmoId:Vt,modelSupportedImageMimeTypes:me,activeSystemHintType:O,setActiveSystemHintType:be,ctx:C})}),[F,r,U,i,Vt,me,h,q,E,O,be,C]);const In=d=>{qt||pt(d),h.trimLeadingText("@"),co(),h.setShowTaggingDropdown(!1)},nr=xi(r,gt,me,Ct?.attachments),or=p.useCallback(d=>{d.preventDefault(),rs(r),j.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Tt(r),currentLeafId:H.getCurrentNode(xe(r)).message.id,eventSource:"mouse"}),co()},[r,rs]),_t=p.useCallback(()=>{lo.set(Y?.id,fe,h.getCurrentText())},[fe,Y?.id,h]),cs=di(C);p.useEffect(()=>{Ee||cs.composer.autofocusDisabled$()||h.focus()},[h]),p.useEffect(()=>{if(me.length>0)for(const B of re)Eu(B.fileSpec?.mimeType,Zt)||Ze.remove(E,B.tempId,"none");else Ze.reset(E)},[o,E]),p.useEffect(()=>{(!yt&&de||qt)&&pt(null)},[yt,de,qt]);const ar=Se(C,"4031588851"),Bn=Se(C,"3637408529"),rr=Bn.get("is_in_composer_text_exp",!1),ir=Bn.get("composer_text","MESSAGE_CHATGPT"),lr=ar.get("composer_text","MESSAGE_CHATGPT"),cr=rr?ir:lr,[kt,ur]=(()=>{const d=l?Ru(l):void 0;if(d)return[d.placeholder,d.isLastingDisabledStyle];if(y)return[J.placeholderWithName,!1];if(ie?.placeholderTextOverride!=null)return[ie.placeholderTextOverride,!1];if(i?.id===Si)return[J.n7jupdSystemHintPlaceholder,!1];if(Ce){if(ao(Ce.systemHint))return xt?[J.n7jupdActivePlaceholder,!1]:[J.n7jupdSystemHintPlaceholder,!1];switch(Ce.systemHint){case z.Search:return[J.searchPlaceholder,!1];case z.Think:return[J.thinkPlaceholder,!1];case z.Slurm:return[J.connectorPlaceholder,!1];case z.Research:return[J.researchPlaceholder,!1];case z.Canvas:return[J.canvasPlaceholder,!1];case z.Picture:return[J.picturePlaceholder,!1];case z.PictureV2:return[J.pictureV2Placeholder,!1];case z.ContextualAnswers:return[J.contextualAnswersPlaceholder,!1]}}switch(cr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[J.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[J.placeholderAskNameAnythingVariant,!1];default:return[J.placeholderWithName,!1]}})(),Nn=Kt?m?F.formatMessage(Iu.newChatInProject,{projectName:dt?.gizmo.display.name??"this project"}):kt?F.formatMessage(kt,{name:"ChatGPT"}):"​":kt?F.formatMessage(kt,{name:Ee!=null?ue==="magic"?Bu:Ee.name||"GPT":dt?.gizmo.display.name??"ChatGPT"}):"​";p.useEffect(()=>h.subscribe("input",()=>{Nu.getState().isThreadHeaderVisible&&uo.hideThreadHeader()}),[h]),p.useEffect(()=>h.subscribe("input",()=>{Yt.current=performance.now(),k?.()}),[h,k]),p.useEffect(()=>{if(A)return h.subscribe("change",()=>{A()})},[h,A]);const us=bi()&&!!ye.find(d=>!!d.requires_file_upload),{connectorConfig:$e,isLoading:Ln}=Ci(),{onSelectConnector:Pt,onConnectorOauthRedirect:dr}=Lu({connectorConfig:$e,modelSupportedImageMimeTypes:me,modelAcceptedMimeTypes:Zt,attachmentsProductFeature:Ct?.attachments,onOauthRedirect:_t});Du($e,Pt);let Dn=null;const vt=[],Fn=[],Le=!g&&!ts&&(on||en!=null),Un=Ka(),mr=W||Un||ft,ds=Re===je.None&&!a?js.ModelNotSupported:ts?js.HasReachedMaxFiles:void 0,pr=yi("(width <= 510px)",Ai);w||(w=m&&!pr?"center":"bottom");const jt=me.length>0;if(W&&hn){const d=[e.jsx(qs,{openFileDialog:ve,modelSupportsImages:jt,showMenuForNoAuth:!1,isDisabled:!Le,disabledReason:ds,currentModelName:i?.title},"file-upload-items"),Le&&jt&&e.jsx(Ma,{modelSupportedImageMimeTypes:me},"desktop-connector-items"),xn?e.jsx(Fu,{shortLabel:!1,connectorConfig:$e,onConnectorClick:Pt},"context-connectors"):e.jsx(pa,{isLoadingConnectors:Ln,connectorConfig:$e,onConnectorClick:Pt,onOauthRedirect:_t},"context-connectors"),e.jsx(ma,{},"add-tab")];Ye&&d.push(e.jsx(se.Separator,{},"tools-separator"),e.jsx(Zu,{systemHints:ae,selectedHintType:O,onSelectHintType:B=>{be(B,{analyticsMetadata:{clientThreadId:r}})}},"system-hints")),xn&&d.push(e.jsx(ed,{},"connect-apps")),w==="bottom"&&d.reverse(),Dn=e.jsx(Uu,{onCloseAutoFocus:B=>{cs.composer.autofocusDisabled$()||(B.preventDefault(),h.focus())},items:d,children:e.jsx(Bt,{clientThreadId:r,rateLimitPopup:en,highlightTooltip:us&&!Ie,label:F.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}),secondaryLabel:e.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:e.jsx("span",{children:"/"})}),children:e.jsx(Ou,{onDoubleClick:ve,disabled:bt})})})}else if(mr){const d=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(zm,{clientThreadId:r,modelSupportedImageMimeTypes:me,openFileDialog:ve,historyDisabled:qe,highlightTooltip:us&&!Ie,isLoadingConnectors:Ln,connectorConfig:$e,onSelectConnector:Pt,onConnectorOauthRedirect:dr,showLabel:$a()==="all",showUpsell:Un&&!ft,showMenuForNoAuth:ft,isDisabled:!Le||bt,disabledReason:ds,currentModelName:i?.title??"",visualTreatment:W?"composer-btn":"legacy"})},"file-upload-button");vt.push(d),Fn.push(d)}W?Xa&&vt.push(e.jsx(sd,{activeSystemHintType:O,systemHints:ae,composerController:h,clientThreadId:r,disabled:bt})):vt.push(e.jsx(td,{account:n,clientBootstrapFlags:tn,features:$s,currentModelConfig:i,isDisabled:!!bt,clientThreadId:r,composerController:h,gizmoId:mt}));const[fr,On]=p.useState(!1),Hn=ur||tr?"disabled":"default",gr=Hu(),hr=!Be||gr,zn=$u({promptDisabledReason:l,hasPendingFiles:an,hasTextContent:cn,isTextContentTooLong:es,hasAsyncTaskPending:za,noSourceSelectedDr:!dn,isDeepResearchTaskStreaming:as,canCancelDeepResearch:ns,isThreadHardBlocked:lt}),Ke=xt?"streaming":hr?"disabled":"idle",Qe=p.useRef(null),De=p.useRef(null),xr=he(C,"222560275")||o&&!o.startsWith("o1")&&!o.startsWith("o3");p.useEffect(()=>{const d=()=>{Qe.current!=null&&Lo.addAction("composer_state_disabled",{threadId:Tt(r),disabledReason:Qe.current})};if(ht&&Ke==="disabled"){let B="unknown";g?B=l??"component_disabled_unknown":u?B="completion_in_progress":lt&&(B="thread_hard_blocked"),Qe.current!==B&&(De.current&&clearTimeout(De.current),De.current=setTimeout(d,qm)),Qe.current=B}else Qe.current=null;return()=>{De.current&&(clearTimeout(De.current),De.current=null)}},[r,ht,Ke,g,l,u,lt]);const ms=[];if(ie?.label&&ms.push({type:ie.type,value:ie.label,onRemoveRegion:Tn}),de!==null){const d=!!de.gizmo.tags?.includes(Gt.FirstParty);ms.push({type:"mention",value:de.gizmo.display.name,icon:e.jsx(la,{isFirstParty:d,src:de.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{pt(null),h.focus()}})}p.useEffect(()=>{(!ye||ye.length===0||!At)&&($t.current=!1)},[ye,At]);const Sr=p.useCallback((d,B,X)=>{$t.current=d>=0,B&&h.setText(X?`${X.title}${X.body}`:"")},[h]),Gn=At&&ye&&ye.length>0&&!Ne&&Ce?.systemHint!==z.Research&&!Jt&&!h.hasMultipleLines()&&h.canShowAutocompletion();p.useEffect(()=>{Ne?v?.():P?.()},[Ne,v,P]);const ps=d=>{if(d.preventDefault(),d.stopPropagation(),Yt.current>0){const B=performance.now()-Yt.current;Pi.hist(vi.DEFAULT,"final_user_input_to_submit_ms",[],B)}Ke==="streaming"&&(!Zs||h.isEmpty())?as&&ns?On(!0):or(d):jn(d)};p.useEffect(()=>{const d=Tt(r),B=n?.normalizedAccountUserId;if(!B||c)return;const X=zu(()=>{const te=h.getContentToSend().content;te===""?_i(d):ki(d,te,B)},1e3);return h.subscribe("change",X)},[n,r,h,c,fe]);const Wn=p.useMemo(()=>!Le||!bn?[]:[{command:"upload",aliases:["file","attach"],title:F.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"}),icon:e.jsx(Sa,{modelSupportsImages:jt}),onSelect:ve}],[Le,bn,F,jt,ve]),Vn=e.jsx(Em,{canUseInlineTagging:yt,isDisabled:g,clientThreadId:r,currentLeafId:ne,currentRequestId:oe,canContinue:S,composerController:h,isNewThread:m,onContinueGenerating:d=>s({event:d,conversationMode:xe(r)?.mode,systemHints:O?[O]:[]}),onResetState:Pn,conversationMode:U,isShowingAutocomplete:!!Gn}),qn=!xt&&U!=null&&xr&&Gu.includes(U.kind)&&e.jsx(Wu,{clientThreadId:r,onTargetedReply:er}),Yn=Gn&&e.jsx("div",{className:Z("bg-token-bg-primary absolute start-0 z-[-1] box-border w-full ps-0",w==="center"?"top-full":"bottom-full"),children:e.jsx(mm,{suggestions:ye,composerController:h,onSelect:R,onChange:Sr})}),$n=e.jsx(nd,{composerController:h,parsedDocumentHandler:nr}),Kn=!T&&e.jsx(ka,{className:I}),Qn=e.jsx(Vu,{modelSupportedImageMimeTypes:me,uploadType:je.Multimodal,attachmentsProductFeature:Ct?.attachments}),br=e.jsxs(e.Fragment,{children:[Ne&&e.jsx(Co,{onClick:d=>In(d),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()},currentModelId:o}),Ye&&ae&&e.jsx(yo,{slashCommands:Wn,systemHints:ae,composerController:h,clientThreadId:r})]}),{isImageGenEditor:Cr}=qu(),Xn=he(C,"3760395675");return Cr?e.jsxs(mo.Provider,{value:gt,children:[e.jsx(po,{defaultOpen:Xn,children:e.jsxs("form",{id:"prompt",className:x,onSubmit:ps,children:[e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(fo,{onOauthRedirect:_t}),Kn,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",children:[e.jsxs(Ku,{open:Ne||Ye,children:[e.jsx(Qu,{className:"w-full",children:e.jsx(Wm,{type:qe?"temporary":"default",ref:D,placeholder:Nn,inputState:Hn,composerController:h,leftSideActions:Fn,state:Ke,onSubmit:ps,renderFiles:Ie&&e.jsxs(e.Fragment,{children:[ue==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(N,{...J.gizmoKnowledgeWarning})}),e.jsx(Ta,{files:re,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:r,gizmoId:mt,disableReason:zn,modelId:o})}),e.jsx(Xu,{children:e.jsxs(Ju,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:d=>d.preventDefault(),children:[Ne&&e.jsx(Co,{onClick:d=>In(d),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()},currentModelId:o}),Ye&&ae&&e.jsx(yo,{slashCommands:Wn,systemHints:ae,composerController:h,clientThreadId:r})]})})]}),Yn]}),$n,Qn]}),e.jsx("input",{...yn({className:"hidden"})})]})}),Vn,qn]}):e.jsx(mo.Provider,{value:gt,children:e.jsxs(po,{defaultOpen:Xn,children:[e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(fo,{onOauthRedirect:_t}),Kn,os&&fr&&e.jsx(Yu,{taskId:os.taskId,clientThreadId:r,onClose:()=>On(!1)}),e.jsx(Gm,{layoutMode:w,hasFiles:Ie,pendingFiles:re,isUploadDisabled:!Le,clientThreadId:r,highlightUploadTooltip:us&&!Ie,disableReason:zn,uploadButtonDisabledReason:ds,currentModel:i,conversationMode:U,state:Ke,inputState:Hn,gizmoId:mt,includeSidebarContextTray:vn,isTemporaryChat:qe,placeholder:Nn,composerController:h,onSubmit:ps,replyRegions:ms,leadingAction:Dn,legacyFooterActions:vt,legacySuggestionsPopoverContent:br,activeSystemHint:Ce,hideSystemHint:Ks,onRemoveSystemHint:Xt,contextualAnswerUserConnectionData:Ba,fileInput:e.jsx("input",{...yn()}),isExpandedByDefault:!Sn,expandOnMultilineInput:Sn}),Yn]}),$n,Vn,qn,Qn,O&&ae&&e.jsx($m,{availableSystemHints:ae,systemHintType:O,onRemoveSystemHint:Xt})]})})}const $m=({availableSystemHints:t,systemHintType:s,onRemoveSystemHint:n})=>{const o=t!=null&&t.every(r=>r.systemHint!==s),{isBlocked:i}=fa(s),c=ee(),a=!Ve(c);return p.useEffect(()=>{(o||i)&&!a&&n()},[o,i,a,n,s]),null},fp=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:i,currentModelId:c,onRequestCompletion:a,shouldUseUnifiedComposer:r,onlyAllowImageUploads:m})=>{const u=Me(),{pageType:x}=ud(),g=x?.type==="landing-page",l=Ri(x?.type),f=dd(t).isOdysseyMode,S=p.useContext(Ii),y=Bi(S),k=Es(),A=We();md(u);const R=ot(at),I=et(It.sidebarUrlTrayOpen$)&&R,T=et(It.context$),v=ee(),{platformConnectors:P}=Wo(),b=rt(zt.hasSeenOdysseyConnectorsModal),w=nt(),M=Q(t,q=>H.getConversationTurns(q).some(E=>E.messages.some(K=>K.metadata?.n7jupd_message))),C=qo(),D=pd(),L=(C||D)&&M;fd(async()=>{if(I)return await Ui(T)});const V=async q=>{if(xe(t)?.isLoading!==!1)return;const E=()=>{u.delete(0,u.getContentLength()),u.appendText(q.contentToSend.content),u.focus()},K=await Cd(q),ne=K.completionMetadata?.systemHints?.includes(Vo),oe=Array.from(q.selectedSources??[]).filter(ce=>ce!=="web")[0];if(ne&&oe&&b.eligible){const ce=Li[oe]??oe,it=P.get(ce);if(it){let Ee=!1;Go(v,yd,{connector:it,onConfirm:()=>{b.markAsViewed(),Ee=!0,a(K)},onTurnOffConnectors:()=>{we(t,ue=>{ue.selectedSources??=new Map,ue.selectedSources.set(w,new Set(["web"])),ue.selectedMCPSources??=new Map,ue.selectedMCPSources.set(w,new Set),ue.mentionedSources=new Set,Di({selectedSourcesMap:ue.selectedSources,selectedMCPSourcesMap:ue.selectedMCPSources,scope:{userId:A?.authUserId,workspaceId:A?.id}})})},onClose:()=>{Ee||E()}});return}}if(R){const ce=Fi(T?.url??"")?.hostname;j.logEvent("kaur1br5.messageSent",ce?{host:ce}:void 0)}a(K)},h=p.useCallback(q=>{j.logEvent("Continue Completion"),a(gd(q))},[a]),Y=hd.useState(q=>q.isReplayEnabled);if(Ni({clientThreadId:t}))return e.jsx(xd,{});const W=e.jsxs(e.Fragment,{children:[e.jsx(Sd,{clientThreadId:t}),e.jsx(Cs,{verticalMargin:"none",verticalPadding:y?"last-standard":"none",horizontalPadding:R?"none":"standard",children:e.jsx(ys,{children:Y?e.jsx(bd,{clientThreadId:t},t):L?null:e.jsx(Km,{clientThreadId:t,currentModelId:c,isNewThread:s,hideHeader:s,onRequestCompletion:V,onContinueGenerating:h,onAutocompleteSelect:u.onAutocompleteSelect,onlyAllowImageUploads:m})})})]}),F=s&&e.jsx("div",{className:Z("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Cs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(ys,{children:e.jsx(ka,{className:"block flex-1"})})})});return r?e.jsxs(e.Fragment,{children:[!k&&F,e.jsx("div",{id:"thread-bottom",children:W}),k&&F,s&&!g&&!n&&!l&&!f&&!o&&e.jsx(Cs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsxs(ys,{children:[e.jsx(ym,{clientThreadId:t,currentModelId:c,isModelLoaded:i}),!1]})})]}):W};function Km({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:i,onContinueGenerating:c,onComposerInput:a,onComposerChange:r,onAutocompleteSelect:m,headerClassName:u,hideHeader:x,onTaggingDropdownClose:g,onTaggingDropdownOpen:l,onlyAllowImageUploads:f,layoutMode:S}){const{data:y,isLoading:k}=wi(),[A,R,I,T,v]=Q(t,oe=>{const ce=H.getCurrentNode(oe);return[ce.message.clientMetadata?.errType!=null&&ce.message.clientMetadata.errType!=="info",Oi(H.getCurrentNode(oe).message),oe?.mode,oe?.continuingFromSharedConversationId!=null,!!oe?.continuingFromSharedPostId]}),P=We(),b=Me(),w=rd({clientThreadId:t}),{isOpen:M,onClose:C}=id({type:"just-hit-rate-limit"}),D=p.useMemo(()=>w?!1:!A&&R,[A,R,w]),L=w,V=Ti(t),h=Q(t,H.hasRecentPIMWarning),Y=oa(V).data,G=Mi(),W=h?"pimBlock":Y?.gizmo.tags?.includes(Gt.WorkspaceDisabled)&&!G?"workspaceDisallowsGizmo":y?.models.size===0?"noModelsAvailable":I?.kind===Ge.GizmoTest&&I.gizmo_id==null?"noTestGizmoId":null,F=jr(),q=qo(),E=F.action==="moderate",K=ee(),ne=he(K,"1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(Gd,{composerController:b,clientThreadId:t,currentModelId:s,isCompletionInProgress:w}),e.jsx("div",{className:"flex justify-center empty:hidden",children:q&&E&&ne?e.jsx(ld,{}):null}),M?e.jsx(cd,{onClose:C}):null,e.jsx(Ym,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:i,onContinueGenerating:c,currentModelId:s,account:P,currentModelConfig:Ei(y?.models,s),areModelsLoading:k,isNewThread:o,isCompletionInProgress:w,className:"w-full",canContinue:D,disabled:!!W,disabledReason:W??void 0,canPause:L,isInteractableSharedThread:T||v,onComposerInput:a,onComposerChange:r,onAutocompleteSelect:m,headerClassName:u,hideHeader:x,onTaggingDropdownClose:g,onTaggingDropdownOpen:l,onlyAllowImageUploads:f,layoutMode:S},t)]})}export{zd as D,up as F,mp as I,pp as M,Km as P,fp as T,Wm as a,Hd as b,So as c,Pa as g,ba as h,dp as u};
//# sourceMappingURL=mzdwbfzlwdoj9187.js.map
