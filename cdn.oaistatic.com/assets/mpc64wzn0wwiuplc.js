import{r as g,j as e,f as ie,M as l,L as K,e as $,u as ts,d as Se,k as pt,p as ss,l as as,au as ns}from"./fyeo2h7okrqcf3nz.js";import{P as h,B as G,i as os,A as _,x as mt,q as Ue,j as $e,eO as gt,es as te,ck as ft,l_ as ht,l$ as qe,ay as je,b6 as le,b9 as Ce,dT as yt,fL as is,cL as nt,m0 as Re,eJ as Mt,eK as bt,eL as Pt,eM as _t,eN as xt,c as ls,l as rs,iV as Ct,bp as Be,L as Ge,b as We,jm as ge,a$ as cs,fg as me,fh as se,m1 as us,m2 as St,m3 as jt,T as _e,m4 as Ke,lj as ds,lk as ps,R as vt,dz as wt,m5 as ms,aS as ot,D as kt,b5 as gs,cI as fs,dA as hs,s as ys,N as Ms,f as it,m6 as bs}from"./egb2c0f6p1ew61vt.js";import{S as Ps}from"./pde2w7wi3s85a6ty.js";import{pr as lt,ps as ve,pt as Et,jq as _s,pu as Tt,pv as pe,I as He,H as Ye,P as Ve,pw as xs,ke as Cs,px as At,py as oe,mQ as Ss,G as js,d8 as Nt,pz as xe,pA as vs,pB as Te,F as ws,pC as Qe,pD as ks,e3 as Es,e7 as Ts,U as As,cV as Ns,pE as Ds,h6 as Is,l7 as Us}from"./f7j18j5u52u1pnnk.js";import{a as Dt,u as Fs}from"./moeip5yn7z08hyho.js";import{C as rt}from"./bfu8twf3het5vjyn.js";import{a as Ls,b as Os,M as Rs}from"./euyyz74sa52ztdnb.js";const Bs=t=>g.createElement("svg",{width:21,height:20,viewBox:"0 0 21 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{d:"M10.2441 10.7759C12.7597 10.8965 14.8838 12.8648 14.8838 15.0601C14.8838 15.4273 14.586 15.7251 14.2188 15.7251H5.78125C5.41399 15.7251 5.11623 15.4273 5.11621 15.0601C5.11621 12.7959 7.37906 10.77 10 10.77L10.2441 10.7759Z"}),g.createElement("path",{d:"M0 14.436C0 11.5616 3.13043 10.5652 5.2998 11.4478C4.37179 12.4185 3.78619 13.6736 3.78613 15.0601L3.78809 15.1011H0.665039C0.298096 15.1011 0.000527744 14.8029 0 14.436Z"}),g.createElement("path",{d:"M14.7988 11.5532C16.969 10.4969 20.3301 11.4561 20.3301 14.436C20.3295 14.8029 20.032 15.1011 19.665 15.1011H16.2119L16.2139 15.0601C16.2138 13.7223 15.6689 12.5079 14.7988 11.5532Z"}),g.createElement("path",{d:"M3.4248 5.00146C4.85516 5.00146 6.01454 6.16098 6.01465 7.59131C6.01454 9.02164 4.85516 10.1812 3.4248 10.1812C1.99454 10.181 0.835068 9.02157 0.834961 7.59131C0.835066 6.16105 1.99454 5.00157 3.4248 5.00146Z"}),g.createElement("path",{d:"M16.5703 5.00146C18.0006 5.00157 19.1601 6.16105 19.1602 7.59131C19.16 9.02157 18.0006 10.181 16.5703 10.1812C15.14 10.1812 13.9806 9.02164 13.9805 7.59131C13.9806 6.16098 15.14 5.00146 16.5703 5.00146Z"}),g.createElement("path",{d:"M10 4.27002C11.6099 4.27002 12.915 5.57515 12.915 7.18506C12.915 8.79497 11.6099 10.1001 10 10.1001C8.39009 10.1001 7.08496 8.79497 7.08496 7.18506C7.08496 5.57515 8.39009 4.27002 10 4.27002Z"}));function Gs({value:t,onChange:s}){return e.jsx(Ps,{value:t,onChange:s,ariaLabel:Me.toggleArialabel,leftItem:{ariaLabel:Me.togglePersonalArialabel,label:Me.togglePersonalLabel,value:"personal"},rightItem:{ariaLabel:Me.toggleBusinessArialabel,label:Me.toggleBusinessLabel,value:"business"}})}const Me=ie({toggleArialabel:{id:"U4v2Gf",defaultMessage:"Toggle for switching between Personal and Business plans"},togglePersonalArialabel:{id:"6Wikht",defaultMessage:"Toggle for switching to Personal plans"},toggleBusinessArialabel:{id:"uzlEV0",defaultMessage:"Toggle for switching to Business plans"},togglePersonalLabel:{id:"cGDsaD",defaultMessage:"Personal"},toggleBusinessLabel:{id:"sgisa2",defaultMessage:"Business"}}),Ze=()=>{h.logEvent("Account Portal: Click Get Help")};function Ws(t){if(os(t))return"secondary";switch(t){case _.FREE:return"green";case _.PLUS:return"green";case _.TEAM:return"primary";case _.PRO:return"primary"}}function De({isCurrentPlan:t,planType:s,disabled:a,loading:n=!1,onClick:i,children:r,testId:o,activeColor:p,...y}){return e.jsx(G,{fullWidth:!0,size:"large",color:t?"secondary":p||Ws(s),disabled:a,loading:n,onClick:i,"data-testid":o,className:a?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary border-none font-semibold":"font-semibold",...y,children:r})}function Je(t,s){const[a,n]=g.useState(!1);g.useEffect(()=>{if(!a){n(!0);return}t?h.logEventWithStatsig("Email Verify Popup Shown","chatgpt_email_verify_popup_shown",s):h.logEventWithStatsig("Email Verify Popup Hidden","chatgpt_email_verify_popup_hidden",s)},[t])}function It({ctx:t,shouldLogExposure:s}){return mt(t,"2273762597",{disableExposureLog:!s})}function Hs({ctx:t,shouldLogExposure:s}){return It({ctx:t,shouldLogExposure:s}).get("web_plus_intro_offer_coupon","none")}function Ys({ctx:t,shouldLogExposure:s}){return It({ctx:t,shouldLogExposure:s}).get("is_plus_intro_offer_enabled",!1)}const ct=_.DEPRECATED_ENTERPRISE,Vs=({billingDetails:t})=>{const s=Ue(),n=$e()?.isEnterprisey(),i=lt();return e.jsx(ve,{planName:"enterprise",pricingPlan:i,showForLine:!0,callToActionButton:n?e.jsx(G,{color:"secondary",disabled:!0,size:"large",className:"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold",children:e.jsx(l,{...Et().callToAction.inactive})}):e.jsx(De,{planType:ct,as:"link",to:gt,openNewTab:!0,onClick:()=>{h.logEvent("Account Pay: Click Enterprise Contact Sales Button"),te(s,"chatgpt_account_payment_modal_enterprise_sales_button_clicked",ct)},isCurrentPlan:!1,testId:"select-plan-button-enterprise",children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(l,{...lt().callToAction.inactive})})}),billingDetails:t})},zs=({billingDetails:t})=>{const{data:s}=ft(),a=ht(s),n=Et();return e.jsx(ve,{planName:"free",pricingPlan:n,showForLine:!a,callToActionButton:e.jsx(G,{color:"secondary",disabled:!0,size:"large",className:"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold",children:e.jsx(l,{...n.callToAction.inactive})}),additionalLinks:[e.jsx(l,{...$s.haveExistingPlan,values:{link:i=>e.jsx(K,{target:"_blank",to:qe,onClick:Ze,className:"underline",children:i},"row-plus-plan-help-link")}},"existing-plan-help")],billingDetails:t})},$s=ie({haveExistingPlan:{id:"FreeColumn.haveExistingPlan",defaultMessage:"Have an existing plan? See <link>billing help</link>"}}),qs=_.PLUS;function Ks({isOpen:t,onClose:s,onCancelationComplete:a,analyticsParams:n}){const i=$(),r=je(),o=$e(),{data:p,isLoading:y}=_s(),c=Tt(o?.id),f=g.useMemo(()=>({...n,planType:qs}),[n]),u=g.useCallback(()=>{s(),c.isSuccess||h.logEventWithStatsig("Cancel Plus: Closed cancel modal without cancellation","cancel_plus_modal_abort",f)},[s,c.isSuccess,f]),x=async()=>{if(!o)throw new Error("No account!");h.logEventWithStatsig("Cancel Plus: Clicked button to cancel plan","cancel_plus_modal_confirm",f),await c.mutateAsync(o?.id,{onError:()=>{r.danger(F.cancelFailure,{duration:2,toastId:"cancel_plus_modal"}),h.logEventWithStatsig("Cancel Plus: Something errored while cancelling","cancel_plus_modal_error",f)},onSuccess:()=>{h.logEventWithStatsig("Cancel Plus: Request to cancel was successful","cancel_plus_modal_success",f),a?.(),r.info(i.formatMessage(F.cancelSuccess),{duration:2}),s()}})};g.useEffect(()=>{c.isSuccess},[c.isSuccess,s]);const m=p?.active_until;return e.jsx(le,{testId:"modal-cancel-plus",type:"success",onClose:u,isOpen:t,className:"",title:e.jsx(l,{...F.cancelPlan}),children:y||!o?e.jsx(Ce,{}):c.isSuccess?e.jsx(l,{...F.cancelSuccess}):e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[!!m&&e.jsx("p",{className:"mb-4",children:e.jsx(l,{...F.planActiveUntil,values:{expirationDate:new Date(m)}})}),e.jsx("p",{className:"mb-2",children:e.jsx(l,{...F.cancelListHeader})}),e.jsx("div",{children:Js.map(P=>e.jsxs("div",{className:"text-l mb-2 flex justify-start gap-2",children:[e.jsx(yt,{className:"h-5 w-5 shrink-0 align-top text-gray-500"}),e.jsx("span",{children:e.jsx(l,{...P,values:{learnMoreLink:Qs,mainModel:Zs}})})]},P.id))})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(G,{onClick:u,color:"secondary",children:e.jsx(l,{...F.closeModal})}),e.jsx(G,{color:"danger",onClick:x,disabled:c.isPending||c.isSuccess,children:e.jsx(l,{...c.isPending?F.cancellingInProgress:F.cancelButton})})]})]})})}const Qs=t=>e.jsx("a",{target:"_blank",href:"https://help.openai.com/en/articles/9280126-what-happens-to-my-gpts-if-i-cancel-my-subscription",rel:"noreferrer",className:"underline",children:t}),Zs="GPT-4",F=ie({cancelPlan:{id:"cancelPlusModal.cancelPlan",defaultMessage:"Cancel your Plus subscription?"},cancelListHeader:{id:"cancelPlusModal.cancelText",defaultMessage:"When your subscription ends, you'll no longer have:"},planActiveUntil:{id:"cancelPlusModal.planActiveUntil",defaultMessage:"If you cancel your subscription, youâ€™ll be downgraded to the free plan on {expirationDate, date, long}."},cancelButton:{id:"cancelPlusModal.cancelButton",defaultMessage:"Cancel subscription"},cancellingInProgress:{id:"cancelPlusModal.cancellingInProgress",defaultMessage:"Cancelling..."},cancelSuccess:{id:"cancelPlusModal.cancelSuccess",defaultMessage:"Successfully cancelled your plan. Sorry to see you go!"},cancelFailure:{id:"cancelPlusModal.cancelFailure",defaultMessage:"Something went wrong while cancelling your plan. Please reach out to support"},lostFeatureGPTModels:{id:"0w7d5w",defaultMessage:"Access to {mainModel} and {liteModel}"},lostFeatureGPTModelSingular:{id:"cancelPlusModal.lostFeature.gptModelSingular",defaultMessage:"Access to {mainModel}"},lostFeatureNewModelUsageLimits:{id:"TjftEV",defaultMessage:"Higher usage limits for {limitedModel}"},lostFeatureDataAnalysisV2:{id:"cancelPlusModal.lostFeature.dataAnalysisV2",defaultMessage:"Access to advanced data analysis, file uploads, vision, and web browsing"},lostFeatureDataAnalysisLimits:{id:"dlGufV",defaultMessage:"Higher usage limits for advanced data analysis, file uploads, vision, and web browsing"},lostFeatureImageGeneration:{id:"cancelPlusModal.lostFeature.imageGeneration",defaultMessage:"DALLÂ·E image generation"},lostFeatureCustomGPTs:{id:"cancelPlusModal.lostFeature.customGPTs",defaultMessage:"Custom GPT creation"},lostFeaturePersonalGPTs:{id:"cancelPlusModal.lostFeature.personalGPTs",defaultMessage:"GPTs youâ€™ve created (<learnMoreLink>learn more</learnMoreLink>)"},closeModal:{id:"cancelPlusModal.close",defaultMessage:"Close"}}),Js=[F.lostFeatureGPTModelSingular,F.lostFeatureDataAnalysisV2,F.lostFeatureImageGeneration,F.lostFeatureCustomGPTs,F.lostFeaturePersonalGPTs];function Ut({isOpen:t,onClose:s,onContinue:a,analyticsParams:n}){g.useEffect(()=>{t&&h.logEventWithStatsig("Mobile Subscription Warning Modal Shown","chatgpt_mobile_subscription_warning_modal_shown",n)},[n,t]);const i=()=>{h.logEventWithStatsig("Mobile Subscription Warning Modal Continue Clicked","chatgpt_mobile_subscription_warning_modal_continue_clicked",n),a()},r=()=>{h.logEventWithStatsig("Mobile Subscription Warning Modal Close Clicked","chatgpt_mobile_subscription_warning_modal_close_clicked",n),s()};return e.jsx(le,{testId:"modal-mobile-subscription-warning",isOpen:t,onClose:r,type:"warning",icon:is,title:e.jsx(l,{...Ae.checkSubscriptionHeader}),primaryButton:e.jsx(nt.Button,{title:Ae.dismissModal.defaultMessage,color:"primary",onClick:r}),secondaryButton:e.jsx(nt.Button,{title:Ae.continueToNextStep.defaultMessage,color:"secondary",onClick:i}),children:e.jsx("span",{className:"gap-2 text-gray-600",children:Ae.checkSubscriptionBody.defaultMessage})})}const Ae=ie({checkSubscriptionHeader:{id:"mobileSubscriptionWarningModal.checkSubscriptionHeader",defaultMessage:"Check your App Store subscription"},checkSubscriptionBody:{id:"mobileSubscriptionWarningModal.checkSubscriptionBody",defaultMessage:"Your subscription through the Apple App Store is currently on pause due to a payment issue. Please resolve that issue to resume using ChatGPT Plus and avoid duplicate charges."},dismissModal:{id:"mobileSubscriptionWarningModal.dismissModal",defaultMessage:"Cancel"},continueToNextStep:{id:"mobileSubscriptionWarningModal.continueToNextStep",defaultMessage:"I understand, continue anyways"}});function ka(t,s,a,n){let i,r;n===Mt?(i=Ye,r=bt):n===Pt?(i=Ve,r=_t):(i=He,r=xt);const o=i*s;let p;if("percentage"in a)p=o*(1-a.percentage/100);else if("value"in a)p=o-a.value;else throw new Error("Invalid discount type");return{formattedDiscountedCost:t.formatNumber(p,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2}),currencySymbol:r}}function Ft(t,s,a,n){const i={...s};let r;if(n&&(n.period==="year"?n.num_periods===1?r=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleYear",defaultMessage:"for the first year"}):r=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralYears",defaultMessage:"for the first {num_years} years"},{num_years:n.num_periods}):n.num_periods===1?r=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleMonth",defaultMessage:"for the first month"}):r=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralMonths",defaultMessage:"for the first {num_months} months"},{num_months:n.num_periods})),i.costDuration={id:"promoCostDuration",defaultMessage:r,description:"Cost duration for promo plan"},"percentage"in a||"discount_type"in a&&a.discount_type===Re.PERCENTAGE){const o=("percentage"in a?a.percentage:a.amount)/100;i.costInDollars={id:"discountedCost",defaultMessage:pe((1-o)*He).toString()},i.costInEuros={id:"discountedCostEuros",defaultMessage:pe((1-o)*Ye).toString()},i.costInPounds={id:"discountedCostPounds",defaultMessage:pe((1-o)*Ve).toString()}}else if("value"in a||a.discount_type===Re.FIXED){const o="value"in a?a.value:a.amount;i.costInDollars={id:"discountedCost",defaultMessage:pe(He-o).toString()},i.costInEuros={id:"discountedCostEuros",defaultMessage:pe(Ye-o).toString()},i.costInPounds={id:"discountedCostPounds",defaultMessage:pe(Ve-o).toString()}}return i}const Xe=ls(t=>({recentlyDowngraded:!1,recentlyUpgraded:!1,recentlyCanceled:!1,setRecentlyDowngraded:s=>t({recentlyDowngraded:s}),setRecentlyUpgraded:s=>t({recentlyUpgraded:s}),setRecentlyCanceled:s=>t({recentlyCanceled:s})}));function Lt(t){switch(t){case _.FREE:return"chatgptfreeplan";case _.PLUS:return"chatgptplusplan";case _.PRO:return"chatgptpro";case _.TEAM:return"chatgptteamplan";default:throw new Error(`Invalid plan type: ${t}`)}}function Ot({isOpen:t,onClose:s,accountId:a,initialPlanType:n,updatedPlanType:i,billingDetails:r}){const o=$(),p=je(),y=rs(),[c,f]=g.useState(!1),u=n===i,x=n===_.PLUS&&i===_.PRO,m=Lt(i);g.useEffect(()=>{h.logTogglePlanManagementModal({isOpen:!0})},[]);const P=()=>{h.logTogglePlanManagementModal({isOpen:!1}),s()},B=xs(a),T=Cs(a),A=Tt(a),{data:N,isError:v,isLoading:C}=At(a,void 0,m);!u&&v&&(y?.planType===_.TEAM?p.warning(o.formatMessage({id:"planManagement.errorUpgradingTeam",defaultMessage:"Updates to Pro aren't yet supported for users with Team subscriptions"}),{hasCloseButton:!0}):p.warning(o.formatMessage({id:"planManagement.errorFetchingPreview",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),s());const Y=S=>{const d=Ct(new Date,S);return new Intl.DateTimeFormat(o.locale,{year:"numeric",month:"short",day:"numeric"}).format(d)},M=y?.getDaysUntilPlanRenews(),W=M?Y(M):"",{recentlyCanceled:Q,setRecentlyUpgraded:L,setRecentlyDowngraded:b}=Xe(),V=y?.willRenewSubscription()||Q,[Z,J]=g.useState(!1),ae=ts();if(!y)return null;const H=async S=>{f(!0);try{if(u)await T.mutateAsync(a),p.success(W===""?o.formatMessage({id:"planManagement.successfullyRenewedSubscription2",defaultMessage:"Your subscription has been renewed."}):o.formatMessage({id:"planManagement.successfullyRenewedSubscription",defaultMessage:"Your subscription has been renewed. Your subscription will auto-renew on {renewalDate}."},{renewalDate:W}),{hasCloseButton:!0}),h.logEvent("Renew Plan Success",{planType:S}),Be.logEvent("chatgpt_renew_plan_success",null,{planType:S});else{if(V||(await T.mutateAsync(a),J(!0)),await B.mutateAsync({accountId:a,updatedPlan:m,updatedPriceInterval:void 0,updatedSeats:void 0}),S!==i){const w=x?"Upgrade Plan Success":"Downgrade Plan Success",re=x?"chatgpt_upgrade_plan_success":"chatgpt_downgrade_plan_success";h.logEvent(w,{fromPlan:S,toPlan:i}),Be.logEvent(re,null,{fromPlan:S,toPlan:i}),x?L(!0):b(!0)}const k=N?.renewal_date?new Date(N?.renewal_date).toLocaleDateString(o.locale,{year:"numeric",month:"long",day:"numeric"}):"N/A",z=x?o.formatMessage({id:"planManagement.successfullyUpdatedSubscription",defaultMessage:"You're now subscribed to ChatGPT Pro"}):o.formatMessage({id:"planManagement.updatedSubscriptionToPlus",defaultMessage:"Your subscription has been updated. Your subscription will change to Plus on {renewalDateFormatted}."},{renewalDateFormatted:k});localStorage.setItem(`subscriptionUpdateMessage_${y.id}`,z)}ae.invalidateQueries({queryKey:["account-status"]});const d=Ge.getItem(We.CheckoutFrom);d&&rt[d]&&(Ge.removeItem(We.CheckoutFrom),window.location.href=rt[d]),s()}catch(d){d?.detail?.error_type==="card_declined"?p.warning(o.formatMessage({id:"planManagement.cardDeclinedError",defaultMessage:"Payment error. Your card may be invalid or authentication may be needed."}),{hasCloseButton:!0}):p.warning(o.formatMessage({id:"planManagement.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),Z&&await A.mutateAsync(a),s()}finally{f(!1)}},[O,X,D]=la(r.currency);return e.jsx(le,{testId:"modal-plan-management",type:"success",isOpen:t,onClose:P,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:o.formatMessage({id:"planManagementModal.title",defaultMessage:"Confirm changes"}),removePopoverStyling:!0,children:C?e.jsx(Rt,{}):u&&y?e.jsx(ia,{account:y,renewalDate:W,handleUpdate:()=>H(n),isUpdating:c,onClose:P,plusCost:O,proCost:X,currencySymbol:D}):v||!N?null:x?e.jsx(ea,{accountId:a,handleUpdate:()=>H(n),isUpdating:c,onClose:P,currencySymbol:D}):e.jsx(oa,{renewalDate:N.renewal_date,handleUpdate:()=>H(n),isUpdating:c,onClose:P,plusCost:O,currencySymbol:D})})}function Rt(){return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(Ce,{})})}function Xs({adjustmentMessage:t,proratedCreditMessage:s,proratedCreditInfoMessage:a}){return e.jsxs("div",{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsx("span",{className:"font-semibold text-green-600",children:s})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:a})]})}function ea({accountId:t,handleUpdate:s,isUpdating:a,onClose:n,currencySymbol:i}){const r=$(),{data:o,isError:p,isLoading:y}=At(t,void 0,Lt(_.PRO));if(y)return e.jsx(Rt,{});if(p||!o)return null;const c=ta(o,r,i);return e.jsxs("div",{className:"p-6",children:[e.jsx(sa,{data:o,currencySymbol:i}),c.filter(f=>f.value!==0).map((f,u)=>e.jsx(Xs,{adjustmentMessage:f.adjustmentMessage,proratedCreditMessage:f.proratedCreditMessage,proratedCreditInfoMessage:f.proratedCreditInfoMessage},u)),e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(aa,{data:o,currencySymbol:i}),o.default_payment_method&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(na,{defaultPaymentMethod:o.default_payment_method})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ge,{title:r.formatMessage({id:"planUpgradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:n}),e.jsx(ge,{title:r.formatMessage({id:"planUpgradeModal.payNow",defaultMessage:"Pay now"}),color:"primary",onClick:s,loading:a})]})]})}function ta(t,s,a){return[{adjustmentMessage:e.jsx(l,{id:"planUpgradeModal.adjustment",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(l,{id:"planUpgradeModal.proratedCredit",defaultMessage:"-{currencySign}{adjustment}",values:{currencySign:s.formatMessage(a.sign),adjustment:(-t.negative_line_item_total/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(l,{id:"planUpgradeModal.proratedCreditInfo",defaultMessage:"Prorated credit for the remainder of your Plus subscription"}),value:t.negative_line_item_total},{adjustmentMessage:e.jsx(l,{id:"planUpgradeModal.discount",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(l,{id:"planUpgradeModal.discountAmount",defaultMessage:"-{currencySign}{discount}",values:{currencySign:s.formatMessage(a.sign),discount:(t.discount_amount/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(l,{id:"planUpgradeModal.discountInfo",defaultMessage:"Account discount applied"}),value:t.discount_amount},{adjustmentMessage:e.jsx(l,{id:"planUpgradeModal.credits",defaultMessage:"Adjustments"}),proratedCreditMessage:e.jsx(l,{id:"planUpgradeModal.creditsAmount",defaultMessage:"-{currencySign}{credits}",values:{currencySign:s.formatMessage(a.sign),credits:(t.applied_balance/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(l,{id:"planUpgradeModal.creditsInfo",defaultMessage:"Credits applied"}),value:t.applied_balance}]}function sa({data:t,currencySymbol:s}){const a=$();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.subscription",defaultMessage:"ChatGPT Pro subscription"})}),e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.subscriptionCost",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:a.formatMessage(s.sign),totalCost:(t.positive_line_item_total/100).toFixed(2)}})})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"planUpgradeModal.billingCycle",defaultMessage:"Billed monthly, starting today"})})]})}function aa({data:t,currencySymbol:s}){const a=$();return e.jsxs(e.Fragment,{children:[t.amount_due.tax_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.subTotal",defaultMessage:"Subtotal"})}),e.jsx("span",{children:e.jsx(l,{id:"planUpgradeModal.subtotalPrice",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:a.formatMessage(s.sign),totalCost:(t.amount_due.amount_excluding_tax/100).toFixed(2)}})})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsxs("span",{className:"font-semibold",children:[e.jsx(l,{id:"planUpgradeModal.tax",defaultMessage:"Tax"}),e.jsx("span",{className:"text-token-text-secondary font-normal",children:e.jsx(l,{id:"planUpgradeModal.taxPercent",defaultMessage:" {taxPercent}%",values:{taxPercent:(t.amount_due.tax_amount/t.amount_due.amount_excluding_tax*100).toFixed(0)}})})]}),e.jsx("span",{children:e.jsx(l,{id:"planUpgradeModal.taxAmount",defaultMessage:"{currencySign}{tax}",values:{currencySign:a.formatMessage(s.sign),tax:(t.amount_due.tax_amount/100).toFixed(2)}})})]})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.totalDueToday",defaultMessage:"Total due today"})}),e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.totalDueTodayAmount",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:a.formatMessage(s.sign),totalCost:(t.amount_due.amount/100).toFixed(2)}})})]})]})}function na({defaultPaymentMethod:t}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planUpgradeModal.paymentMethod",defaultMessage:"Payment Method"})}),e.jsxs("span",{className:"text-token-text-secondary",children:[t.card_brand?.toUpperCase()," *",t.card_last4]})]})}function oa({renewalDate:t,handleUpdate:s,isUpdating:a,onClose:n,plusCost:i,currencySymbol:r}){const o=$(),p=t?new Date(t).toLocaleDateString(o.locale,{year:"numeric",month:"long",day:"numeric"}):"N/A";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planDowngradeModal.currentSubscription",defaultMessage:"Your current Pro subscription will remain active until {renewalDateFormatted}, when it will change to Plus.",values:{renewalDateFormatted:p}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planDowngradeModal.newPlan",defaultMessage:"ChatGPT Plus"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planDowngradeModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{plusCost}/month",values:{currencyCode:o.formatMessage(r.code),currencySign:o.formatMessage(r.sign),plusCost:o.formatMessage(i)}})})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planDowngradeModal.billingStart",defaultMessage:"Billing will start on {renewalDateFormatted}",values:{renewalDateFormatted:p}})})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ge,{title:o.formatMessage({id:"planDowngradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:n}),e.jsx(ge,{title:o.formatMessage({id:"planDowngradeModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:s,loading:a})]})]})})}function ia({account:t,renewalDate:s,handleUpdate:a,isUpdating:n,onClose:i,plusCost:r,proCost:o,currencySymbol:p}){const y=$(),c=t.data.subscriptionStatus.planType,f=Ss(c.toLowerCase()),u=f==="Pro"?o:r;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planRenewalModal.currentSubscription",defaultMessage:"Your current {planName} subscription will auto-renew on {renewalDate}.",values:{planName:f,renewalDate:s}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(l,{id:"planRenewalModal.newPlan",defaultMessage:"ChatGPT {planName}",values:{planName:f}})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planRenewalModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{planCost}/month",values:{currencyCode:y.formatMessage(p.code),currencySign:y.formatMessage(p.sign),planCost:y.formatMessage(u)}})})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(l,{id:"planRenewalModal.billingStart",defaultMessage:"Billing will auto-renew on {renewalDate}",values:{renewalDate:s}})})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ge,{title:y.formatMessage({id:"planRenewalModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:i}),e.jsx(ge,{title:y.formatMessage({id:"planRenewalModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:a,loading:n})]})]})})}function la(t){return t==Mt?[oe.plus.plusCostInEuros,oe.pro.proCostInEuros,bt]:t==Pt?[oe.plus.plusCostInPounds,oe.pro.proCostInPounds,_t]:[oe.plus.plusCost,oe.pro.proCost,xt]}const be=_.PLUS,ra=()=>Se({queryKey:["has-app-store-subscription-in-billing-retry"],queryFn:async()=>await vt.safeGet("/subscriptions/has_app_store_subscription_in_billing_retry")});function Bt(t,s){const a=t.data.subscriptionStatus.planType,n=t.getNextPlanType();let i=t.getDaysUntilPlanChanges(),r=n===_.PLUS&&a===_.PRO;return s&&!r&&(i=t.getDaysUntilPlanRenews(),r=!0),{daysUntilPlanChanges:i,isDowngradeScheduled:r}}function ze(t,s){const a=Ct(new Date,t);return new Intl.DateTimeFormat(s,{year:"numeric",month:"short",day:"numeric"}).format(a)}function ca(t,s,a){let n;switch(t){case"month":n=ps(new Date,s);break;case"year":n=ds(new Date,s);break}return new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(n)}function ut(t){return t==="USD"||t==="EUR"||t==="GBP"?t:"USD"}function ua(t,s,a){if(t==="plus-10-for-3-months")switch(a.currency){case"USD":{const n={value:10,currency_code:ut(a.currency)};return{plan_name:me.PLUS,title:"",summary:s.formatMessage(Te.plusSummary),discount:n,duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:me.PLUS,title:"",summary:s.formatMessage(Te.plusSummary),discount:{percentage:52.18},duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}else if(t==="plus-10-for-12-mos")switch(a.currency){case"USD":{const n={value:10,currency_code:ut(a.currency)};return{plan_name:me.PLUS,title:"",summary:s.formatMessage(Te.plusSummary),discount:n,duration:{num_periods:1,period:"year"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:me.PLUS,title:"",summary:s.formatMessage(Te.plusSummary),discount:{percentage:52.18},duration:{num_periods:1,period:"year"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}return null}const da=({analyticsParams:t,className:s,currentAccount:a,planLoading:n,isPromoLoading:i,onUpgradeButtonClick:r,setPlanLoading:o,plusPricingPlan:p=null,shouldShowAdditionalLinks:y=!0,billingDetails:c,promoCode:f=null,promoMetadata:u=null,onClose:x,disableForMobile:m=!1,shouldShowMemoryUpsell:P=!1})=>{const{data:B}=ft(),{data:T,refetch:A}=Se(Qe),{data:{value:N}={}}=ra(),v=a.features,C=Ue(),Y=!cs(C),M=$(),W=je(),[Q,L]=g.useState(!1);let b=p||js({shouldShowMemoryUpsell:P});const V=Hs({ctx:C,shouldLogExposure:!1}),{data:Z}=Dt(V);u==null&&Z?.coupon===V&&Z?.state==="eligible"&&Ys({ctx:C,shouldLogExposure:!0})&&(u=ua(V,M,c),f=V);const J=g.useRef(!1),[ae,H]=g.useState(!1),[O,X]=g.useState(!1),[D,S]=g.useState(!1),{recentlyDowngraded:d,recentlyCanceled:k,setRecentlyCanceled:z}=Xe();let w=[];const re=a.isOrWasPaidCustomer(),fe=a.hasPaidSubscription(),E=fe&&a.isPlus(),we=fe&&a.isPro(),ce=a.getLastActiveSubscription(),ue=mt(C,"3950229590"),{prepareCheckoutSession:he,navigateToCheckout:q}=Nt(),ne=ht(B),Fe=v.includes("disable_plus_upgrade_ui")&&!re,Gt=v.includes("show_cancel_plus_ui"),{daysUntilPlanChanges:et,isDowngradeScheduled:Wt}=Bt(a,d),I=g.useMemo(()=>({...t,promoCode:f,planType:be,isUpgradeUiDisabled:Fe}),[t,f,Fe]),Ht=!!T?.email,ye=g.useRef(new Map),Le=g.useRef(null);g.useEffect(()=>{if(!E&&ue.get("enabled_prefetch_checkout_for_plus",!1)){const R={plan_name:me.PLUS,billing_details:c,promo_code:f},U=JSON.stringify(R);if(!ye.current.has(U)){h.logEventWithStatsig("Account Pay: Prefetch Checkout Session","chatgpt_account_payment_modal_prefetch_checkout_session",I),ye.current.clear();const ee=ue.get("skip_sentinel_checkout",!1),Ee=he(R,"ProducePlus",ee?void 0:v);ye.current.set(U,Ee)}}},[he,I,c,f,v,E,ue]);const Yt=()=>{const R={plan_name:me.PLUS,billing_details:c,promo_code:f},U=ye.current.get(JSON.stringify(R));if(U)return h.logEventWithStatsig("Account Pay: Using Prefetched Checkout Session","chatgpt_account_payment_modal_using_prefetched_checkout_session",I),U;h.logEventWithStatsig("Account Pay: Click to Fetch Checkout Session","chatgpt_account_payment_modal_click_to_fetch_checkout_session",I),ye.current.clear();const ee=ue.get("skip_sentinel_checkout",!1);return he(R,"ProducePlus",ee?void 0:v)},Vt=async({skipEmailCheck:R})=>{if(!Ht&&!R){S(!0);return}o(_.PLUS),h.logEvent("Account Pay: Payment Checkout Clicked",I),te(C,"chatgpt_account_payment_modal_upgrade_button_click",be),Le.current=Date.now();try{const U=await Yt();let ee;Le.current&&(ee=Date.now()-Le.current),h.logEvent("Account Pay: Navigating to Payment Checkout",{...I,url:U.url??"",latency_ms:ee});const Ee={url:String(U.url??"")};ee!==void 0&&(Ee.latency_ms=ee.toString()),te(C,"chatgpt_account_payment_modal_navigating_to_checkout",be,Ee),await q(U)}catch{W.warning(M.formatMessage(j.paymentErrorWarning),{hasCloseButton:!0})}o(null)},zt=()=>{L(!0),h.logEventWithStatsig("Cancel Plus: Opened cancel modal","cancel_plus_start",{...I,cancel_start_source:"manage plan"})},$t=()=>{h.logEvent("Account Portal: Click iOS Manage Subscription",I)},qt=()=>{h.logEvent("Account Portal: Click Android Manage Subscription",I)},Kt=E&&ce.purchase_origin_platform===se.MOBILE_IOS,Qt=E&&ce.purchase_origin_platform===se.MOBILE_ANDROID,Zt=E&&(ce.purchase_origin_platform===se.WEBAPP||ce.purchase_origin_platform===se.GRANTED)&&a.hasCustomerObject()&&!k&&E&&a.willRenewSubscription();ne&&!E&&w.push(e.jsx(K,{to:us,target:"_blank",className:"px-2 underline",children:e.jsx(l,{...j.limitsApply})},"row-plus-plan-usage-limits")),Kt&&w.push(e.jsx(K,{to:St,target:"_blank",onClick:$t,className:"px-2 underline",children:M.formatMessage(xe.manageSubscriptionIos.callToAction)},"row-plus-plan-manage-ios")),Qt&&w.push(e.jsx(K,{to:jt,target:"_blank",onClick:qt,children:M.formatMessage(xe.manageSubscriptionAndroid.callToAction)},"row-plus-plan-manage-android")),Zt&&Gt&&w.push(e.jsxs("button",{children:[e.jsx("span",{onClick:zt,className:"cursor-pointer px-2 underline",children:e.jsx(l,{...xe.cancelSubscriptionWeb.callToAction})}),e.jsx(Ks,{isOpen:Q,onClose:()=>L(!1),onCancelationComplete:()=>z(!0),analyticsParams:I})]},"row-cancel-subscription-link")),E&&re&&w.push(e.jsx(K,{target:"_blank",to:qe,onClick:Ze,className:"px-2 underline",children:e.jsx(l,{...j.billingHelp})},"row-plus-plan-help-link"));const Oe=({skipAppStoreSubscriptionInBillingRetryCheck:R=!1,skipEmailCheck:U=!1}={})=>{if(N&&!R)return H(!0);if(r)return r(c,I);we?(h.logEvent("Account Pay: Payment Checkout Clicked",I),te(C,"chatgpt_account_payment_modal_upgrade_button_click",be),X(!0)):Vt({skipEmailCheck:U})},ke=(R,U)=>e.jsx(De,{planType:be,isCurrentPlan:E&&!de,disabled:R,onClick:U,testId:"select-plan-button-plus-upgrade",activeColor:we?"secondary":Jt?"primary":void 0,children:n===_.PLUS&&!O?e.jsx(Ce,{}):de&&E&&b.callToAction.promo?M.formatMessage(b.callToAction.promo):E?M.formatMessage(b.callToAction.active):tt&&Y&&b.callToAction.inactiveUnauthenticated?M.formatMessage(b.callToAction.inactiveUnauthenticated):M.formatMessage(b.callToAction.inactive)});Je(D,{plan:I});const de=u!=null,Jt=u?.promotion_type==="student_discount",tt=u!=null&&"referrer_name"in u,Xt=(!E||de)&&n==null;w=de?[]:w;let st=null;const at=a.getDaysUntilPlanDiscountExpires();if(u!=null?b=pa(M,b,u,c.currency):a.data.subscriptionStatus.discount&&(b.cost=Ft(M,b.cost,a.data.subscriptionStatus.discount),u==null&&(b.summary=oe.plus.plusSummaryWithDiscount,a.data.subscriptionStatus.discount.discount_type===Re.PERCENTAGE&&(st={discount:{percentage:a.data.subscriptionStatus.discount.amount,expires_at:at?ze(at,M.locale):void 0}}))),i!=null&&i)return null;const es=ma(a);return e.jsxs(e.Fragment,{children:[e.jsx(ve,{planName:"plus",pricingPlan:b,showForLine:!E&&!ne,callToActionButton:Fe?e.jsx("div",{className:"relative w-full",children:e.jsx(_e,{side:"bottom",sideOffset:20,label:M.formatMessage(j.highDemandDisabledText),children:ke(!0,()=>{})})}):m&&es?e.jsx("div",{children:e.jsx(_e,{side:"top",sideOffset:20,label:M.formatMessage({id:"I2JCGZ",defaultMessage:"Mobile subscriptions are currently not eligible for this promotion."}),onOpenChange:R=>{R&&!J.current&&(tt&&vs.logMobileSubscriptionTooltipOpen(),J.current=!0)},children:e.jsx("div",{children:ke(!0,()=>{})})})}):e.jsxs("div",{children:[et&&Wt?e.jsx(_e,{side:"top",sideOffset:20,label:e.jsx(l,{id:"8/N1rV",defaultMessage:"Your subscription will change to Plus on {date}.",values:{date:ze(et,M.locale)}}),children:ke(!0,()=>{})}):ke(!Xt,Oe),e.jsx(Ut,{isOpen:ae,onClose:()=>H(!1),onContinue:()=>Oe({skipAppStoreSubscriptionInBillingRetryCheck:!0}),analyticsParams:I}),O&&e.jsx(Ot,{isOpen:O,onClose:()=>X(!1),accountId:a.id,initialPlanType:_.PRO,updatedPlanType:_.PLUS,billingDetails:c})]}),secondaryCallToActionButton:de?e.jsx(G,{size:"large",color:"secondary",onClick:x,children:e.jsx(l,{...j.notNow})}):null,additionalLinks:y?w:[],plusInactive:!fe&&!de,promoMetadata:u,activeDiscountMetadata:st,billingDetails:c,className:s}),e.jsx(le,{testId:"modal-add-email",isOpen:D,onClose:()=>S(!1),type:"success",className:"max-w-sm",children:e.jsx(Ke,{enterEmailTitle:M.formatMessage(j.addEmailTitle),enterEmailDescription:M.formatMessage(j.addEmailDescription),onVerified:()=>{A(),S(!1),Oe({skipEmailCheck:!0})},cancelFlowButton:e.jsx(G,{className:"w-full rounded-md",color:"secondary",onClick:()=>S(!1),children:e.jsx(l,{...j.cancelAddEmail})})})})]})};function pa(t,s,a,n){const{costTitle:i,currencySymbol:r}=ws(s,n),o=i?.defaultMessage?.toString()??"20",p=a.duration?.period??"month",y=a.duration?.num_periods??1,c=ca(p,y,t.locale),f=Ft(t,s.cost,a.discount,a.duration??{num_periods:1,period:"month"}),u=r.code.defaultMessage?.toString()??"USD",x=t.formatNumber(parseFloat(o)||0,{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:2});let m;switch(p){case"month":y===1?m=t.formatMessage(j.promoPlanDisclaimerForSingleMonth,{date:c,cost:x}):m=t.formatMessage(j.promoPlanDisclaimerForPluralMonths,{num_months:y,date:c,cost:x});break;case"year":y===1?m=t.formatMessage(j.promoPlanDisclaimerForSingleYear,{date:c,cost:x}):m=t.formatMessage(j.promoPlanDisclaimerForPluralYears,{num_years:y,date:c,cost:x});break;case"hour":throw new Error("Period 'hour' is not supported")}const P="<article>"+t.formatMessage(j.termsApply)+"</article> "+m;return s={...s,summary:{id:"promoSummary",defaultMessage:a.summary},disclaimer:{id:"promoDisclaimer",defaultMessage:P,article:"https://help.openai.com/en/articles/10492689-chatgpt-plus-promotions-referrals"},cost:f,callToAction:{...s.callToAction,promo:{id:"pricingPlanConstants.promo.callToAction",defaultMessage:"Apply to My Subscription",description:"Payment call to action for existing subscribers adding a discount to their plan"}}},s}function ma(t){const s=t.hasPaidSubscription(),a=t.getLastActiveSubscription(),n=s&&a.purchase_origin_platform===se.MOBILE_IOS,i=s&&a.purchase_origin_platform===se.MOBILE_ANDROID;return n||i}const j=ie({promoPlanDisclaimerForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months. Starting {date}, ChatGPT Plus will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleMonth",defaultMessage:"Promo pricing applies for 1 month. Starting {date}, ChatGPT Plus will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years. Starting {date}, ChatGPT Plus will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleYear",defaultMessage:"Promo pricing applies for 1 year. Starting {date}, ChatGPT Plus will continue at {cost}/year. Cancel anytime."},termsApply:{id:"pricingPlanConstants.termsApply",defaultMessage:"Terms apply."},addEmailTitle:{id:"AccountPaymentModal.addEmailTitle",defaultMessage:"Email required"},addEmailDescription:{id:"AccountPaymentModal.addEmailDescription",defaultMessage:"You'll be able to login with this email. It will also be used for account updates (like password resets) and information about OpenAI services."},cancelAddEmail:{id:"AccountPaymentModal.cancelAddEmail",defaultMessage:"Cancel"},haveExistingPlan:{id:"AccountPaymentModal.haveExistingPlan",defaultMessage:"Have an existing plan?"},billingHelp:{id:"AccountPaymentModel.billingHelp",defaultMessage:"I need help with a billing issue"},paymentErrorWarning:{id:"AccountPaymentModal.paymentErrorWarning",defaultMessage:"The payments page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},accountErrorWarning:{id:"AccountPaymentModal.accountErrorWarning",defaultMessage:"The account management page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},limitsApply:{id:"xda4i3",defaultMessage:"Limits apply"},notNow:{id:"AccountPaymentModal.notNow",defaultMessage:"Not Now"},highDemandDisabledText:{id:"AccountPaymentModal.highDemandDisabledText",defaultMessage:"Due to high demand, we've temporarily paused upgrades."}}),Ne=_.TEAM,ga=({analyticsParams:t,planLoading:s,billingDetails:a})=>{const{data:n,refetch:i}=Se(Qe),r=$(),o=$e(),p=pt(),[y,c]=g.useState(!1),f=o&&o.isTeam(),u=o&&o.isPlus(),x={...t,planType:Ne},m=!!n?.email;let P=ks();const B=Fs(),{data:T}=Dt(B??""),A=Ts,N=T?.coupon===Es&&T?.state==="eligible";let v=null;N&&(P={...P,cost:{...P.cost,costInDollars:A.promoCost,costInPounds:A.promoCost,costInEuros:A.promoCost,costDuration:A.promoCostDuration},disclaimer:A.team1dollarPromoDisclaimer},v={plan_name:"chatgptteamplan",title:"",summary:"",discount:{value:0,currency_code:"USD"},duration:{num_periods:1,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null});const C=Y=>{if(!m&&!Y){c(!0);return}h.logEvent("Account Pay: Payment Checkout Clicked",x),Be.logEvent("chatgpt_account_payment_modal_upgrade_button_click",Ne),As.setPurchaseWorkspaceData({minimumSeats:Ns,billingDetails:a,promoData:T?.state==="eligible"?T:void 0}),ms(p)};return Je(y,{plan:x}),e.jsxs(e.Fragment,{children:[e.jsx(ve,{planName:"team",elementId:wt,pricingPlan:P,promoData:T,promoMetadata:v,callToActionButton:e.jsxs("div",{className:"flex flex-col gap-2",children:[f&&e.jsx(De,{planType:Ne,isCurrentPlan:!0,disabled:s!=null||f,onClick:()=>C(),testId:"select-plan-button-teams-upgrade",children:r.formatMessage(P.callToAction.active)}),e.jsx("div",{className:"w-full",children:e.jsx(De,{planType:Ne,isCurrentPlan:!1,disabled:s!=null,onClick:()=>C(),testId:"select-plan-button-teams-create",children:f||u?r.formatMessage(P.callToAction.create):r.formatMessage(P.callToAction.inactive)})})]}),billingDetails:a}),e.jsx(le,{testId:"modal-add-email",isOpen:y,onClose:()=>c(!1),type:"success",className:"max-w-sm",children:e.jsx(Ke,{enterEmailTitle:r.formatMessage(j.addEmailTitle),enterEmailDescription:r.formatMessage(j.addEmailDescription),onVerified:()=>{c(!1),i(),C(!0)}})})]})},fa=()=>Se({queryKey:["has-app-store-subscription-in-billing-retry"],queryFn:async()=>await vt.safeGet("/subscriptions/has_app_store_subscription_in_billing_retry")}),Pe="pro",ha=({analyticsParams:t,currentAccount:s,planLoading:a,onSubmit:n,setPlanLoading:i,billingDetails:r,variant:o})=>{const{data:p,isError:y}=fa(),c=Ue(),f=s.features,{data:u,refetch:x}=Se(Qe),m=$(),P=je(),[B]=ss(),T=B.get("checkout_from"),[A,N]=g.useState(!1),[v,C]=g.useState(!1),[Y,M]=g.useState(!1),W=s.getLastActiveSubscription(),Q=s.isOrWasPaidCustomer(),L=s.hasPaidSubscription(),b=L&&s.isPro(),V=!!u?.email,{prepareCheckoutSession:Z,navigateToCheckout:J}=Nt(),{recentlyDowngraded:ae}=Xe(),{daysUntilPlanChanges:H,isDowngradeScheduled:O}=Bt(s,ae),X=ot(c,"1719651090"),D=Ds({isOperatorEnabled:X}),S=[],d={...t,planType:Pe},k=L&&W.purchase_origin_platform===se.MOBILE_IOS,z=L&&W.purchase_origin_platform===se.MOBILE_ANDROID,w=async q=>{if(!V&&!q){M(!0);return}i(_.PRO),h.logEvent("Account Pay: Payment Checkout Clicked",d),te(c,"chatgpt_account_payment_modal_upgrade_button_click",Pe);try{const ne=await Z({plan_name:"chatgptpro",billing_details:r},"ProducePro",f);n?.(),h.logEvent("Account Pay: Navigating to Payment Checkout",{...d,url:ne.url??""}),te(c,"chatgpt_account_payment_modal_navigating_to_checkout",Pe,{url:ne.url??""}),T==="vza493q"&&Ge.setItem(We.CheckoutFrom,T),await J(ne)}catch{P.warning(m.formatMessage(j.paymentErrorWarning),{hasCloseButton:!0})}i(null)},re=()=>{h.logEvent("Account Portal: Click iOS Manage Subscription",d)},fe=()=>{h.logEvent("Account Portal: Click Android Manage Subscription",d)};b&&k&&S.push(e.jsx(K,{to:St,target:"_blank",onClick:re,className:"px-2 underline",children:m.formatMessage(xe.manageSubscriptionIos.callToAction)},"row-plus-plan-manage-ios")),b&&z&&S.push(e.jsx(K,{to:jt,target:"_blank",onClick:fe,children:m.formatMessage(xe.manageSubscriptionAndroid.callToAction)},"row-plus-plan-manage-android")),Q&&S.push(e.jsx(K,{target:"_blank",to:qe,onClick:Ze,className:"px-2 underline",children:e.jsx(l,{...j.billingHelp})},"row-plus-plan-help-link"));const E=function(){N(!A)},we=function(){C(!v)},ce=ot(c,"1382475798"),ue=async()=>{let q=s.hasPaidSubscription()&&s.isPlus();ce&&(q=q&&!s.isActiveSubscriptionGratis()),q?(h.logEvent("Account Pay: Payment Checkout Clicked",d),te(c,"chatgpt_account_payment_modal_upgrade_button_click",Pe),C(!0)):await w()},he=y||!p||!p.value?ue:()=>{E()};return Je(Y,{plan:d}),e.jsxs(e.Fragment,{children:[e.jsx(ve,{planName:"pro",pricingPlan:D,showForLine:!1,callToActionButton:e.jsxs("div",{children:[s.isWorkspacePlan()&&o==="operator"?e.jsx(G,{fullWidth:!0,size:"large",color:"primary",disabled:!0,"data-testid":"select-plan-button-pro-upgrade",children:m.formatMessage(dt.switchToPersonalAccount)}):k||z?e.jsx(_e,{side:"top",sideOffset:20,label:m.formatMessage(dt.switchToMobile),onOpenChange:q=>{q&&(h.logEvent("Account Pay: Show Mobile Subscription Tooltip",d),te(c,"chatgpt_account_payment_modal_show_mobile_subscription_tooltip",Pe))},children:e.jsx(G,{fullWidth:!0,size:"large",color:"primary",disabled:!0,"data-testid":"select-plan-button-pro-upgrade",children:m.formatMessage(D.callToAction.inactive)})}):O&&H?e.jsx(_e,{side:"top",sideOffset:20,label:e.jsx(l,{id:"jgTAPh",defaultMessage:"Your subscription will remain active until {date}, when it will change to Plus.",values:{date:ze(H,m.locale)}}),children:e.jsx(G,{fullWidth:!0,size:"large",color:"primary",disabled:b||a!=null,"data-testid":"select-plan-button-pro-upgrade",className:b||a!=null?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold":"",children:a===_.PRO&&!v?e.jsx(Ce,{}):b?m.formatMessage(D.callToAction.active):m.formatMessage(D.callToAction.inactive)})}):e.jsx(G,{fullWidth:!0,size:"large",color:"primary",disabled:b||a!=null,onClick:he,"data-testid":"select-plan-button-pro-upgrade",className:b||a!=null?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold":"",children:a===_.PRO&&!v?e.jsx(Ce,{}):b?m.formatMessage(D.callToAction.active):m.formatMessage(D.callToAction.inactive)}),e.jsx(Ut,{isOpen:A,onClose:E,onContinue:w,analyticsParams:d}),v&&e.jsx(Ot,{isOpen:v,onClose:we,accountId:s.id,initialPlanType:_.PLUS,updatedPlanType:_.PRO,billingDetails:r})]}),additionalLinks:S,className:"bg-token-main-surface-primary",billingDetails:r}),e.jsx(le,{testId:"modal-add-email",isOpen:Y,onClose:()=>M(!1),type:"success",className:"max-w-sm",children:e.jsx(Ke,{enterEmailTitle:m.formatMessage(j.addEmailTitle),enterEmailDescription:m.formatMessage(j.addEmailDescription),onVerified:()=>{x(),M(!1),w(!0)},cancelFlowButton:e.jsx(G,{className:"w-full rounded-md",color:"secondary",onClick:()=>M(!1),children:e.jsx(l,{...j.cancelAddEmail})})})})]})},dt=ie({switchToPersonalAccount:{id:"y5FjSF",defaultMessage:"Switch to a personal account to upgrade"},switchToMobile:{id:"gbjsg6",defaultMessage:"It looks like you already have an active mobile subscription. Switch to your mobile app to upgrade"}});function ya({analyticsParams:t,currentAccount:s,planLoading:a,selectedTab:n,setPlanLoading:i,shouldSplitBetweenPersonalAndBusiness:r,isEnterpriseEnabled:o,billingDetails:p,variant:y,shouldShowMemoryUpsell:c,onClose:f}){const u=[],x=s.hasPaidSubscription();return y==="operator"?(x&&s.isPlus()&&u.push("plus"),u.push("pro")):r?n==="personal"?(x||u.push("free"),u.push("plus"),u.push("pro")):u.push("team"):(x||u.push("free"),(!s.isTeam()||!s.isEnterprisey()&&o)&&(u.push("plus"),u.push("pro")),u.push("team")),u.length===0&&kt.addError(new Error("Account payment modal missing columns")),u.map(m=>{switch(m){case"free":return e.jsx(zs,{billingDetails:p},m);case"plus":return e.jsx(da,{analyticsParams:t,currentAccount:s,setPlanLoading:i,planLoading:a,billingDetails:p,shouldShowMemoryUpsell:c,onClose:f},m);case"team":return e.jsx(ga,{analyticsParams:t,billingDetails:p,currentAccount:s,planLoading:a},m);case"enterprise":return e.jsx(Vs,{billingDetails:p},m);case"pro":return e.jsx(ha,{analyticsParams:t,currentAccount:s,setPlanLoading:i,planLoading:a,billingDetails:p,variant:y},m)}})}function Ea({currentAccount:t,defaultTab:s="personal",hasEnterpriseFooter:a=!0,onClose:n,subtitle:i,title:r,variant:o="default"}){const[p,y]=g.useState(null),c=as(),f=ns(),u=gs(),x=Ue(),m=fs(x,"2330365894").get("enabled",!1),P=(u||m)&&o!=="operator",B=g.useMemo(()=>({...t.subscriptionAnalyticsParams,referrer:document.referrer}),[t]),T=pt(),A=je(),N=g.useCallback(()=>{h.logEvent("Account Pay: Close Account Payment Modal",B),n()},[B,n]),v=Is();g.useEffect(()=>{const d=localStorage.getItem(`subscriptionUpdateMessage_${t.id}`);if(d){localStorage.removeItem(`subscriptionUpdateMessage_${t.id}`),A.success(d,{hasCloseButton:!0});const k=setTimeout(()=>{N()},5e3);return()=>{clearTimeout(k)}}},[t.id,A,N]);const[C,Y]=g.useState(s),{country:M,setCountry:W,userCountry:Q}=Ls(),L=Ma({currentAccount:t,selectedTab:C}),b=Os({country:L?M:bs,currentAccount:t,location:"AccountPaymentModal",shouldUsePaidSubscriptionBillingCurrency:C==="personal"});Us(()=>{const d=c.state?.[hs],k=c.key;d&&T({hash:c.hash,search:c.search},{replace:!0,state:{}}),ys.count(Ms.DEFAULT,"chatgpt_account_payment_modal_show",[{key:"location",value:d},{key:"locationKey",value:k},{key:"navigationType",value:f},{key:"initialTab",value:s},{key:"initialCountrySelectorCountry",value:M},{key:"selectedCountry",value:b.country??""},{key:"selectedCurrency",value:b.currency??""},{key:"userCountry",value:Q??""},{key:"isCountrySelectorEnabled",value:String(L)}]),h.logEventWithStatsig("Account Pay: Account Payment Modal Show","chatgpt_account_payment_modal_show",{...B,initialTab:s,location:d,locationKey:k,navigationType:f,initialCountrySelectorCountry:M,selectedCountry:b.country??"",selectedCurrency:b.currency??"",userCountry:Q??"",isCountrySelectorEnabled:L})});const V=g.useCallback(d=>{kt.addAction("chatgpt_selected_country_changed_in_pricing_modal",{old_selected_country:M,new_selected_country:d}),h.logEventWithStatsig("Selected country changed in pricing modal","chatgpt_selected_country_changed_in_pricing_modal",{old_selected_country:M,new_selected_country:d}),W(d)},[M,W]),Z=d=>{Y(d),h.logEventWithStatsig("Account Pay: Account Payment Modal Toggle Clicked","chatgpt_account_payment_modal_toggle_clicked",{selectedTab:d})},J=136,[ae,H]=g.useState(),O=g.useRef(null);g.useEffect(()=>{const d=()=>{if(O.current){const k=document.documentElement.clientHeight,z=O.current.getBoundingClientRect().height,w=k-z;H(Math.max(w,J))}};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[C]);const X=ya({analyticsParams:B,currentAccount:t,planLoading:p,selectedTab:C,setPlanLoading:y,shouldSplitBetweenPersonalAndBusiness:P,isEnterpriseEnabled:!1,billingDetails:b,variant:o,shouldShowMemoryUpsell:v,onClose:n}),D=ba({defaultTitle:r,hasProSubscription:t.isPro()}),S=g.useRef(!1);return g.useEffect(()=>{if(m)return;const d=document.getElementById(wt);if(!(!d||!d.scrollIntoView||S.current)){if(O.current&&!P&&s==="business")d.scrollIntoView({behavior:"smooth"}),h.logEvent("Account Pay: Account Payment Modal Scroll",{selectedTab:"business",scrollSource:"auto"}),S.current=!0;else if(!P){const k=new IntersectionObserver(z=>{z.some(w=>w.isIntersecting)&&(h.logEvent("Account Pay: Account Payment Modal Scroll",{selectedTab:"business",scrollSource:"manual"}),S.current=!0,k.disconnect())},{root:null,threshold:.5});return k.observe(d),()=>k.disconnect()}}},[t,s,m,P]),e.jsxs(le,{testId:"modal-account-payment",size:"fullscreen",isOpen:!0,onClose:N,type:"success",className:"flex flex-col",removePopoverStyling:!0,children:[e.jsxs("div",{ref:O,children:[e.jsxs("div",{className:"relative grid grid-cols-[1fr_auto_1fr] px-6 py-4 md:pt-[4.5rem] md:pb-10",children:[e.jsx("div",{}),e.jsxs("div",{className:"my-1 flex flex-col items-center justify-center md:mt-0 md:mb-0",children:[e.jsx("div",{className:"text-2xl font-semibold md:text-3xl",children:e.jsx(l,{...D})}),i?e.jsx("div",{className:"text-token-text-secondary mt-3 mb-1",children:e.jsx(l,{...i})}):null]}),e.jsx("button",{className:"text-token-text-primary justify-self-end opacity-50 transition hover:opacity-75 md:absolute md:end-6 md:top-6",onClick:()=>{N()},children:e.jsx(yt,{className:it({"h-5 w-5":!u,"icon-lg":u})})})]}),t.isPersonalAccount()&&P?e.jsx("div",{className:"mb-3 flex justify-center md:mb-10",children:e.jsx("div",{className:"w-[fit-content]",children:e.jsx(Gs,{value:C,onChange:Z})})}):null,e.jsx("div",{className:"flex flex-col justify-center gap-4 px-3 py-3 md:min-h-[30rem] md:flex-row md:gap-0 md:py-0",children:X})]}),e.jsxs("div",{className:"relative grid grid-cols-[1fr_auto_1fr]",style:{height:`${ae}px`},children:[e.jsx("div",{}),a?e.jsxs("span",{className:"text-token-text-secondary mt-8 mb-12 flex flex-col items-center justify-start gap-2 text-sm md:mt-8 md:mb-8",children:[e.jsx(Bs,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(l,{...Ie.needMoreCapabilities}),e.jsx("div",{children:e.jsx(l,{...Ie.seeChatGptEnterprise,values:{link:d=>e.jsx(K,{target:"_blank",to:gt,onClick:()=>{h.logEventWithStatsig("Account Pay: Click see enterprise link from Modal","chatgpt_account_payment_modal_enterprise_link_clicked")},className:"mx-1 underline",children:d})}})})]})]}):null,e.jsx("span",{"data-testid":"country-selector-in-pricing-modal",className:it({hidden:!L},"text-token-text-primary justify-self-end opacity-50 transition hover:opacity-75 md:absolute md:end-4 md:bottom-4"),children:e.jsx(Rs,{onChange:V,value:M})})]})]})}function Ma({currentAccount:t,selectedTab:s}){return!!(!t.hasPaidSubscription()||(t.isPlus()||t.isPro())&&s==="business"||t.isTeam())}function ba({defaultTitle:t,hasProSubscription:s}){return t||(s?Ie.proModalTitle:Ie.modalTitle)}const Ie=ie({modalTitle:{id:"AccountPaymentModal.modalTitle",defaultMessage:"Upgrade your plan"},proModalTitle:{id:"AccountPaymentModal.proModalTitle",defaultMessage:"Choose your plan"},modalFooterCapabilities:{id:"AccountPaymentModal.modalFooterCapabilities",defaultMessage:"Need more capabilities? See <link> ChatGPT Enterprise </link>"},needMoreCapabilities:{id:"SdJWr7",defaultMessage:"Need more capabilities for your business?"},seeChatGptEnterprise:{id:"7C5fuF",defaultMessage:"See<link>ChatGPT Enterprise</link>"},promoNotEligibleMessage:{id:"AccountPaymentModal.promoNotEligibleMessage",defaultMessage:"Thanks for being a susbcriber. Since you already use ChatGPT Plus, you're not eligible for this offer."}});export{Ea as A,da as P,aa as T,la as a,Xs as b,na as c,Ot as d,ka as g,Ze as h};
//# sourceMappingURL=mpc64wzn0wwiuplc.js.map
