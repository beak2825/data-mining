const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/akv9mvl7u3gwbwrr.js","assets/egb2c0f6p1ew61vt.js","assets/fyeo2h7okrqcf3nz.js","assets/root-dql6y2cb.css","assets/ixsisjuxwij5x7d3.js","assets/f7j18j5u52u1pnnk.js","assets/conversation-small-k592qa8k.css","assets/lqc3mxovgoy4h7eq.js","assets/mzdwbfzlwdoj9187.js","assets/mtx41j31lzyyzsit.js","assets/jrm7m26zzbmpv5fw.js","assets/euyyz74sa52ztdnb.js","assets/lk4s8c9e8k6949av.js","assets/f2cokc4vvw85wf3h.js","assets/odn3jimzeso6ws9q.js","assets/g286r35f18ua9byd.js","assets/c2a98abxd5dbzvf7.js","assets/jlvrtz9al5nbcxs8.js","assets/gs9mey20bowp7r2m.js","assets/f6lef7nylw7b0x4b.js","assets/nqsfh48hfyfa7pp4.js","assets/gayt6avnfip5st7p.js","assets/fpsokuu2p45yfc9a.js","assets/gy64pge8qevmvg7e.js","assets/n61zxws1b0jnnt86.js","assets/jxu0jvvr8sbqjtgc.js","assets/frssgcsnopobc4rz.js","assets/mdthwp98uuoo76j2.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,M as H,e as Z,k as mt,n as Y,f as la,I as ca,J as da,ar as Gt,A as xs,u as vs,R as ua,p as ma}from"./fyeo2h7okrqcf3nz.js";import{hs as bs,bg as ga,bh as pa,bi as ha,a_ as fa,pW as xa,pX as va,hu as ba,pY as ya,pZ as Ta,p_ as Sa,b1 as _a,ot as ja,cP as Ia,h7 as Ca,f9 as ys,p$ as ot,h9 as Ma,q0 as rt,q1 as ka,j1 as Ts,q2 as Ht,q3 as wa,q4 as Ea,q5 as Ue,q6 as Ra,lp as Se,dp as xe,jx as Pa,kn as Aa,q7 as Fa,q8 as Ss,q9 as Na,L as _s,kp as Ba,ln as qa,qa as js,f3 as Da,kM as Ua,f5 as ne,es as La,j7 as Oa,j8 as Ga,kv as Vt,dk as Ha,kw as Va,eX as Is,a8 as Cs,fv as Wa,qb as za,qc as $a,qd as Ms,qe as Ya,pf as Ka,nB as ks,U as ws,cB as Qa,cC as Xa,cD as Ja,cE as Za,qf as eo,hm as to,qg as so,c3 as no,qh as ao,qi as oo,f7 as ro,mR as Es,e as io,a5 as lo,a6 as co,hg as uo,n3 as mo,bf as go,qj as po,eV as ho,qk as Wt,ql as fo,em as Rs,qm as xo,qn as vo,h0 as bo,i_ as yo,z as To,c6 as zt,qo as So,qp as _o,qq as jo,qr as Io,qs as Co,qt as Mo,qu as ko,mG as wo,qv as Eo,m3 as Ps,qw as Ro,qx as Po,qy as Ao,qz as $t,qA as Fo,qB as No,qC as Bo,qD as qo,qE as Do,qF as Uo,qG as Lo,i$ as Oo,lM as Yt,qH as Go,bm as Ho,lm as Vo,qI as Wo,qJ as zo,qK as $o,eW as Yo,qL as Ko,qM as Qo,qN as Xo,qO as Jo,qP as Zo,qQ as er,aT as tr,dn as sr,iC as nr}from"./f7j18j5u52u1pnnk.js";import{cZ as oe,c_ as me,q as re,jI as Kt,gq as Qt,gr as Xt,dv as ar,Q as te,ay as Ve,dy as or,dx as Jt,dw as rr,ea as ir,d4 as As,bB as Ge,b9 as Fs,R as Ns,hr as Bs,w as lr,d3 as qs,m8 as cr,b6 as dr,cQ as ur,B as He,aZ as Ds,dI as mr,em as gr,b7 as ye,bn as je,aM as M,H as O,bD as G,f as D,fF as pr,jb as hr,bE as ve,be as _e,bs as gt,d0 as fr,by as Us,x as pt,dG as Ls,o as xr,G as Zt,D as it,P as z,hX as be,gL as Os,j as vr,aR as ae,f8 as br,ef as Gs,gG as Hs,f0 as yr,ba as Tr,bb as Sr,kZ as _r,bc as jr,aP as Ir,cg as We,ch as Vs,br as ht,m9 as Cr,bC as Ws,aS as Ie,i8 as Mr,cd as kr,F as wr,a$ as Er,lY as es,bp as fe,dV as Rr,hg as Pr,cv as zs,kp as Ar,kt as at,i7 as Fr,bq as Nr,ma as Br,ax as qr,f3 as Dr,cE as $s,j5 as Ur,jK as Lr,j6 as Or,ja as Gr,aw as Hr,es as Vr,kv as Wr,cl as zr,S as Le,mb as Ys,bT as $r,bU as Yr,jy as Kr,cI as Qr,fV as Oe,lW as Xr,hI as Jr,ku as Zr,hp as ei,iK as ti,ka as si,ft as ni,hR as ai,lL as oi}from"./egb2c0f6p1ew61vt.js";import{d as ri,b as lt}from"./mtx41j31lzyyzsit.js";import{e as ii,f as Ks,d as li}from"./lqc3mxovgoy4h7eq.js";import"./bomum2mkkc55wkmd.js";import{r as ci}from"./ixsisjuxwij5x7d3.js";import{a as di}from"./np62wv8wj4i0jtdl.js";import{M as ui,O as mi}from"./g286r35f18ua9byd.js";import{C as ct}from"./cv2ja3m1kj318n5b.js";import{m as gi}from"./falvn1u1m9kfl56g.js";const pi=oe(async()=>me(()=>import("./akv9mvl7u3gwbwrr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(t=>t.ImageGenNewEditor));function Tl({postWithProfile:t,clientThreadId:n,onClose:a}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(hi,{postWithProfile:t,clientThreadId:n,onClose:a}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(fi,{postWithProfile:t,onClose:a}):null}function hi({postWithProfile:t,clientThreadId:n,onClose:a}){const s=l.useRef(null),[o,r]=l.useState(!1),[d,c]=l.useState(!1),i=mt(),{post:g}=t,h=g.attachments[g.attachments.length-1],p={url:h.url,content_type:Xt.ImageAssetPointer,asset_pointer:h.asset_pointer??Qt(h.id),size_bytes:0,width:h.width,height:h.height},T=Z(),x=ar(),S=te(n),_=Ve(),j=l.useCallback(I=>x.getState().files.find(f=>f.tempId===I),[x]),E=h.url,W=l.useCallback(async I=>{if(s.current){const f=await s.current,v=f?j(f?.tempId):null;if(v)return v}return s.current=fetch(I).then(f=>f.blob()).then(f=>{const v=new File([f],"image.png",{type:"image/png"}),y=or(v);return Jt.uploadFile(x,y,v,rr.Multimodal,[v.type],T,_).then(()=>{const C=j(y);return C&&C.status===ir.Ready&&C.fileId?C:null})}),s.current},[x,T,_,j]),{onRequestCompletion:U}=ii(),{isUnauthenticated:N}=As(),b=l.useCallback(async I=>{if(!(!I.promptMessage||N)){c(!0);try{const f=await W(E);if(!f||!f.fileId||!f.fileSpec)return;const v=[{content_type:Xt.ImageAssetPointer,asset_pointer:Qt(f.fileId),size_bytes:f.fileSpec.size,width:h.width,height:h.height},...I.promptMessage.content.content_type===Ge.MultimodalText||I.promptMessage.content.content_type===Ge.Text?I.promptMessage.content.parts:[]],y={...I,promptMessage:{...I.promptMessage,content:{content_type:Ge.MultimodalText,parts:v}},extraStreamParams:{...I.extraStreamParams??{},continueFromSharedPostId:g.id}};U(y),a(),Jt.reset(x)}catch{_.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}finally{c(!1)}}},[h.height,h.width,W,U,x,E,a,N,_,g.id]),R=e.jsx(Qs,{post:g,setIsReportModalOpen:r,onClose:a,additionalButtons:e.jsx(va,{imageAsset:p,serverThreadId:S})});return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(fa,{children:e.jsx(pi,{image:p,isLoadingNewImage:!1,clientThreadId:n,onClose:()=>{a(),i("/",{replace:!0})},onRequestCompletion:b,editorControls:R,messageId:g.id,footer:d?e.jsx(xi,{}):null})}),o&&e.jsx(Xs,{post:g,onClose:()=>r(!1)})]})}function fi({postWithProfile:t,onClose:n}){const[a,s]=l.useState(!1),{post:o}=t;return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(Qs,{post:o,setIsReportModalOpen:s,onClose:n}),e.jsx(xa,{attachments:o.attachments,variant:"fullscreen"}),a&&e.jsx(Xs,{post:o,onClose:()=>s(!1)})]})}function Qs({post:t,setIsReportModalOpen:n,onClose:a,additionalButtons:s}){const o=mt(),r=Z(),d=Ve(),c=l.useCallback(async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Ns.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),o("/",{replace:!0})}catch{d.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[t.id,r,d,o]);return e.jsx(e.Fragment,{children:e.jsxs(Y.div,{className:"flex h-16 w-full px-2 sm:px-4",...ba,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(ya,{onClose:()=>{a(),o("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(Ta,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:n})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(Sa,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:c,children:e.jsx(_a,{})}),s]})]})})}function xi(){const t=Z();return e.jsxs(Y.div,{className:"shadow-token-border-default pointer-events-none inline-flex items-center justify-center gap-1.5 self-center rounded-[16px] px-3.5 py-2 text-sm shadow-lg",transition:{duration:.3,ease:"easeInOut"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(Fs,{}),e.jsx("span",{children:t.formatMessage({id:"postReceiverModal.preparingImage",defaultMessage:"Preparing image..."})})]})}function Xs({post:t,onClose:n}){const a=re(),{data:s}=ga(a,Kt.Post),o=Z(),r=pa(a,o,t.id,Kt.Post);if(s==null)return null;const d=`Report ${t.text??"Post"}`;return e.jsx(ha,{reasons:s.reasons,submitReport:r,title:d,onClose:n,header:s.header,subHeader:s.header_explanation})}function vi(){const t=l.useContext(bs),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(H,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(Bs,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(Ia,{className:"rounded-full",label:"",icon:e.jsx(qs,{className:"icon-sm"})}),children:e.jsx(lr.Item,{icon:ja,onClick:()=>a(!0),children:e.jsx(H,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function Sl(){const t=l.useContext(bs),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(H,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:s=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:s})}})})}const bi="Continue",yi=({clientThreadId:t,messages:n})=>{const a=re(),s=l.useMemo(()=>n.some(c=>c.metadata?.stop_reason===cr.RiskyDomainNotWatching),[n]),o=di(t),[r,d]=l.useState(!1);return e.jsx(dr,{testId:"modal-watch-mode-stopped",isOpen:s&&!r,type:"success",size:"normal",onClose:ur,className:"p-1",title:e.jsx("div",{className:"font-semibold",children:e.jsx(H,{id:"8FmSDC",defaultMessage:"Task paused while you were away"})}),primaryButton:e.jsx(He,{onClick:()=>{ci({ctx:a,clientThreadId:t,eventSource:"mouse",promptMessage:mr(bi,{}),completionMetadata:{systemHints:[gr],conversationMode:{kind:Ds.PrimaryAssistant}}})},children:e.jsx(H,{id:"4rrYz9",defaultMessage:"Resume"})}),secondaryButton:e.jsx(He,{color:"secondary",onClick:()=>d(!0),children:e.jsx(H,{id:"yg+V5e",defaultMessage:"Stay paused"})}),children:e.jsx(H,{id:"Wdb/cy",defaultMessage:"ChatGPT is working with {riskyDomain}, which contains sensitive data. To resume, keep your browser's tab open and monitor actions.",values:{riskyDomain:e.jsx("span",{className:"font-medium",children:o})}})})},ts=oe(()=>me(()=>import("./c2a98abxd5dbzvf7.js"),__vite__mapDeps([16,1,2,3,5,6,17,18])).then(t=>t.MemoryActionResult));function ss(t,n,a){_e(t,s=>{gt.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const ns=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function Ti(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(Js,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Si,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function Si(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=ft(),d=Ts(),c=pr(),[i,g]=a,h=l.useMemo(()=>hr(i+g)()>=.5,[i,g]),[p,T]=h?[g,i]:[i,g],[x,S,_]=ve(n,b=>{const R=Zt(b).tree.getLeafFromNode(p).id,I=Zt(b).tree.getLeafFromNode(T).id,f=O.getConversationTurns(b,R),v=O.getConversationTurns(b,I),y=s<f.length?f[s]:null,C=s<v.length?v[s]:null;return y||it.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:f.length,lastTurnRole:M(f)?.role,lastMessageAuthor:M(M(f)?.messages)?.author,lastMessageContentType:M(M(f)?.messages)?.content.content_type,lastMessageMetadata:M(M(f)?.messages)?.metadata,altTurnCount:v.length,altLastTurnRole:M(v)?.role,altLastMessageRole:M(M(v)?.messages)?.author.role}),C||it.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:v.length,lastTurnRole:M(v)?.role,lastMessageAuthor:M(M(v)?.messages)?.author,lastMessageContentType:M(M(v)?.messages)?.content.content_type,lastMessageMetadata:M(M(v)?.messages)?.metadata,altTurnCount:f.length,altLastTurnRole:M(f)?.role,altLastMessageRole:M(M(f)?.messages)?.author.role}),[R,y,C]}),[j,E]=h?[_,S]:[S,_],W=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(Ht.setState({displayingSideBySideFeedback:!0}),()=>{Ht.setState({displayingSideBySideFeedback:!1})}),[]);const U=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),N=l.useCallback((b,{shouldSubmitParagenFeedback:R=!0}={})=>{if(!S||!_||!j||!E)throw new Error("Expected both turns to exist");_e(n,k=>{gt.setCurrentBranch(k,b)});const I=b===p,f=b===i;j.messages.length>0&&ss(n,j.messages[j.messages.length-1].id,f?"original":"new"),E.messages.length>0&&ss(n,E.messages[E.messages.length-1].id,f?"original":"new");const v=te(n),y=[S,_].map((k,w)=>({messageId:k.messages[k.messages.length-1].id,loadFirstTokenTime:w===0?o.current.left:o.current.right,loadEndTime:M(k.messages)?.clientMetadata?.completionSampleFinishTime})),C=I?y[0].messageId:y[1].messageId,m=O.getParentPromptNode(je(n),x);if(!m)throw new Error("Expected prompt for side by side feedback");const B={},P=m.message.clientMetadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;for(const k of y)B[k.messageId]=P?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:k.loadFirstTokenTime,load_end_time:k.loadEndTime};R&&cs({params:{conversation_id:v,displayed_message_ids:y.map(k=>k.messageId),message_metadatas:B,rating:"selected",selected_message_id:C,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:m.message.id}})},[n,p,i,j,E,S,_,x,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>fr(Us,{requestCompletion:b=>{const R=te(n),I=O.getParentPromptNode(je(n),x);if(!I)throw new Error("Expected prompt for side by side feedback");if(!S||!_)throw new Error("Expected both turns to exist");const f=[S,_].map((m,B)=>({messageId:m.messages[m.messages.length-1].id,loadFirstTokenTime:B===0?o.current.left:o.current.right,loadEndTime:M(m.messages)?.clientMetadata?.completionSampleFinishTime})),v={},y=I.message.clientMetadata?.variantsInStreamInfo==null&&I.message.metadata?.paragen_variants_info!=null;for(const m of f)v[m.messageId]=y?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:m.loadFirstTokenTime,load_end_time:m.loadEndTime};const C=b.isForSkippingParagen;cs({params:{conversation_id:R,displayed_message_ids:f.map(m=>m.messageId),message_metadatas:v,rating:C?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:C?3:r?2:1,user_prompt_message_id:I.message.id}}),C&&N(p,{shouldSubmitParagenFeedback:!1})}}),[S,_,x,n,t.conversationTurnMountTime,W,j?.messages,E?.messages,c,r,o,N,p]),e.jsx(Js,{...t,setPreferredFeedback:N,leftVariantId:p,rightVariantId:T,leftTurn:S,rightTurn:_,hasActiveRequest:d,originalTurn:j,visibilityStateRef:U})}function Js({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:d,visibilityStateRef:c,...i}){const g=(s&&ns(s))??null,h=(o&&ns(o))??null,p=l.useMemo(()=>s?.messages??[],[s?.messages]),T=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:S}=i,_=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),j=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),E=Ca(),W=je(i.clientThreadId),U=M(s?.messages),N=M(o?.messages),b=ys(O.getRequestId(W,U?.id??N?.id)),R=b&&!U?.end_turn,I=b&&!N?.end_turn,f=U!=null&&ot(U),v=N!=null&&ot(N),y=f??v,C=s?.role===G.User,m=o?.role===G.User,B=l.useRef(null),P=l.useRef(null),k=l.useRef(null),w=s!=null,se=o!=null;!w&&S.current.left==null&&(S.current.left=Date.now()),!se&&S.current.right==null&&(S.current.right=Date.now()),l.useEffect(()=>{if(B.current&&P.current&&k.current){const Te=Array(11).fill(0).map((le,$)=>$/10),ie=new IntersectionObserver(le=>le.forEach($=>{$.target===P.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=$.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,$.intersectionRatio)):$.target===k.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=$.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,$.intersectionRatio))}),{root:B.current,threshold:Te});return ie.observe(P.current),ie.observe(k.current),()=>ie.disconnect()}},[c]);const{data:ge}=Ma(void 0,!1,E),L=ft(),pe=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",L?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(H,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),L?pe:null]}),L?null:pe,e.jsx("div",{className:D(ka,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:B,children:e.jsxs("div",{className:D("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",L&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!L&&"gap-4 sm:gap-6"),children:[e.jsxs(as,{horizontalScrollContainerRef:B,rootElementRef:P,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:w,isImageGenInProgress:y,children:[e.jsxs(is,{children:[e.jsx(rt,{messages:p,isUserTurn:C,avatarClassName:x}),e.jsx(rs,{children:e.jsx(H,{...ds.responseNumber,values:{responseIndex:1,display_label:g}})})]}),L&&w?e.jsx(os,{}):e.jsxs(e.Fragment,{children:[ge!=null&&!C&&e.jsx(ts,{clientThreadId:i.clientThreadId,messages:p,isParagen:!0}),e.jsx(ct,{...i,allMessages:p,groupedMessagesToRender:_,allGroupedMessages:_,isUserTurn:C,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:R,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(ls,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:d})]})]}),e.jsxs(as,{horizontalScrollContainerRef:B,rootElementRef:k,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:se,isImageGenInProgress:y,children:[e.jsxs(is,{children:[e.jsx(rt,{messages:T,isUserTurn:m,avatarClassName:x}),e.jsx(rs,{children:e.jsx(H,{...ds.responseNumber,values:{responseIndex:2,display_label:h}})})]}),L&&se?e.jsx(os,{}):e.jsxs(e.Fragment,{children:[ge!=null&&!m&&e.jsx(ts,{clientThreadId:i.clientThreadId,messages:T,isParagen:!0}),e.jsx(ct,{...i,allMessages:T,groupedMessagesToRender:j,allGroupedMessages:j,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:m,isCompletionRequestInProgress:I,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(ls,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:d})]})]})]})})]})}function as({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r,isImageGenInProgress:d}){const c=ft(),{scrollX:i}=ca({layoutEffect:!1,container:t,target:n}),g=wa(),h=Ea(),p=l.useRef(null),T=l.useRef(null),x=l.useRef(null),[S,_]=l.useState(!1),[j,E]=l.useState(!1),[W,U]=l.useState(!1),[N,b]=l.useState(0);l.useEffect(()=>{if(!c)return;const m=new IntersectionObserver(B=>{for(const P of B)P.target===p.current?_(P.isIntersecting):P.target===x.current?U(P.isIntersecting):P.target===T.current&&E(P.isIntersecting)},{root:g?.current});return p.current&&T.current&&x.current&&(m.observe(p.current),m.observe(T.current),m.observe(x.current)),()=>{m.disconnect()}},[N,c,g]);const R=!W&&(j||S),I=da(i,m=>R?-1*m:0),f=Gt(0);l.useEffect(()=>{if(!c)return;const m=new ResizeObserver(B=>{Ue(B.length===1,"entryList.length === 1");const P=B[0];Ue(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),f.set(P.contentBoxSize[0].inlineSize)});return n.current&&m.observe(n.current),()=>{m.disconnect()}},[c,f,n]);const v=Gt(0);l.useEffect(()=>{if(!c)return;const m=new ResizeObserver(B=>{Ue(B.length===1,"entryList.length === 1");const P=B[0];Ue(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),v.set(P.contentBoxSize[0].blockSize+16),b(P.contentBoxSize[0].blockSize)});return h.current&&m.observe(h.current),()=>{m.disconnect()}},[c,v,h]);const y=e.jsx(He,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),C=r||d;return e.jsx("div",{"data-paragen-root":!0,className:D("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:D(Ra,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:D("absolute top-48 right-0! left-0! h-px","invisible"),ref:p}),e.jsx("div",{className:D("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:T}),e.jsx("div",{className:D("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:x}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:C?null:e.jsx(Y.div,{style:{translateX:I,width:f,bottom:v},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:R,"z-20 flex w-full justify-center":!0}),children:y})}):o||d?null:y]})})}function os(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ue,{className:"h-4 w-[75%]"}),e.jsx(ue,{className:"h-4 w-[50%]"}),e.jsx(ue,{className:"h-4 w-[80%]"}),e.jsx(ue,{className:"h-4 w-[55%]"}),e.jsx(ue,{className:"h-4 w-[66%]"}),e.jsx(ue,{className:"h-4 w-[64%]"}),e.jsx(ue,{className:"h-4 w-[48%]"})]})}function ft(){const t=re();return pt(t,"3119715334").get("should-enable-hojicha",!1)}const rs=ye.div`text-sm text-token-text-secondary font-semibold`,is=ye.div`flex gap-4 items-center mb-1`,ue=ye.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function ls({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=Ls();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const d=a.messages[a.messages.length-1],c=d?.metadata?.__internal,i=d?.metadata?.paragen_display_label;if(c){const{model_id:p,model_definition_slug:T,model_definition_virtual_model_id:x,alternative_model_selection_rule:S,augmented_paragen_prompt_group_id:_,augmented_paragen_prompt_id:j,augmented_paragen_prompt:E}=c;p&&(r+=`
Model ID: ${p}`),T&&(r+=`
Model Slug: ${T}`),x&&(r+=`
Virtual Model ID: ${x}`),S&&(r+=`
Alternative Model Rule: ${S}`),_&&(r+=`
Prompt Group ID: ${_}`),j&&(r+=`
Prompt ID: ${j}`),E&&(r+=`
Prompt: ${E}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${d.id}`;const g=O.getParentPromptNode(je(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const h=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${h}`,r+=`
Completion Sample Finish Time: ${h?`${n} (persisted)`:M(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function cs({params:t}){await Ns.safePost("/paragen_submission",{requestBody:t,authOption:xr.SendIfAvailable})}const ds=la({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function Zs({followups:t,analyticsMetadata:n}){const a=l.useRef(!1),s=Ks();return l.useEffect(()=>{a.current||(a.current=!0,t.forEach((o,r)=>{z.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...be(n),action:"show",position:(r+1).toString(),followup_text:Se(o)})}))},[t,n]),e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((o,r)=>e.jsx(Y.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},children:e.jsx(_i,{followUp:o,onSelectingSuggestedReply:s,analyticsMetadata:n,position:r})},r))})}const en=ye.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function _i({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(Y.button,{whileHover:"hover",className:D("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-0 py-3 text-start"),onClick:o=>{n(o,t,[],0),z.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...be(a),action:"click",position:(s+1).toString(),followup_text:Se(t)})},onMouseEnter:()=>{z.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...be(a),action:"hover",position:(s+1).toString(),followup_text:Se(t)})},children:[e.jsx(Y.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(xe,{className:"text-token-text-secondary icon"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:Se(t)})]})}const ji=()=>e.jsx(Os,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Ii=t=>({[ae.Search]:"Web Search",[ae.Research]:"Research",[ae.PictureV2]:"Draw Image",[ae.Think]:"Think Harder"})[t]??"Title",dt=(t,n,a,s,o)=>{z.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...be(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Ci=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{dt("show",s,n,o+1,t.length)}))},[t,n])},tn=({suggestions:t,analyticsMetadata:n,style:a="default"})=>{const s=Ks();return Ci(t,n),e.jsx(e.Fragment,{children:t.map((o,r)=>e.jsxs(Y.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:r*.03},className:D("w-full flex-1",a==="compact"&&"flex-col"),children:[a==="compact"&&r>0&&e.jsx(en,{$isSelected:!1}),e.jsx(Mi,{suggestion:o,onSelectingSuggestedReply:s,position:r+1,numSuggestions:t.length,analyticsMetadata:n,style:a})]},o.prompt))})},Mi=({suggestion:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,numSuggestions:o,style:r="default"})=>{const{setThreadSystemHintMode:d}=Pa(),c=vr(),i=mt();return e.jsx(Y.button,{onClick:g=>{if(dt("click",t,a,s,o),t.categoryId===ae.Research)if(c?.isFree()){br(i,"Suggested Capabilities Upsell");return}else d(t.categoryId,!0,a);n(g,t,[],0)},onMouseEnter:()=>{dt("hover",t,a,s,o)},className:D("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(ki,{suggestion:t}):e.jsx(wi,{suggestion:t})})},ki=({suggestion:t})=>{const{systemHints:n}=Gs(),a=l.useMemo(()=>t.categoryId==="ask"?void 0:n?.find(s=>s.systemHint===t.categoryId),[n,t.categoryId]);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:t.categoryId==="ask"?e.jsx(xe,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"}):e.jsx(Hs,{svgString:a?.logo??"",className:"text-token-text-secondary icon group-hover:text-token-interactive-label-accent-default"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:Se(t)})]})},wi=({suggestion:{categoryId:t,imageUrl:n,description:a,title:s,ctaLabel:o,prompt:r}})=>{const{systemHints:d}=Gs(),c=l.useMemo(()=>t==="ask"?void 0:d?.find(i=>i.systemHint===t),[d,t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[t===ae.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${n})`},children:e.jsx(Aa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:s??Ii(t)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((i,g)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},g))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(Fa,{isBadge:!0,className:"opacity-100",logo:e.jsx(Hs,{svgString:c?.logo??"",className:"icon"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:a??r}),o&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[o,e.jsx(Y.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(yr,{className:"icon-sm"})})]})]})]})},ut=(t,n,a,s)=>{z.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...be(a),tabId:n,position:s,action:t})},Ei=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ut("show",s.value,n,o+1)}))},[t,n])},Ri=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:g,suggestions:h})=>({value:i,message:g,suggestions:h?.map(Ss)??[]})),[d,c]=l.useState(r[0].value);return Ei(r,s),e.jsxs(Tr,{value:d,onValueChange:c,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(Sr,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,g)=>e.jsx(Ai,{value:i.value,message:i.message,isActive:d===i.value,analyticsMetadata:s,position:g+1},i.value))}),r.map(i=>e.jsx(_r,{value:i.value,children:e.jsx(Pi,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:d===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},Pi=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:d="default"})=>{const c=te(n),i=s&&t.length===0,{suggestions:g,isLoading:h}=Na({categoryId:a,shouldFetch:i,serverThreadId:c,lastMessageId:o}),p=i?g:t;return a==="ask"?h?e.jsx(ji,{}):e.jsx(Zs,{followups:p.map(T=>({type:_s.Reply,text:T.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:h?e.jsxs(e.Fragment,{children:[e.jsx(us,{}),e.jsx(us,{})]}):e.jsx(tn,{suggestions:p,analyticsMetadata:r,style:d})})},Ai=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(jr,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{ut("click",t,s,o)},onMouseEnter:()=>{ut("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(xs,{children:a&&e.jsx(Y.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),us=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Os,{lines:3,size:"sm"})})]}),Fi=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],d=r.suggestions.length>0?r.suggestions:void 0;return o&&d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(H,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(tn,{suggestions:d.map(Ss),analyticsMetadata:s,style:r.style})]}):e.jsx(Ri,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})},Ni=(t,n,a,s,o)=>{z.logEventWithStatsig("Agent Suggestion Action","chatgpt_agent_suggestion_action",{...be(a),capability:n.capability,position:s,action:t,numSuggestions:o})},Bi=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Ni("show",s,n,o+1,t.length)}))},[t,n])},qi=({agentSuggestions:t,analyticsMetadata:n})=>(Bi(t,n),e.jsx(e.Fragment,{children:t.map((a,s)=>e.jsxs(Y.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:s*.03},className:D("w-full flex-1","flex-col"),children:[s>0&&e.jsx(en,{$isSelected:!1}),e.jsx(Di,{agentSuggestion:a,analyticsMetadata:n})]},a.prompt))})),Di=({agentSuggestion:t})=>{const n=li(),a=Ui(t.capability),s=Ir(),o=()=>{n.setText(t.prompt),s("agent"),n.focus()};return e.jsxs("div",{onClick:o,className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:opacity-100",children:e.jsx(a,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:t.title})]})},ms={action:Ba,research:xe,spreadsheet:xe,presentation:xe,default:xe},Ui=t=>ms[t]??ms.default;function Li({clientThreadId:t,followups:n,categorySuggestions:a,actionSuggestions:s,lastMessageId:o,analyticsMetadata:r,isTatertotFollowupsEnabled:d}){const c=We(Vs),i=qa.useIsEnabled(t)&&!c,{capabilitySuggestionsEnabled:g}=js(d),h=a&&a.length>0;return s&&s.length>0?e.jsx(qi,{agentSuggestions:s,analyticsMetadata:r}):e.jsx(e.Fragment,{children:i&&(g?h&&e.jsx(Fi,{clientThreadId:t,lastMessageId:o,categorySuggestions:a,analyticsMetadata:r}):n.length>0&&e.jsx(Oi,{followups:n,analyticsMetadata:r}))})}function Oi({followups:t,analyticsMetadata:n}){return e.jsxs("div",{className:"group",children:[e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}),e.jsx(Zs,{followups:t,analyticsMetadata:n})]})}async function Gi(t,n,a,{unprocessed:s=!1}={}){const o=[],r=[],d={};for(const c of t.messages){if(sn(c)){const i=c.metadata?.content_references,g=ht(c);if(s)o.push(g);else{const h=gi(g,i);h["text/plain"]&&o.push(h["text/plain"]),h["text/html"]&&r.push(h["text/html"])}}if(Cr(c)){const i=Ws.getImageAssetPointers(c);if(i.length>0){const g=i[0];try{const h=te(a),{url:p}=await Da.fetch(n,{asset:g,conversationId:h??void 0}),x=await(await fetch(p)).blob();["image/png","image/jpeg","image/webp"].includes(x.type)&&(d[x.type]=x)}catch{return Promise.reject()}}}}return o.length>0&&(d["text/plain"]=o.join(`

`)),r.length>0&&(d["text/html"]=r.join(`

`)),d}function sn(t){return!t.clientMetadata?.err&&(t.author.role===G.Assistant||t.author.role===G.User)&&(t.author.role===G.User||t.recipient==="all")&&!t.metadata?.reasoning_status}const nn=({turn:t})=>{const n=Ua(),a=Z(),s=re(),o=Ie(s,"1894790777");function r(){Oa.logButtonClick(Ga.EDIT_IN_CANVAS_MESSAGE);const d=Hi(t);n&&Vt.removeTempTextdoc(n.textdocId);const c=Vt.createTempTextdoc(d,a.formatMessage({id:"9e0Zzr",defaultMessage:"New document"}),Ha.MESSAGE);requestAnimationFrame(()=>{Va(c)})}return e.jsx(ne,{icon:La,onClick:r,label:a.formatMessage({id:"EditInCanvas.tooltip",defaultMessage:"Edit in canvas"}),asMenuItem:o})};function Hi(t){return t.messages.filter(n=>sn(n)&&n.author.role===G.Assistant).map(n=>ht(n,{shouldGetTextFromContentReferences:!0,shouldGetVisibleText:!1})).filter(Boolean).join(`

`)}const an=oe(()=>me(()=>import("./f6lef7nylw7b0x4b.js"),__vite__mapDeps([19,2,1,3,20,21,5,6,22,23])).then(t=>t.VoicePlayButton));function Vi({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:c,turnIndex:i,requestId:g}){const p=Z().formatMessage({id:"e/27r7",defaultMessage:"More actions"});return e.jsx(Bs,{triggerButton:e.jsx("button",{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:w-10 flex h-8 w-8 items-center justify-center rounded-lg",onMouseOver:()=>{an.prefetch()},"aria-label":p,children:e.jsx(qs,{className:"icon"})}),size:"auto",contentAlign:"start",alignOffset:-7,side:"top",sideOffset:4,tooltip:p,children:e.jsx(Wi,{showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:c,turnIndex:i,requestId:g})})}function Wi({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:c,requestId:i}){const g=Z();return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(an,{conversationId:s,message:r}),n&&e.jsx(nn,{turn:c}),!1,e.jsx(Is,{children:({openScheduleModal:h,isScheduled:p,isSchedulable:T})=>!p&&T?e.jsx(ne,{icon:Cs,label:g.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:h,trailing:e.jsx(H,{id:"Vn8LDj",defaultMessage:"Internal"}),asMenuItem:!0}):null}),!1,!1,!1]})}const on=async(t,n,a,s,o,r="mouse",d)=>{const i=O.getConversationTurns(je(n))[a];if(!i)return Promise.reject();const{messages:g}=i,h=o,p=g[0]?.author.role===G.User,T=h.metaKey||h.altKey,x=await Gi(i,d,n,{unprocessed:T||p});await Wa(x,s,o);const S=te(n);S&&za(t,{messageId:g[0].id,type:"copy",serverThreadId:S,selectedText:ht(g[0]),source:r,location:"message"})},zi=oe(()=>me(()=>import("./f6lef7nylw7b0x4b.js"),__vite__mapDeps([19,2,1,3,20,21,5,6,22,23])).then(t=>t.VoicePlayButton)),$i=oe(async()=>()=>null),Yi=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:D("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"min-h-[46px] justify-start"),children:e.jsx("div",{ref:s,className:D("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex flex-wrap items-center gap-y-4 p-1 select-none",!n&&"touch:w-[calc(100%+--spacing(3.5))] -mt-1 w-[calc(100%+--spacing(2.5))]",t&&!n&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Ki=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:d,onRate:c,showCanvasButton:i,showCopyButton:g,showPagination:h,showPlayButton:p,showRatingButtons:T,showRegenerateButton:x,turn:S,turnIndex:_})=>{const j=re(),E=Z(),W=Ve(),U=vs(),N=We(Mr),b=Ie(j,"1894790777"),R=s?.clientMetadata?.rating,I=s?.clientMetadata?.requestId,{imageGenMessages:f,canvasMessage:v,enableImageGenPostSharing:y,enableMessageSliceSharing:C,hasErrorInTurn:m,isIncomplete:B}=Ya(o),P=Ka.useSelectedIndex(),k=o.filter(kr).filter(K=>K.recipient==="all"),w=f.length>0,se=v!=null,ge=wr(),L=te(n),pe=Er(j),Te=w&&k.length===0&&f.some(es),ie=o.some(K=>K.metadata?.n7jupd_message),le=L!=null&&!m&&!B&&!ie&&pe;let $=null;return le&&(y||C?$=e.jsx(Ji,{clientThreadId:n,imageGenMessageId:f[P]?.id,messages:o}):ge&&pt(j,"1547743984").get("show_share_button_inline",!1)&&($=e.jsx(ne,{onClick:()=>{L&&ws.openSharingModal(L)},label:E.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:ks}))),s&&ot(s)&&!es(s)?null:e.jsxs(e.Fragment,{children:[h&&e.jsx(Ms,{currentPage:t,onChangeIndex:d,length:r}),g&&!Te&&!N&&e.jsx(rn,{onClick:K=>{on(j,n,_,W,K,"mouse",U)}}),T&&!w&&e.jsxs(e.Fragment,{children:[R!=="thumbsDown"&&e.jsx(ne,{onClick:()=>c("thumbsUp"),disabled:R==="thumbsUp",icon:R==="thumbsUp"?Qa:Xa,label:E.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),R!=="thumbsUp"&&e.jsx(ne,{onClick:()=>c("thumbsDown"),disabled:R==="thumbsDown",icon:R==="thumbsDown"?Ja:Za,label:E.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&k.length>0&&!b&&e.jsx(zi,{conversationId:n,message:s,iconClassName:"icon",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),i&&!w&&!se&&!b&&!N&&e.jsx(nn,{turn:S}),$,!1,x&&s&&!N&&e.jsx(Xi,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:w}),b&&!N&&e.jsx(Vi,{showPlayButton:!!(p&&s&&k.length>0),showCanvasButton:!w&&i,showJujutsuButton:le&&Ie(j,"3096078201"),turnIndex:_,clientThreadId:n,messages:o,imageGenMessageId:f[P]?.id,lastMessage:s,turn:S,requestId:I}),!b&&e.jsx(Is,{children:({openScheduleModal:K,isScheduled:ze,isSchedulable:Ce})=>!ze&&Ce?e.jsx(ne,{icon:Cs,label:E.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:K}):null}),!1,!1,null]})},Qi=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:d,showEditMessageButton:c,showPagination:i,turnIndex:g})=>{const h=re(),p=Ve(),T=vs();return e.jsxs(e.Fragment,{children:[d&&e.jsx(rn,{onClick:x=>{on(h,n,g,p,x,"mouse",T)}}),c&&e.jsx($a,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(Ms,{currentPage:t,onChangeIndex:o,length:a})]})},Xi=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o})=>{const r=no({clientThreadId:t,conversationMode:n}),d=ao(t,o),c=l.useCallback(({sourceEvent:i,requestedModelId:g,appendMessages:h,extraStreamParams:p})=>{o&&r({sourceEvent:i,nodeId:o.id,requestedModelId:g,appendMessages:h,extraStreamParams:p})},[o,r]);return s?e.jsx($i,{messages:a,onModelSelect:c}):e.jsx(oo,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:c,canRegenerateResponse:d})},rn=({onClick:t})=>{const[n,a]=l.useState(!1),s=eo(),o=Z(),r=l.useCallback(d=>{d.stopPropagation(),z.logEvent("ChatGPT Turn Action Copy Clicked"),t(d),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),fe.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ne,{icon:n?Rr:to,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function Ji({clientThreadId:t,imageGenMessageId:n,messages:a}){const[s,o]=l.useState(!1),r=Z(),d=l.useMemo(()=>n?"media_generation":"message_slice",[n]),c=a?.map(g=>g.id)??void 0,i=so({clientThreadId:t,imageGenMessageId:n,messageSliceIds:c});return l.useEffect(()=>{z.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action",attachment_type:d})},[d]),e.jsx(ne,{onClick:async()=>{o(!0);try{await i()}finally{o(!1)}z.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action",attachment_type:d})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?Fs:ks,disabled:s})}const Zi=oe(()=>me(()=>import("./c2a98abxd5dbzvf7.js"),__vite__mapDeps([16,1,2,3,5,6,17,18])).then(t=>t.MemoryActionResult)),el=oe(()=>me(()=>import("./n61zxws1b0jnnt86.js"),__vite__mapDeps([24,2,1,3,5,6,25])).then(t=>t.AutomationSourceHeader)),gs=oe(()=>me(()=>import("./frssgcsnopobc4rz.js"),__vite__mapDeps([26,2,1,3,5,6,27])).then(t=>t.TextMessageEditor)),ps=80,tl=16;function hs(){return{minHeight:`calc(100dvh - ${Lo}px - 120px - ${Ys()}px)`}}function sl(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:d,showAvatar:c,scrollToMessageId:i,dateHeaderType:g,hideUserActions:h}=t,p=re(),T=ro(p,s),x=Es(p),S=io();l.useContext(Pr);const[_,j]=We(u=>[Vs(u),zs(u)]),E=!!S&&Ar(S),W=lo(co.isBusinessWorkspace),U=Uo(),N=!!c,[b,R,I]=ve(s,u=>{const F=O.getConversationTurnAtIndex(u,n),q=n>0?O.getConversationTurnAtIndex(u,n-1):null,A=q?.role===G.User&&q.messages.some(Q=>Q.metadata?.visually_hide_response_from_conversation);return[F,A,q]}),{messages:f,messageGroups:v}=b,y=uo(u=>u.size===0?-1:v.findIndex(F=>F.type===at?F.groups.some(q=>q.messages.some(A=>u.has(A?.id))):F.messages.some(q=>u.has(q?.id)))),C=f[0],m=M(f);v.some(u=>u.type===Fr.SearchGPTQuery);const[B,P]=l.useState(!1),k=l.useMemo(()=>f.some(u=>u.metadata?.n7jupd_message),[f]),{messages:w,visibleMessages:se,messageGroups:ge,lastMessageToRender:L}=l.useMemo(()=>{const u=y!==-1&&y+1<v.length,F=u?v.slice(0,y+1):v,q=u?F.flatMap(A=>A.type===at?A.groups.flatMap(Q=>Q.messages):A.messages):f;return{messages:q,visibleMessages:q.filter(Nr),messageGroups:F,lastMessageToRender:M(q)}},[f,v,y]),pe=y!==-1,Te=Ie(p,"1887864177"),ie=ri(),le=ve(s,u=>O.getLastMessageSystemHints(u)),$=Br(),K=le?.includes(ae.Tatertot)&&Ie(p,"28816792")&&$,{capabilitySuggestionsEnabled:ze}=js(K),Ce=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:m?.id}),[s,n,m?.id]),[xt,vt]=l.useState(!1),[bt,ln]=l.useState(!1),cn=l.useContext(mo)!=null,V=b.role===G.User,yt=qr(),Me=Dr(s),$e=go(b.gizmoId??Me).data,Ye=$s(s),dn=Ur(s),Tt=Lr(Ye),un=Or(Ye,dn),St=Gr(),[mn,gn,_t,ke,Ke,pn,hn,fn,jt,xn,ce,It,we,vn,rl]=ve(s,u=>{const F=O.getParentPromptNode(u,C.id),q=F?.message.clientMetadata?.variantsInStreamInfo??(F?.message.metadata?.paragen_variant_choice?void 0:F?.message.metadata?.paragen_variants_info),A=O.getVariantIds(u,C.id),Q=O.getCurrentVariantId(u,C.id),nt=Q?A.indexOf(Q):0,ia=q&&u?.tree!=null&&A.some(ee=>{const{errType:Ot}=u.tree.getLeafFromNode(ee).message.clientMetadata??{};return Ot!=null&&Ot!=="info"}),De=O.getConversationTurns(u);return[O.isMessageTurnEnded(u,m?.id),ia,Oo(u?.mode,$e?.gizmo.id),u?.continuingFromSharedConversationId!=null,De.findIndex(ee=>ee.role===G.User)===n,Yt(De,ee=>ee.role===G.User)===n,De.findIndex(ee=>ee.role===G.Assistant)===n,Yt(De,ee=>ee.role===G.Assistant)===n,O.getRequestId(u,m?.id),q,A,nt,!!u?.continuingFromSharedPostId,u?.currentLeafId,O.getSuperWidgetMessages(u,n)[0]]}),Ee=Hr(()=>{const u=T.asyncStatus$();return u?.value===Le.STREAMING||u?.value===Le.REALTIME}),bn=w.some(u=>u.content.content_type===Ge.MultimodalText),yn=pt(p,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Ct}=As(),Mt=b.messages.map(u=>u.id),X=l.useRef(null),kt=!x&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&U,Re=V?M(se):void 0,Qe=Re?.id,Tn=l.useCallback(()=>{Qe&&(z.logEvent("Edit Prompt",{id:Qe,threadId:te(s)}),Vr(p,"chatgpt_edit_prompt"),vt(!0))},[p,Qe,s]),Sn=l.useCallback(()=>{vt(!1)},[]),wt=Wr()??!1,{onChangeRating:_n}=po({clientThreadId:s,currentModelConfig:Ye}),jn=u=>{if(!m)return;_n({nodeId:m.id,messageId:m.id,rating:u});const F=wt&&v.some(q=>q.type!==at&&q.messages?.some(Zr));z.logEventWithStatsig(u==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:m.id,threadId:te(s),model:r,rating:u,...wt?{isCATriggered:F}:{}}),ln(!0)},[In]=l.useState(()=>Date.now()),Cn=zr(s),Et=ho(s)?.value,Mn=Et===Le.STREAMING,kn=Et===Le.REALTIME,wn=jt!=null,En=ys(jt),Rn=Wt.useState(u=>Wt.isReplayInProgress(u,vn)),J=!mn&&En||pe||kn||Rn&&a,Rt=Ts(),Pt=l.useRef(!1),Pn=fo(s,m),[,An]=ma(),{isOpen:Xe}=lt(),At=Rs();l.useEffect(()=>{const F=new URLSearchParams(window.location.search).get("message");!(F!=null&&Mt.includes(F))||!X.current||(X.current.scrollIntoView({behavior:"instant"}),An(A=>(A.delete("message"),A),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(x)return;const q=new URLSearchParams(window.location.search).get("message")!=null;if(Pt.current||q||i===void 0||!X.current||At){i==="finalAgentTurn"&&a&&_e(s,A=>{A.scrollToMessageId=void 0});return}(Mt.includes(i)||i==="finalAgentTurn"&&a)&&(Pt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(X.current)if(i==="finalAgentTurn"&&a)X.current.scrollIntoView({behavior:"instant",block:"end"}),_e(s,A=>{A.scrollToMessageId=void 0});else{const A=X.current.offsetHeight;let Q=0;Xe?Q=-8:_?Q=0:A>ps&&(Q=ps-A);const nt=_?Ys():tl;X.current.style.scrollMarginTop=`${Q+nt}px`,X.current.scrollIntoView({behavior:"smooth"})}})}))},[i,X.current,Xe,At]);const{showDebugConversationTurns:Fn}=Ls(),Nn=xo(s),Bn=!ke&&!we&&!yt&&!V,qn=L?.author.role===G.Assistant?L:null,Dn=L?.metadata?.system_hints?.includes(ae.Research);vo({isCompletionRequestInProgress:J,isUserTurn:V,message:qn});const{isOpen:Un}=lt(),Ln=bo(),Pe=yo(_t),Ae=!Pe&&Bn&&a&&xn?.num_variants_in_stream===2&&ce.length<=2&&!m?.clientMetadata?.inlineComparisonRating&&!gn,On=To(u=>u.voiceFeedbackThread),Ft=Cn===On,Gn=m?.metadata?.async_source,Fe=a&&wn,he=Ee||J||Mn,Je=!xt&&!ke&&!we&&!Pe&&!Un&&!j&&b.role!==G.Developer&&!(b.role===G.User&&h)&&!(a&&Ft&&he)&&!(Fe&&he)&&!(a&&Ee&&Gn)&&!(he&&k)&&!m?.metadata?.is_auto_proceed_message&&!m?.metadata?.is_takeover_ended_message,Hn=!Je&&!(Fe&&he)&&(ke||we),Vn=w.some(u=>$r(u)===Yr.l1239dk1),Ze=ve(s,u=>{const F=new Set;return O.getParentPromptNode(u,C.id)?.message.metadata?.attachments?.forEach(A=>{A.mime_type?.startsWith("image/")||F.add(A.context_connector_info?.context_connector??"file")}),F}),et=Kr(),tt=Qr(p,"110789670");let de;et.isLoading?de=void 0:et.canUpgradeGDrive&&Ze.has(Oe.GDRIVE)&&tt.get("enabled",!1)?de=Oe.GDRIVE:et.canUpgradeSharepoint&&Ze.has(Oe.O365_BUSINESS)&&tt.get("enabled",!1)?de=Oe.O365_BUSINESS:Ze.has("file")&&tt.get("enabled",!1)&&(de="general");const Wn=Fe&&!J&&!j&&!ke&&!we&&!Vn&&(Te||ie||ze||K||!!de),Ne=m!=null&&(!W||un||E||St)&&!Pe&&!Ct&&!yt&&!m.metadata?.b1de6e2_s,Nt=(!W||St)&&Ne&&(Fe||a&&Ft)&&!Ee&&!J&&!j&&!Xe&&!k,Bt=!((J||Ee)&&a)&&ce.length>1&&!Ae,qt=V&&w.some(u=>zt(u)?.shouldHideContent),zn=V&&Re!=null&&!Pe&&!bn&&!qt&&!Ct&&!Dn,$n=m!=null&&(m.clientMetadata?.disclaimers??[]).length===0;M(I?.messages.filter(Xr));const Dt=l.useCallback(u=>{_e(s,F=>{gt.setCurrentBranch(F,ce[u])}),z.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ce]),Yn=So(b,w,Fn),{toggleThreadSidebar:Ut}=Jr(),Be=m?.id,Kn=l.useCallback(()=>{Be&&Ut({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Be})},[Be,Ut,s,n]),Qn=l.useMemo(()=>_o(b,Tt,!!Me),[Tt,Me,b]),Xn=l.useMemo(()=>w.some(u=>zt(u)?.canRetry===!1),[w]),Jn=m?.metadata?.n7jupd_button_type,Zn=k&&m!=null&&m.id!=null&&!Jn,ea=k&&a&&he,ta=k&&a;if(!Yn&&!Ae)return kt?e.jsx("div",{style:hs()}):null;if(R)return null;const sa=L?.metadata?.followup_prompts?L.metadata.followup_prompts.map(u=>({text:u,type:_s.Reply})):[],na=L?.metadata?.category_suggestions,aa=L?.metadata?.action_suggestions,oa=!w.some(u=>Ws.getAudioAssetPointers(u).length>0)&&!Me&&!Xn,ra=!J&&w.some(u=>u.author.role===G.Assistant&&u.metadata?.onboarding?.main_usages),st=w.find(u=>!!u.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Lt=!qt&&(!a||!J);if(Nn&&!a&&se.length===0&&!k)return null;let qe="none";return V&&Ke&&(qe="first"),V&&!Ke&&(qe="large"),a&&(qe="last"),e.jsx(jo.Provider,{value:hn,children:e.jsxs(Io,{children:[e.jsx(Co,{dateHeaderType:g,turn:b}),e.jsxs("article",{className:D("text-token-text-primary w-full",!x&&i==="finalAgentTurn"&&U?"opacity-0":"",{hidden:cn&&Ke}),style:kt?hs():void 0,ref:X,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!x&&a,children:[e.jsx(Mo,{role:b.role}),e.jsx(ko,{role:b.role,children:e.jsxs(wo,{horizontalPadding:Ae?"none":"standard",verticalPadding:qe,children:[Ae?e.jsxs(e.Fragment,{children:[e.jsx(Ti,{isFeedbackEnabled:Ne,variantIds:ce,conversationTurnMountTime:In,...t}),yn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(He,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Us.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(Eo,{className:"text-token-text-secondary me-1"}),e.jsx(H,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ps,{tabIndex:-1,className:D("group/turn-messages focus-visible:outline-hidden",B&&"super-widget-visible",V&&!Je&&!j&&"mb-10"),children:e.jsxs(e.Fragment,{children:[!V&&N&&e.jsx(al,{children:e.jsx(rt,{messages:w,isUserTurn:V,avatarClassName:d,gizmo:$e})}),e.jsx("div",{className:Ro({isUserTurn:V}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!1,!V&&e.jsx(Zi,{messages:w,clientThreadId:s,gizmoId:$e?.gizmo.id}),Ln&&!V&&e.jsx(el,{clientThreadId:s,messages:w}),xt&&Re?e.jsx(gs,{message:Re,clientThreadId:s,onRequestCompletion:o,onExitEdit:Sn,disabled:Rt}):e.jsx(ct,{allMessages:f,groupedMessagesToRender:ge,allGroupedMessages:v,...t,isUserTurn:V,isFinalUserTurn:pn,isFinalAssistantTurn:fn,isCompletionRequestInProgress:J,isFeedbackEnabled:Ne,isFinalTurn:a,hasActiveRequest:Rt,hasN7JUPD:k}),Qn&&e.jsx(Po,{handleShowRetrievalResults:Kn,clientThreadId:s,turnIndex:n,responseComplete:!he}),Zn&&e.jsx(Ao,{message:m,clientThreadId:s,turnIndex:n,referenceMessageId:m.id,responseComplete:!a||!J}),ra&&e.jsx(ui,{clientThreadId:s}),st&&st.length>0&&!J&&e.jsx(mi,{clientThreadId:s,examples:st}),Je&&e.jsx("div",{className:"mx-[var(--mini-thread-content-inset)]",children:e.jsx(Yi,{isUserTurn:V,alwaysShow:!0,children:V?_?null:e.jsx(Qi,{activeVariantIndex:It,clientThreadId:s,numVariants:ce.length,onAnticipateEdit:gs.prefetch,onChangeIndex:Dt,onEnterEdit:Tn,showCopyButton:Lt,showEditMessageButton:zn,showPagination:Bt,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(Ki,{activeVariantIndex:It,clientThreadId:s,conversationMode:_t,lastMessage:m,messages:w,numVariants:ce.length,onChangeIndex:Dt,onRate:jn,showCanvasButton:Pn,showCopyButton:Lt,showPagination:Bt,showPlayButton:$n,showRatingButtons:Ne,showRegenerateButton:oa,turn:b,turnIndex:n}),e.jsx($t,{clientThreadId:s,message:m,turnIndex:n}),Nt&&e.jsx(Fo,{canShowInlineMessageFeedback:bt,clientThreadId:s,messageForRating:m})]})})}),ea&&e.jsx(No,{clientThreadId:s}),ta&&e.jsx(yi,{clientThreadId:s,messages:w}),Hn&&e.jsx($t,{clientThreadId:s,message:m,turnIndex:n}),Nt&&e.jsx(Bo,{canShowInlineMessageFeedback:bt,clientThreadId:s,messageForRating:m,allGroupedMessages:v,currentModelId:r}),Wn&&(de?e.jsx(qo,{clientThreadId:s,connectorToUpsell:de,analyticsMetadata:Ce}):e.jsx(Li,{followups:sa,actionSuggestions:aa,categorySuggestions:na,clientThreadId:s,lastMessageId:Be,analyticsMetadata:Ce,isTatertotFollowupsEnabled:K}))]})})})]})}),e.jsx(Do,{clientThreadId:s,turn:b,isFinalTurn:a})]})})]})]})})}const nl=ua.memo(sl),al=ye.div`shrink-0 flex flex-col relative items-end`;function _l(t){const{prefetchNavlink:n,clearPrefetchNavlink:a,clientThreadId:s,pageLoadSearchQuery:o}=t,r=re(),d=Es(r),c=Go(s),i=Ho(),g=Vo(),{isOpen:h}=lt(),p=g.store.useContentAreaDimensions(Wo.Header,x=>x?.height?x.height:void 0);let T=e.jsx(ol,{isNewScrollEnabled:d,...t});return T=e.jsx(Yo,{clientThreadId:s,children:T}),e.jsxs("div",{onCopy:c,className:D("@thread-xl/thread:pt-header-height flex flex-col text-sm",i&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",p?null:!d&&(h?"max-sm:pb-25":"pb-25")),style:{paddingBottom:p},children:[o&&e.jsx("div",{children:e.jsx(zo,{query:o})}),n?e.jsx(ei,{name:"prefetch-navlink",onError:x=>{it.addError("Error with prefetch navlink",{error:x}),a()},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx($o,{clientThreadId:s,prefetchNavlink:n,clearPrefetchNavlink:a})})}):null,e.jsx(ti,{children:T})]})}function ol({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,isNewScrollEnabled:s}){const[o,r,d,c]=ve(n,y=>[y?.mode,O.getConversationTurnIds(y),y?.conversationOrigin===si.APPLE,y?.scrollToMessageId]),i=ni(),g=Rs(),h=ai(),p=Ko(),[T]=Qo(),x=Xo(),[S]=Jo(),_=$s(n),j=Zo(_.id),E=o?.kind===Ds.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":j;l.useEffect(()=>{i&&(fe.logEvent("chatgpt_continue_conversation_page_loaded"),z.logEvent("Continue Conversation: Page Loaded"),fe.logEvent("chatgpt_conversation_share_page_loaded"),z.logEvent("Share Public Chat: Shared Conversation Loaded"))},[i]);const W=l.useCallback(()=>{s||p({behavior:"smooth"})},[s,p]),U=We(zs),[N,b]=l.useState(!1),R=(N||!1)&&!U,I=l.useRef(null),f=er(n),v=g&&!h;return e.jsxs(e.Fragment,{children:[v&&e.jsx(vi,{}),i&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(H,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{ws.openModal(tr.ReportConversation),fe.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),z.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(H,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),r.map((y,C)=>e.jsx(nl,{isFinalTurn:C===r.length-1,turnIndex:C,clientThreadId:n,onRequestCompletion:t,currentModelId:_.id,avatarClassName:E,scrollToBottom:s?void 0:W,scrollToMessageId:s?void 0:c,dateHeaderType:f(C),showAvatar:void 0,hideUserActions:U},y)),!s&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(oi,{setIsScrolledToEdge:y=>{b(y)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:I}),d&&T&&!S&&e.jsx(fs,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{fe.logEvent("chatgpt_thread_scroll_to_top"),x({behavior:"smooth"})},children:e.jsx(sr,{className:"icon text-token-text-primary"})}),e.jsx(xs,{children:R&&e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(fs,{className:D("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{fe.logEvent("chatgpt_thread_scroll_to_bottom"),I.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(nr,{className:"icon text-token-text-primary"})})})})]})]})}const fs=ye.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Tl as P,Sl as S,_l as T,Xs as a};
//# sourceMappingURL=lyuduqdpgl2iyg0z.js.map
